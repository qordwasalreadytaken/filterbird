<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FilterPhoenix - Visual Filter Builder</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: #2a2a2a;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        h1 {
            margin: 0 0 10px 0;
            color: #fff;
        }

        .subtitle {
            color: #999;
            font-size: 14px;
        }

        .layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
        }

        .editor-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .section {
            background: #2a2a2a;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .section-header {
            padding: 15px 20px;
            background: #333;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            border-bottom: 1px solid #444;
        }

        .section-header:hover {
            background: #3a3a3a;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
        }

        .section-toggle {
            font-size: 20px;
            color: #999;
            transition: transform 0.2s;
        }

        .section.expanded .section-toggle {
            transform: rotate(90deg);
        }

        .section-content {
            display: none;
            padding: 15px 20px;
        }

        .section.expanded .section-content {
            display: block;
        }

        .preset-controls {
            margin-bottom: 15px;
            padding: 10px;
            background: #252525;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .preset-controls label {
            font-size: 13px;
            color: #aaa;
            margin: 0;
        }

        .preset-select {
            padding: 8px;
            background: #333;
            border: 1px solid #444;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 14px;
            flex: 1;
            min-width: 200px;
        }

        .group-settings-btn {
            padding: 8px 16px;
            background: #4a4a4a;
            border: 1px solid #666;
            border-radius: 4px;
            color: #4fc3f7;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .group-settings-btn:hover {
            background: #555;
            border-color: #4fc3f7;
            box-shadow: 0 0 8px rgba(79, 195, 247, 0.3);
        }

        .item-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .item-row {
            padding: 10px;
            background: #252525;
            border-radius: 4px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .custom-color-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .custom-label {
            font-size: 11px;
            color: #999;
        }

        .colors-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .item-row:hover {
            background: #2a2a2a;
        }

        .item-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .item-name {
            font-size: 14px;
            color: #ddd;
        }

        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 5px;
            position: relative;
        }

        .color-clear-btn {
            width: 18px;
            height: 18px;
            padding: 0;
            background: #444;
            border: 1px solid #555;
            border-radius: 3px;
            color: #aaa;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .color-clear-btn:hover {
            background: #555;
            color: #fff;
        }

        .color-label {
            font-size: 11px;
            color: #999;
            min-width: 50px;
        }

        .color-input {
            width: 50px;
            height: 28px;
            border: 1px solid #444;
            border-radius: 3px;
            cursor: pointer;
            background: #333;
        }

        .color-select {
            width: 100px;
            height: 28px;
            padding: 4px;
            border: 1px solid #444;
            border-radius: 3px;
            background: #333;
            color: #e0e0e0;
            font-size: 11px;
            cursor: pointer;
        }

        .output-panel {
            position: sticky;
            top: 20px;
            height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        .output-section {
            background: #2a2a2a;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }

        .output-header {
            padding: 15px 20px;
            background: #333;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .output-title {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
        }

        .output-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            background: #4a4a4a;
            border: 1px solid #555;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #555;
        }

        .btn-primary {
            background: #0066cc;
            border-color: #0066cc;
        }

        .btn-primary:hover {
            background: #0052a3;
        }

        .output-textarea {
            flex: 1;
            padding: 15px;
            background: #1a1a1a;
            border: none;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: none;
            line-height: 1.5;
        }

        .output-textarea:focus {
            outline: none;
        }

        .output-textarea.highlight-active {
            background: linear-gradient(to right, #2a4a2a 0%, #1a1a1a 100%);
            transition: background 0.3s ease;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-container {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            animation: modalFadeIn 0.2s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            padding: 20px;
            background: #333;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            margin: 0;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: #999;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            line-height: 1;
        }

        .modal-close:hover {
            background: #444;
            color: #fff;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-section {
            margin-bottom: 25px;
        }

        .modal-section:last-child {
            margin-bottom: 0;
        }

        .modal-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #ccc;
            margin: 0 0 12px 0;
            padding-bottom: 8px;
            border-bottom: 1px solid #444;
        }

        .modal-control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .modal-checkbox-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .modal-checkbox-label {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px;
            background: #252525;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .modal-checkbox-label:hover {
            background: #2d2d2d;
        }

        .modal-checkbox-label input[type="checkbox"] {
            margin: 0;
            cursor: pointer;
        }

        .modal-checkbox-label input[type="checkbox"]:checked + span {
            color: #0066cc;
            font-weight: bold;
        }

        .modal-button-group {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .modal-btn {
            padding: 6px 12px;
            background: #444;
            border: 1px solid #555;
            border-radius: 4px;
            color: #ddd;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .modal-btn:hover {
            background: #555;
        }

        .modal-color-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: #252525;
            border-radius: 4px;
        }

        .modal-color-label {
            font-size: 12px;
            color: #999;
            min-width: 80px;
        }

        .modal-color-input {
            width: 60px;
            height: 30px;
            border: 1px solid #444;
            border-radius: 4px;
            cursor: pointer;
            background: #333;
        }

        .modal-select {
            flex: 1;
            padding: 6px 8px;
            background: #333;
            border: 1px solid #444;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 12px;
            cursor: pointer;
        }

        .modal-clear-btn {
            padding: 6px 12px;
            background: #444;
            border: 1px solid #555;
            border-radius: 4px;
            color: #aaa;
            font-size: 11px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .modal-clear-btn:hover {
            background: #555;
            color: #fff;
        }

        .settings-btn {
            width: 28px;
            height: 28px;
            padding: 0;
            background: #444;
            border: 1px solid #555;
            border-radius: 4px;
            color: #aaa;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .settings-btn:hover {
            background: #555;
            color: #fff;
            transform: rotate(30deg);
        }

        .settings-btn.modified {
            background: #1a4d7a;
            border-color: #4fc3f7;
            color: #4fc3f7;
        }

        .settings-btn.modified:hover {
            background: #2563a3;
            border-color: #81d4fa;
            color: #81d4fa;
            transform: rotate(30deg);
        }

        .socket-checkbox-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .socket-checkbox-label {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 10px;
            background: #252525;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .socket-checkbox-label:hover {
            background: #2d2d2d;
        }

        .socket-checkbox-label input[type="checkbox"] {
            margin: 0;
            cursor: pointer;
        }

        .item-count {
            font-size: 12px;
            color: #777;
            margin-left: 5px;
        }

        /* Hide default file input */
        input[type="file"] {
            display: none;
        }

        .filter-info {
            padding: 10px 20px;
            background: #252525;
            border-top: 1px solid #444;
            font-size: 12px;
            color: #999;
        }

        .global-settings {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .global-settings h3 {
            margin: 0 0 15px 0;
            color: #fff;
            font-size: 16px;
        }

        .filter-levels-config {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #444;
        }

        .filter-levels-config.active {
            display: block;
        }

        .level-names-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .level-name-input {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .level-name-input label {
            font-size: 11px;
            color: #999;
        }

        .level-name-input input {
            padding: 6px 8px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 3px;
            color: #e0e0e0;
            font-size: 12px;
        }

        .levels-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
        }

        .levels-selector.disabled {
            opacity: 0.3;
            pointer-events: none;
        }

        .levels-label {
            font-size: 11px;
            color: #999;
        }

        .level-checkboxes {
            display: flex;
            gap: 4px;
        }

        .level-checkbox-wrapper {
            position: relative;
            display: inline-block;
        }

        .level-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .level-checkbox-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
            color: #666;
            pointer-events: none;
            font-weight: bold;
        }

        .level-checkbox:checked + .level-checkbox-label {
            color: #0066cc;
        }

        .btn-link {
            background: none;
            border: none;
            color: #0066cc;
            cursor: pointer;
            font-size: 11px;
            padding: 2px 6px;
            text-decoration: underline;
        }

        .btn-link:hover {
            color: #0052a3;
        }

        /* Newer level filter styles */
        .item-main {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .levels-container {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .level-all-btn, .level-none-btn {
            padding: 2px 8px;
            background: #3a3a3a;
            border: 1px solid #555;
            border-radius: 3px;
            color: #aaa;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.2s;
        }

        .level-all-btn:hover, .level-none-btn:hover {
            background: #4a4a4a;
            color: #fff;
        }

        label.level-checkbox {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            transition: background 0.2s;
        }

        label.level-checkbox:hover {
            background: #3a3a3a;
        }

        label.level-checkbox input[type="checkbox"] {
            width: 14px;
            height: 14px;
            margin: 0;
            cursor: pointer;
        }

        label.level-checkbox span {
            font-size: 11px;
            color: #aaa;
            user-select: none;
        }

        label.level-checkbox input[type="checkbox"]:checked + span {
            color: #0066cc;
            font-weight: bold;
        }

        .custom-container, .notify-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .custom-checkbox, .notify-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .notify-label {
            font-size: 11px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>FilterPhoenix - Visual Filter Builder - Beta Version</h1>
            <div class="subtitle">Point-and-click interface for creating simple Path of Diablo item filters</div>
            <div class="subtitle" style="color: #ff4444;">Limited testing done, use at your own risk. Testing and feedback is welcome!</div>
            <div style="text-align: center; margin-top: 10px;">
                <a href="filter-builder-about.html" style="color: #4fc3f7; text-decoration: none; font-size: 14px;" target="_blank">ℹ️ About & Help</a>
            </div>
        </header>

        <div class="layout">
            <div class="editor-panel">
                <!-- Global Settings -->
                <div class="global-settings">
                    <h3>Global Settings</h3>
                    <div>
                        <label>
                            <input type="checkbox" id="enable-filter-levels" onchange="toggleFilterLevels(this.checked)">
                            Enable Filter Levels (1-10)
                        </label>
                    </div>
                    <div class="filter-levels-config" id="filter-levels-config">
                        <p style="font-size: 12px; color: #999; margin: 0 0 10px 0;">Name your filter levels (used for strictness control, only named filterlevels will be used):</p>
                        <div class="level-names-grid" id="level-names-grid">
                            <!-- Level name inputs will be generated here -->
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <label title="Hides inferior (INF) items">
                            <input type="checkbox" id="hide-junk" onchange="toggleHideJunk(this.checked)" checked>
                            Hide Junk
                        </label>
                    </div>
                    <div style="margin-top: 8px;">
                        <label title="Shows anything not explicitly hidden by another line">
                            <input type="checkbox" id="show-all" onchange="toggleShowAll(this.checked)" checked>
                            End the filter with show anything not explicitly hidden
                        </label>
                    </div>
                </div>

                <!-- Utility Items Section -->
                <div class="section" id="utility-section">
                    <div class="section-header" onclick="toggleSection('utility-section')">
                        <div>
                            <span class="section-title">Utility Items</span>
                            <span class="item-count" id="utility-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyUtilityPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                                <option value="essential-only">Essential Only (Potions + Scrolls)</option>
                                <option value="endgame">Endgame (Hide low potions)</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('utility', 'Utility Items')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="utility-items"></div>
                    </div>
                </div>

                <!-- Runes Section -->
                <div class="section" id="runes-section">
                    <div class="section-header" onclick="toggleSection('runes-section')">
                        <div>
                            <span class="section-title">Runes</span>
                            <span class="item-count" id="runes-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyRunePreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                                <option value="hide-low">Hide Low Runes (El-Ort)</option>
                                <option value="mid-plus">Mid+ Runes Only (Thul+)</option>
                                <option value="high-only">High Runes Only (Pul+)</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('runes', 'Runes')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="runes-items"></div>
                    </div>
                </div>

                <!-- Gems Section -->
                <div class="section" id="gems-section">
                    <div class="section-header" onclick="toggleSection('gems-section')">
                        <div>
                            <span class="section-title">Gems</span>
                            <span class="item-count" id="gems-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyGemPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                                <option value="perfect-only">Perfect Only</option>
                                <option value="flawless-plus">Flawless+</option>
                                <option value="regular-plus">Regular+</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('gems', 'Gems')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="gems-items"></div>
                    </div>
                </div>

                <!-- PoD/Keys/Maps/Quest & Misc Section -->
                <div class="section" id="misc-section">
                    <div class="section-header" onclick="toggleSection('misc-section')">
                        <div>
                            <span class="section-title">PoD/Keys/Maps/Quest & Misc Items</span>
                            <span class="item-count" id="misc-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyMiscPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                                <option value="essentials">Essentials (Keys/Organs/Essences/Orbs)</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('misc', 'PoD/Keys/Maps/Quest & Misc Items')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="misc-items"></div>
                    </div>
                </div>

                <!-- Unique Jewelry & Charms Section -->
                <div class="section" id="jewelry-charms-section">
                    <div class="section-header" onclick="toggleSection('jewelry-charms-section')">
                        <div>
                            <span class="section-title">Unique Jewelry & Charms</span>
                            <span class="item-count" id="jewelry-charms-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyJewelryCharmsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('jewelry-charms', 'Unique Jewelry & Charms')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="jewelry-charms-items"></div>
                    </div>
                </div>

                <!-- Class-Specific Uniques Section -->
                <div class="section" id="class-uniques-section">
                    <div class="section-header" onclick="toggleSection('class-uniques-section')">
                        <div>
                            <span class="section-title">Class-Specific Unique Items</span>
                            <span class="item-count" id="class-uniques-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyClassUniquesPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('class-uniques', 'Class-Specific Unique Items')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="class-uniques-items"></div>
                    </div>
                </div>

                <!-- Elite Unique Weapons Section -->
                <div class="section" id="elite-weapons-section">
                    <div class="section-header" onclick="toggleSection('elite-weapons-section')">
                        <div>
                            <span class="section-title">Elite Unique Weapons</span>
                            <span class="item-count" id="elite-weapons-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyEliteWeaponsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('elite-weapons', 'Elite Unique Weapons')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="elite-weapons-items"></div>
                    </div>
                </div>

                <!-- Elite Unique Armor Section -->
                <div class="section" id="elite-armor-section">
                    <div class="section-header" onclick="toggleSection('elite-armor-section')">
                        <div>
                            <span class="section-title">Elite Unique Armor</span>
                            <span class="item-count" id="elite-armor-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyEliteArmorPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('elite-armor', 'Elite Unique Armor')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="elite-armor-items"></div>
                    </div>
                </div>

                <!-- Exceptional Unique Weapons Section -->
                <div class="section" id="exc-weapons-section">
                    <div class="section-header" onclick="toggleSection('exc-weapons-section')">
                        <div>
                            <span class="section-title">Exceptional Unique Weapons</span>
                            <span class="item-count" id="exc-weapons-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyExcWeaponsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('exc-weapons', 'Exceptional Unique Weapons')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="exc-weapons-items"></div>
                    </div>
                </div>

                <!-- Exceptional Unique Armor Section -->
                <div class="section" id="exc-armor-section">
                    <div class="section-header" onclick="toggleSection('exc-armor-section')">
                        <div>
                            <span class="section-title">Exceptional Unique Armor</span>
                            <span class="item-count" id="exc-armor-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyExcArmorPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('exc-armor', 'Exceptional Unique Armor')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="exc-armor-items"></div>
                    </div>
                </div>

                <!-- Normal Unique Weapons Section -->
                <div class="section" id="norm-weapons-section">
                    <div class="section-header" onclick="toggleSection('norm-weapons-section')">
                        <div>
                            <span class="section-title">Normal Unique Weapons</span>
                            <span class="item-count" id="norm-weapons-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNormWeaponsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('norm-weapons', 'Normal Unique Weapons')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="norm-weapons-items"></div>
                    </div>
                </div>

                <!-- Normal Unique Armor Section -->
                <div class="section" id="norm-armor-section">
                    <div class="section-header" onclick="toggleSection('norm-armor-section')">
                        <div>
                            <span class="section-title">Normal Unique Armor</span>
                            <span class="item-count" id="norm-armor-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNormArmorPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('norm-armor', 'Normal Unique Armor')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="norm-armor-items"></div>
                    </div>
                </div>

                <!-- High-Level Sets Section -->
                <div class="section" id="high-sets-section">
                    <div class="section-header" onclick="toggleSection('high-sets-section')">
                        <div>
                            <span class="section-title">High-Level Set Items</span>
                            <span class="item-count" id="high-sets-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyHighSetsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('high-sets', 'High-Level Set Items')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="high-sets-items"></div>
                    </div>
                </div>

                <!-- Mid-Level Sets Section -->
                <div class="section" id="mid-sets-section">
                    <div class="section-header" onclick="toggleSection('mid-sets-section')">
                        <div>
                            <span class="section-title">Mid-Level Set Items</span>
                            <span class="item-count" id="mid-sets-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyMidSetsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('mid-sets', 'Mid-Level Set Items')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="mid-sets-items"></div>
                    </div>
                </div>

                <!-- Low-Level Sets Section -->
                <div class="section" id="low-sets-section">
                    <div class="section-header" onclick="toggleSection('low-sets-section')">
                        <div>
                            <span class="section-title">Low-Level Set Items</span>
                            <span class="item-count" id="low-sets-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyLowSetsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('low-sets', 'Low-Level Set Items')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="low-sets-items"></div>
                    </div>
                </div>

                <!-- Magic Jewelry Section -->
                <div class="section" id="magic-jewelry-section">
                    <div class="section-header" onclick="toggleSection('magic-jewelry-section')">
                        <div>
                            <span class="section-title">Magic Jewelry & Jewels</span>
                            <span class="item-count" id="magic-jewelry-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyMagicJewelryPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                                <option value="high-ilvl">High ILVL Only</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('magic-jewelry', 'Magic Jewelry & Jewels')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="magic-jewelry-items"></div>
                    </div>
                </div>

                <!-- Magic Charms Section -->
                <div class="section" id="magic-charms-section">
                    <div class="section-header" onclick="toggleSection('magic-charms-section')">
                        <div>
                            <span class="section-title">Magic Charms</span>
                            <span class="item-count" id="magic-charms-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyMagicCharmsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                                <option value="high-ilvl">High ILVL Only</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('magic-charms', 'Magic Charms')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="magic-charms-items"></div>
                    </div>
                </div>

                <!-- Magic Crafting Bases Section -->
                <div class="section" id="magic-crafting-section">
                    <div class="section-header" onclick="toggleSection('magic-crafting-section')">
                        <div>
                            <span class="section-title">Magic Crafting Bases</span>
                            <span class="item-count" id="magic-crafting-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyMagicCraftingPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('magic-crafting', 'Magic Crafting Bases')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="magic-crafting-items"></div>
                    </div>
                </div>

                <!-- Rare Jewelry Section -->
                <div class="section" id="rare-jewelry-section">
                    <div class="section-header" onclick="toggleSection('rare-jewelry-section')">
                        <div>
                            <span class="section-title">Rare Jewelry & Jewels</span>
                            <span class="item-count" id="rare-jewelry-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyRareJewelryPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('rare-jewelry', 'Rare Jewelry & Jewels')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="rare-jewelry-items"></div>
                    </div>
                </div>

                <!-- Rare Class Items Section -->
                <div class="section" id="rare-class-items-section">
                    <div class="section-header" onclick="toggleSection('rare-class-items-section')">
                        <div>
                            <span class="section-title">Rare Class-Specific Items</span>
                            <span class="item-count" id="rare-class-items-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyRareClassItemsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('rare-class-items', 'Rare Class-Specific Items')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="rare-class-items-items"></div>
                    </div>
                </div>

                <!-- Rare Elite Bases Section -->
                <div class="section" id="rare-elite-bases-section">
                    <div class="section-header" onclick="toggleSection('rare-elite-bases-section')">
                        <div>
                            <span class="section-title">Rare Elite Bases</span>
                            <span class="item-count" id="rare-elite-bases-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyRareEliteBasesPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('rare-elite-bases', 'Rare Elite Bases')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="rare-elite-bases-items"></div>
                    </div>
                </div>

                <!-- NMAG RUNEWORD BASES -->
                <div class="section-divider" style="margin: 30px 0; text-align: center; color: #666; font-weight: bold; font-size: 16px;">
                    === Popular RUNEWORD BASES NMAG ===
                </div>

                <!-- Weapons -->
                <div class="section" id="nmag-polearms-section">
                    <div class="section-header" onclick="toggleSection('nmag-polearms-section')">
                        <div>
                            <span class="section-title">NMAG: Polearms (Insight, Infinity, Obedience)</span>
                            <span class="item-count" id="nmag-polearms-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagPolearmsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                                <option value="eth-only">ETH Only</option>
                                <option value="4sock">4-Socket Only</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-polearms', 'NMAG: Polearms')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-polearms-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-swords-section">
                    <div class="section-header" onclick="toggleSection('nmag-swords-section')">
                        <div>
                            <span class="section-title">NMAG: Swords (Spirit, Grief)</span>
                            <span class="item-count" id="nmag-swords-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagSwordsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                                <option value="elite-only">Elite Only</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-swords', 'NMAG: Swords')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-swords-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-axes-section">
                    <div class="section-header" onclick="toggleSection('nmag-axes-section')">
                        <div>
                            <span class="section-title">NMAG: Axes (Grief, Beast, Death)</span>
                            <span class="item-count" id="nmag-axes-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagAxesPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-axes', 'NMAG: Axes')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-axes-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-maces-section">
                    <div class="section-header" onclick="toggleSection('nmag-maces-section')">
                        <div>
                            <span class="section-title">NMAG: Maces (BoTD, Heart of the Oak)</span>
                            <span class="item-count" id="nmag-maces-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagMacesPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-maces', 'NMAG: Maces')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-maces-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-staves-section">
                    <div class="section-header" onclick="toggleSection('nmag-staves-section')">
                        <div>
                            <span class="section-title">NMAG: Staves (CTA, Memory)</span>
                            <span class="item-count" id="nmag-staves-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagStavesPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-staves', 'NMAG: Staves')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-staves-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-bows-section">
                    <div class="section-header" onclick="toggleSection('nmag-bows-section')">
                        <div>
                            <span class="section-title">NMAG: Bows (Faith, Ice, Brand, Insight)</span>
                            <span class="item-count" id="nmag-bows-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagBowsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-bows', 'NMAG: Bows')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-bows-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-spears-section">
                    <div class="section-header" onclick="toggleSection('nmag-spears-section')">
                        <div>
                            <span class="section-title">NMAG: Spears (Infinity, Insight, Pride, Obedience)</span>
                            <span class="item-count" id="nmag-spears-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagSpearsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-spears', 'NMAG: Spears')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-spears-items"></div>
                    </div>
                </div>

                <!-- Armor -->
                <div class="section" id="nmag-armor-section">
                    <div class="section-header" onclick="toggleSection('nmag-armor-section')">
                        <div>
                            <span class="section-title">NMAG: Armor (Enigma, Fortitude, CoH, Bramble)</span>
                            <span class="item-count" id="nmag-armor-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagArmorPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                                <option value="elite-only">Elite Only</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-armor', 'NMAG: Armor')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-armor-items"></div>
                    </div>
                </div>

                <!-- Shields -->
                <div class="section" id="nmag-shields-generic-section">
                    <div class="section-header" onclick="toggleSection('nmag-shields-generic-section')">
                        <div>
                            <span class="section-title">NMAG: Shields - Generic (Spirit, Splendor, Rhyme)</span>
                            <span class="item-count" id="nmag-shields-generic-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagShieldsGenericPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-shields-generic', 'NMAG: Shields - Generic')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-shields-generic-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-shields-paladin-section">
                    <div class="section-header" onclick="toggleSection('nmag-shields-paladin-section')">
                        <div>
                            <span class="section-title">NMAG: Shields - Paladin (Spirit, Exile)</span>
                            <span class="item-count" id="nmag-shields-paladin-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagShieldsPaladinPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-shields-paladin', 'NMAG: Shields - Paladin')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-shields-paladin-items"></div>
                    </div>
                </div>

                <!-- Helms & Class-Specific -->
                <div class="section" id="nmag-helms-section">
                    <div class="section-header" onclick="toggleSection('nmag-helms-section')">
                        <div>
                            <span class="section-title">NMAG: Helms (Delirium, Dream)</span>
                            <span class="item-count" id="nmag-helms-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagHelmsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-helms', 'NMAG: Helms')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-helms-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-druid-pelts-section">
                    <div class="section-header" onclick="toggleSection('nmag-druid-pelts-section')">
                        <div>
                            <span class="section-title">NMAG: Druid Pelts</span>
                            <span class="item-count" id="nmag-druid-pelts-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagDruidPeltsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-druid-pelts', 'NMAG: Druid Pelts')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-druid-pelts-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-necro-heads-section">
                    <div class="section-header" onclick="toggleSection('nmag-necro-heads-section')">
                        <div>
                            <span class="section-title">NMAG: Necro Shrunken Heads</span>
                            <span class="item-count" id="nmag-necro-heads-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagNecroHeadsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-necro-heads', 'NMAG: Necro Shrunken Heads')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-necro-heads-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-assassin-claws-section">
                    <div class="section-header" onclick="toggleSection('nmag-assassin-claws-section')">
                        <div>
                            <span class="section-title">NMAG: Assassin Claws</span>
                            <span class="item-count" id="nmag-assassin-claws-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagAssassinClawsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-assassin-claws', 'NMAG: Assassin Claws')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-assassin-claws-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-sorc-orbs-section">
                    <div class="section-header" onclick="toggleSection('nmag-sorc-orbs-section')">
                        <div>
                            <span class="section-title">NMAG: Sorc Orbs</span>
                            <span class="item-count" id="nmag-sorc-orbs-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagSorcOrbsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-sorc-orbs', 'NMAG: Sorc Orbs')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-sorc-orbs-items"></div>
                    </div>
                </div>

                <!-- NMAG Other base items -->
                <div class="section-divider" style="margin: 30px 0; text-align: center; color: #666; font-weight: bold; font-size: 16px;">
                    === Other NMAG base items to follow ===
                </div>

                <!-- Extended NMAG categories -->
                <div class="section" id="nmag-daggers-section">
                    <div class="section-header" onclick="toggleSection('nmag-daggers-section')">
                        <div>
                            <span class="section-title">NMAG: Daggers</span>
                            <span class="item-count" id="nmag-daggers-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagDaggersPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                                <option value="elite-only">Elite Only</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-daggers', 'NMAG: Daggers')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-daggers-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-wands-section">
                    <div class="section-header" onclick="toggleSection('nmag-wands-section')">
                        <div>
                            <span class="section-title">NMAG: Wands (White, Memory)</span>
                            <span class="item-count" id="nmag-wands-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagWandsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                                <option value="elite-only">Elite Only</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-wands', 'NMAG: Wands')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-wands-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-scepters-section">
                    <div class="section-header" onclick="toggleSection('nmag-scepters-section')">
                        <div>
                            <span class="section-title">NMAG: Scepters (Spirit, Hoto, Sanctuary)</span>
                            <span class="item-count" id="nmag-scepters-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagSceptersPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                                <option value="elite-only">Elite Only</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-scepters', 'NMAG: Scepters')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-scepters-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-barbarian-helms-section">
                    <div class="section-header" onclick="toggleSection('nmag-barbarian-helms-section')">
                        <div>
                            <span class="section-title">NMAG: Barbarian Helms (Delirium, Dream)</span>
                            <span class="item-count" id="nmag-barbarian-helms-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagBarbarianHelmsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                                <option value="elite-only">Elite Only</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-barbarian-helms', 'NMAG: Barbarian Helms')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-barbarian-helms-items"></div>
                    </div>
                </div>

                <!-- ===== Other NMAG base items to follow ===== -->

                <div class="section" id="nmag-polearms-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-polearms-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Polearms</span>
                            <span class="item-count" id="nmag-polearms-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagPolearmsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-polearms-extended', 'NMAG Extended: Polearms')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-polearms-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-swords-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-swords-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Swords</span>
                            <span class="item-count" id="nmag-swords-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagSwordsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-swords-extended', 'NMAG Extended: Swords')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-swords-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-axes-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-axes-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Axes</span>
                            <span class="item-count" id="nmag-axes-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagAxesExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-axes-extended', 'NMAG Extended: Axes')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-axes-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-maces-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-maces-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Maces</span>
                            <span class="item-count" id="nmag-maces-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagMacesExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-maces-extended', 'NMAG Extended: Maces')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-maces-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-staves-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-staves-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Staves</span>
                            <span class="item-count" id="nmag-staves-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagStavesExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-staves-extended', 'NMAG Extended: Staves')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-staves-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-spears-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-spears-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Spears</span>
                            <span class="item-count" id="nmag-spears-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagSpearsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-spears-extended', 'NMAG Extended: Spears')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-spears-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-bows-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-bows-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Bows</span>
                            <span class="item-count" id="nmag-bows-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagBowsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-bows-extended', 'NMAG Extended: Bows')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-bows-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-crossbows-section">
                    <div class="section-header" onclick="toggleSection('nmag-crossbows-section')">
                        <div>
                            <span class="section-title">NMAG: Crossbows</span>
                            <span class="item-count" id="nmag-crossbows-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagCrossbowsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-crossbows', 'NMAG: Crossbows')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-crossbows-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-javelins-section">
                    <div class="section-header" onclick="toggleSection('nmag-javelins-section')">
                        <div>
                            <span class="section-title">NMAG: Javelins</span>
                            <span class="item-count" id="nmag-javelins-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagJavelinsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-javelins', 'NMAG: Javelins')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-javelins-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-armor-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-armor-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Armor</span>
                            <span class="item-count" id="nmag-armor-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagArmorExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-armor-extended', 'NMAG Extended: Armor')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-armor-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-shields-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-shields-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Shields - Generic</span>
                            <span class="item-count" id="nmag-shields-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagShieldsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-shields-extended', 'NMAG Extended: Shields - Generic')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-shields-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-paladin-shields-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-paladin-shields-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Shields - Paladin</span>
                            <span class="item-count" id="nmag-paladin-shields-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagPaladinShieldsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-paladin-shields-extended', 'NMAG Extended: Shields - Paladin')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-paladin-shields-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-necromancer-shields-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-necromancer-shields-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Necro Shields</span>
                            <span class="item-count" id="nmag-necromancer-shields-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagNecromancerShieldsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-necromancer-shields-extended', 'NMAG Extended: Necro Shields')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-necromancer-shields-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-helms-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-helms-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Helms</span>
                            <span class="item-count" id="nmag-helms-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagHelmsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-helms-extended', 'NMAG Extended: Helms')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-helms-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-druid-pelts-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-druid-pelts-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Druid Pelts</span>
                            <span class="item-count" id="nmag-druid-pelts-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagDruidPeltsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-druid-pelts-extended', 'NMAG Extended: Druid Pelts')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-druid-pelts-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-necro-heads-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-necro-heads-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Necro Heads</span>
                            <span class="item-count" id="nmag-necro-heads-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagNecroHeadsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-necro-heads-extended', 'NMAG Extended: Necro Heads')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-necro-heads-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-assassin-claws-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-assassin-claws-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Assassin Claws</span>
                            <span class="item-count" id="nmag-assassin-claws-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagAssassinClawsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-assassin-claws-extended', 'NMAG Extended: Assassin Claws')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-assassin-claws-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-sorc-orbs-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-sorc-orbs-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Sorc Orbs</span>
                            <span class="item-count" id="nmag-sorc-orbs-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagSorcOrbsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-sorc-orbs-extended', 'NMAG Extended: Sorc Orbs')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-sorc-orbs-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-daggers-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-daggers-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Daggers</span>
                            <span class="item-count" id="nmag-daggers-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagDaggersExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-daggers-extended', 'NMAG Extended: Daggers')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-daggers-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-wands-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-wands-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Wands</span>
                            <span class="item-count" id="nmag-wands-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagWandsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-wands-extended', 'NMAG Extended: Wands')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-wands-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-scepters-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-scepters-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Scepters</span>
                            <span class="item-count" id="nmag-scepters-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagSceptersExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-scepters-extended', 'NMAG Extended: Scepters')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-scepters-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-barbarian-helms-extended-section">
                    <div class="section-header" onclick="toggleSection('nmag-barbarian-helms-extended-section')">
                        <div>
                            <span class="section-title">NMAG Extended: Barbarian Helms</span>
                            <span class="item-count" id="nmag-barbarian-helms-extended-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagBarbarianHelmsExtendedPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-barbarian-helms-extended', 'NMAG Extended: Barbarian Helms')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-barbarian-helms-extended-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-amazon-weapons-section">
                    <div class="section-header" onclick="toggleSection('nmag-amazon-weapons-section')">
                        <div>
                            <span class="section-title">NMAG: Amazon Weapons</span>
                            <span class="item-count" id="nmag-amazon-weapons-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagAmazonWeaponsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-amazon-weapons', 'NMAG: Amazon Weapons')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-amazon-weapons-items"></div>
                    </div>
                </div>

                <div class="section" id="nmag-circlets-section">
                    <div class="section-header" onclick="toggleSection('nmag-circlets-section')">
                        <div>
                            <span class="section-title">NMAG: Circlets</span>
                            <span class="item-count" id="nmag-circlets-count">(0/0 shown)</span>
                        </div>
                        <span class="section-toggle">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="preset-controls">
                            <label>Quick Preset:</label>
                            <select class="preset-select" onchange="applyNmagCircletsPreset(this.value)">
                                <option value="">-- Select Preset --</option>
                                <option value="show-all">Show All</option>
                                <option value="hide-all">Hide All</option>
                            </select>
                            <button class="group-settings-btn" onclick="openGroupSettings('nmag-circlets', 'NMAG: Circlets')">⚙ Group Settings</button>
                        </div>
                        <div class="item-list" id="nmag-circlets-items"></div>
                    </div>
                </div>

            </div>

            <!-- Output Panel -->
            <div class="output-panel">
                <div class="output-section">
                    <div class="output-header">
                        <span class="output-title">Filter Output</span>
                        <div class="output-actions">
                            <label for="import-file" class="btn">Import Filter</label>
                            <input type="file" id="import-file" accept=".filter" onchange="importFilter(event)">
                            <button class="btn btn-primary" onclick="exportFilter()">Export</button>
                            <button class="btn" onclick="copyToClipboard()">Copy</button>
                        </div>
                    </div>
                    <textarea class="output-textarea" id="filter-output" 
                        placeholder="Your filter will appear here... You can edit it manually."></textarea>
                    <div class="filter-info">
                        Lines: <span id="line-count">0</span> | 
                        Characters: <span id="char-count">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- item_metadata.js no longer needed - max_sockets is stored in NMAG item arrays -->
    <!-- <script src="data/item_metadata.js"></script> -->
    <script>
        // Available font colors for filter
        const FONT_COLORS = [
            'WHITE', 'RED', 'GREEN', 'BLUE', 'GOLD', 'GRAY', 'BLACK', 'TAN',
            'ORANGE', 'YELLOW', 'PURPLE', 'DGREEN', 'DARK_GREEN', 'BOLD',
            'CORAL', 'SAGE', 'TEAL', 'LGRAY', 'LIGHT_GRAY', 'NAVY', 'DBLUE',
            'DARK_BLUE', 'COBALT', 'DARK_PURPLE', 'DPURPLE', 'BROWN'
        ];

        // Item data
        const utilityItems = [
            { name: "Full Rejuvenation Potion", code: "rvl", category: "potion" },
            { name: "Rejuvenation Potion", code: "rvs", category: "potion" },
            { name: "Super Healing Potion", code: "hp5", category: "potion" },
            { name: "Greater Healing Potion", code: "hp4", category: "potion" },
            { name: "Healing Potion", code: "hp3", category: "potion" },
            { name: "Lesser Healing Potion", code: "hp2", category: "potion" },
            { name: "Minor Healing Potion", code: "hp1", category: "potion" },
            { name: "Super Mana Potion", code: "mp5", category: "potion" },
            { name: "Greater Mana Potion", code: "mp4", category: "potion" },
            { name: "Mana Potion", code: "mp3", category: "potion" },
            { name: "Lesser Mana Potion", code: "mp2", category: "potion" },
            { name: "Minor Mana Potion", code: "mp1", category: "potion" },
            { name: "Antidote Potion", code: "yps", category: "potion" },
            { name: "Thawing Potion", code: "wms", category: "potion" },
            { name: "Stamina Potion", code: "vps", category: "potion" },
            { name: "Tome of Town Portal", code: "tbk", category: "scroll" },
            { name: "Tome of Identify", code: "ibk", category: "scroll" },
            { name: "Scroll of Town Portal", code: "tsc", category: "scroll" },
            { name: "Scroll of Identify", code: "isc", category: "scroll" },
            { name: "Key", code: "key", category: "key" },
        ];

        const runeItems = [
            { name: "El Rune", code: "r01", level: 11, tier: 1 },
            { name: "Eld Rune", code: "r02", level: 11, tier: 1 },
            { name: "Tir Rune", code: "r03", level: 13, tier: 1 },
            { name: "Nef Rune", code: "r04", level: 13, tier: 1 },
            { name: "Eth Rune", code: "r05", level: 15, tier: 1 },
            { name: "Ith Rune", code: "r06", level: 15, tier: 1 },
            { name: "Tal Rune", code: "r07", level: 17, tier: 1 },
            { name: "Ral Rune", code: "r08", level: 19, tier: 1 },
            { name: "Ort Rune", code: "r09", level: 21, tier: 1 },
            { name: "Thul Rune", code: "r10", level: 23, tier: 2 },
            { name: "Amn Rune", code: "r11", level: 25, tier: 2 },
            { name: "Sol Rune", code: "r12", level: 27, tier: 2 },
            { name: "Shael Rune", code: "r13", level: 29, tier: 2 },
            { name: "Dol Rune", code: "r14", level: 31, tier: 2 },
            { name: "Hel Rune", code: "r15", level: 0, tier: 2 },
            { name: "Io Rune", code: "r16", level: 35, tier: 2 },
            { name: "Lum Rune", code: "r17", level: 37, tier: 2 },
            { name: "Ko Rune", code: "r18", level: 39, tier: 2 },
            { name: "Fal Rune", code: "r19", level: 41, tier: 2 },
            { name: "Lem Rune", code: "r20", level: 43, tier: 3 },
            { name: "Pul Rune", code: "r21", level: 45, tier: 3 },
            { name: "Um Rune", code: "r22", level: 47, tier: 3 },
            { name: "Mal Rune", code: "r23", level: 49, tier: 3 },
            { name: "Ist Rune", code: "r24", level: 51, tier: 3 },
            { name: "Gul Rune", code: "r25", level: 53, tier: 3 },
            { name: "Vex Rune", code: "r26", level: 55, tier: 3 },
            { name: "Ohm Rune", code: "r27", level: 57, tier: 3 },
            { name: "Lo Rune", code: "r28", level: 59, tier: 3 },
            { name: "Sur Rune", code: "r29", level: 61, tier: 3 },
            { name: "Ber Rune", code: "r30", level: 63, tier: 3 },
            { name: "Jah Rune", code: "r31", level: 65, tier: 3 },
            { name: "Cham Rune", code: "r32", level: 67, tier: 3 },
            { name: "Zod Rune", code: "r33", level: 69, tier: 3 },
        ];

        const gemItems = [
            { name: "Perfect Sapphire", code: "gpb", level: 5, type: "sapphire" },
            { name: "Perfect Emerald", code: "gpg", level: 5, type: "emerald" },
            { name: "Perfect Topaz", code: "gpy", level: 5, type: "topaz" },
            { name: "Perfect Ruby", code: "gpr", level: 5, type: "ruby" },
            { name: "Perfect Amethyst", code: "gpv", level: 5, type: "amethyst" },
            { name: "Perfect Diamond", code: "gpw", level: 5, type: "diamond" },
            { name: "Perfect Skull", code: "skz", level: 5, type: "skull" },
            { name: "Flawless Sapphire", code: "glb", level: 4, type: "sapphire" },
            { name: "Flawless Emerald", code: "glg", level: 4, type: "emerald" },
            { name: "Flawless Topaz", code: "gly", level: 4, type: "topaz" },
            { name: "Flawless Ruby", code: "glr", level: 4, type: "ruby" },
            { name: "Flawless Amethyst", code: "gzv", level: 4, type: "amethyst" },
            { name: "Flawless Diamond", code: "glw", level: 4, type: "diamond" },
            { name: "Flawless Skull", code: "skl", level: 4, type: "skull" },
            { name: "Sapphire", code: "gsb", level: 3, type: "sapphire" },
            { name: "Emerald", code: "gsg", level: 3, type: "emerald" },
            { name: "Topaz", code: "gsy", level: 3, type: "topaz" },
            { name: "Ruby", code: "gsr", level: 3, type: "ruby" },
            { name: "Amethyst", code: "gsv", level: 3, type: "amethyst" },
            { name: "Diamond", code: "gsw", level: 3, type: "diamond" },
            { name: "Skull", code: "sku", level: 3, type: "skull" },
            { name: "Flawed Sapphire", code: "gfb", level: 2, type: "sapphire" },
            { name: "Flawed Emerald", code: "gfg", level: 2, type: "emerald" },
            { name: "Flawed Topaz", code: "gfy", level: 2, type: "topaz" },
            { name: "Flawed Ruby", code: "gfr", level: 2, type: "ruby" },
            { name: "Flawed Amethyst", code: "gfv", level: 2, type: "amethyst" },
            { name: "Flawed Diamond", code: "gfw", level: 2, type: "diamond" },
            { name: "Flawed Skull", code: "skf", level: 2, type: "skull" },
            { name: "Chipped Sapphire", code: "gcb", level: 1, type: "sapphire" },
            { name: "Chipped Emerald", code: "gcg", level: 1, type: "emerald" },
            { name: "Chipped Topaz", code: "gcy", level: 1, type: "topaz" },
            { name: "Chipped Ruby", code: "gcr", level: 1, type: "ruby" },
            { name: "Chipped Amethyst", code: "gcv", level: 1, type: "amethyst" },
            { name: "Chipped Diamond", code: "gcw", level: 1, type: "diamond" },
            { name: "Chipped Skull", code: "skc", level: 1, type: "skull" },
        ];

        const miscItems = [
            { name: "Synthesized Items", code: "SYNTH", category: "synth" },
            { name: "Orb of Corruption", code: "cx5", category: "orb" },
            { name: "Orb of Alteration", code: "cx9", category: "orb" },
            { name: "Key of Terror", code: "pk1", category: "key" },
            { name: "Key of Hatred", code: "pk2", category: "key" },
            { name: "Key of Destruction", code: "pk3", category: "key" },
            { name: "Diablo's Horn", code: "dhn", category: "organ" },
            { name: "Baal's Eye", code: "bey", category: "organ" },
            { name: "Mephisto's Brain", code: "mbr", category: "organ" },
            { name: "Twisted Essence of Suffering", code: "tes", category: "essence" },
            { name: "Charged Essence of Hatred", code: "ceh", category: "essence" },
            { name: "Burning Essence of Terror", code: "bet", category: "essence" },
            { name: "Festering Essence of Destruction", code: "fed", category: "essence" },
            { name: "Token of Absolution", code: "toa", category: "essence" },
            { name: "All Maps", code: "MAP", category: "map" },
            { name: "All Quest Items", code: "QUEST", category: "quest" },
            { name: "All Crafted Items", code: "CRAFT", category: "crafted" },
        ];

        // Unique items data - organized by category
        const jewelryAndCharms = [
            { name: "Unique Rings", code: "rin" },
            { name: "Unique Amulets", code: "amu" },
            { name: "Unique Jewels", code: "jew" },
            { name: "Unique Small Charms", code: "cm1" },
            { name: "Unique Large Charms", code: "cm2" },
            { name: "Unique Grand Charms", code: "cm3" },
        ];

        const classSpecificUniques = [
            { name: "Titan's Revenge", code: "7ja" },
            { name: "Thunderstroke", code: "7ja" },
            { name: "Lycander's Flank", code: "7ja" },
            { name: "Stoneraven", code: "9ja" },
            { name: "Blood Raven's Charge", code: "9am" },
            { name: "Lycander's Aim", code: "8lw" },
            { name: "Bartuc's Cut-Throat", code: "7bt" },
            { name: "Jade Talon", code: "7wc" },
            { name: "Shadow Killer", code: "9ar" },
            { name: "Firelizard's Talons", code: "9wc" },
            { name: "The Oculus", code: "6cs" },
            { name: "Eschuta's Temper", code: "ob9" },
            { name: "Death's Fathom", code: "obd" },
            { name: "Homunculus", code: "ne9" },
            { name: "Darkforce Spawn", code: "ned" },
            { name: "Boneflame", code: "nee" },
            { name: "Herald of Zakarum", code: "paf" },
            { name: "Alma Negra", code: "paf" },
            { name: "Dragonscale", code: "pae" },
            { name: "Arreat's Face", code: "ba5" },
            { name: "Demonhorn's Edge", code: "ba4" },
            { name: "Wolfhowl", code: "baa" },
            { name: "Halaberd's Reign", code: "bac" },
            { name: "Jalal's Mane", code: "dr5" },
            { name: "Cerebus' Bite", code: "dr9" },
            { name: "Spirit Keeper", code: "dra" },
            { name: "Ravenlore", code: "drb" },
        ];

        const eliteUniqueWeapons = [
            { name: "Doombringer", code: "7cr" },
            { name: "The Grandfather", code: "7fb" },
            { name: "Lightsabre", code: "7gd" },
            { name: "Azurewrath", code: "7gd" },
            { name: "Frostwind", code: "7cs" },
            { name: "Flamebellow", code: "7b7" },
            { name: "Bloodmoon", code: "72h" },
            { name: "Djinn Slayer", code: "7dj" },
            { name: "Razor's Edge", code: "7ta" },
            { name: "Rune Master", code: "7et" },
            { name: "Cranebeak", code: "7ws" },
            { name: "Death Cleaver", code: "7wa" },
            { name: "Ethereal Edge", code: "7ha" },
            { name: "Hellslayer", code: "7ga" },
            { name: "Messerschmidt's Reaver", code: "7la" },
            { name: "Executioner's Justice", code: "7gi" },
            { name: "Nord's Tenderizer", code: "7tr" },
            { name: "Demon Limb", code: "7wh" },
            { name: "Baranar's Star", code: "7fl" },
            { name: "Horizon's Tornado", code: "7sc" },
            { name: "Stormlash", code: "7sc" },
            { name: "Stone Crusher", code: "7m7" },
            { name: "Schaefer's Hammer", code: "7m7" },
            { name: "Windhammer", code: "7o7" },
            { name: "Earth Shifter", code: "7gm" },
            { name: "The Cranium Basher", code: "7gm" },
            { name: "Wizardspike", code: "7dg" },
            { name: "Fleshripper", code: "7kr" },
            { name: "Ghostflame", code: "7di" },
            { name: "Ondal's Wisdom", code: "6ss" },
            { name: "Mang Song's Lesson", code: "6cs" },
            { name: "Boneshade", code: "7wn" },
            { name: "Death's Web", code: "7yw" },
            { name: "Heaven's Light", code: "7sc" },
            { name: "The Redeemer", code: "7sc" },
            { name: "Astreon's Iron Ward", code: "7qs" },
            { name: "Bonehew", code: "7o7" },
            { name: "Stormspire", code: "7gt" },
            { name: "The Reaper's Toll", code: "7s8" },
            { name: "Tomb Reaver", code: "7pa" },
            { name: "Arioc's Needle", code: "7h7" },
            { name: "Viperfork", code: "7p7" },
            { name: "Steel Pillar", code: "7vo" },
            { name: "Demon's Arch", code: "7bk" },
            { name: "Wraith Flight", code: "7gl" },
            { name: "Gargoyle's Bite", code: "7ts" },
            { name: "Gimmershred", code: "7ta" },
            { name: "Lacerator", code: "7tw" },
            { name: "Warshrike", code: "7bk" },
            { name: "Eaglehorn", code: "6l7" },
            { name: "Widowmaker", code: "6hb" },
            { name: "Windforce", code: "6lw" },
            { name: "Hellrack", code: "6hx" },
            { name: "Gut Siphon", code: "6rx" },
        ];

        const eliteUniqueArmor = [
            { name: "Andariel's Visage", code: "bac" },
            { name: "Crown of Ages", code: "urn" },
            { name: "Giant Skull", code: "baf" },
            { name: "Griffon's Eye", code: "ci3" },
            { name: "Nightwing's Veil", code: "ba9" },
            { name: "Vampire Gaze", code: "ba7" },
            { name: "Harlequin Crest", code: "ba8" },
            { name: "Steel Shade", code: "ba6" },
            { name: "Templar's Might", code: "uar" },
            { name: "Tyrael's Might", code: "uar" },
            { name: "Leviathan", code: "uui" },
            { name: "Steel Carapace", code: "uul" },
            { name: "Ormus' Robes", code: "uui" },
            { name: "Arkaine's Valor", code: "utp" },
            { name: "The Gladiator's Bane", code: "uea" },
            { name: "Corpsemourn", code: "ung" },
            { name: "Guardian Angel", code: "utp" },
            { name: "Skullder's Ire", code: "urs" },
            { name: "Stormshield", code: "uit" },
            { name: "Head Hunter's Glory", code: "paf" },
            { name: "Medusa's Gaze", code: "pae" },
            { name: "Spirit Ward", code: "paf" },
            { name: "Blackoak Shield", code: "paf" },
            { name: "Spike Thorn", code: "paf" },
            { name: "Steelrend", code: "uhg" },
            { name: "Hellmouth", code: "ulg" },
            { name: "Dracul's Grasp", code: "uvg" },
            { name: "Soul Drainer", code: "umg" },
            { name: "Shadowdancer", code: "umb" },
            { name: "Sandstorm Trek", code: "uhb" },
            { name: "Marrowwalk", code: "uvb" },
            { name: "War Traveler", code: "utb" },
            { name: "Gore Rider", code: "ulb" },
            { name: "Arachnid Mesh", code: "ulc" },
            { name: "Nosferatu's Coil", code: "uvc" },
            { name: "Verdungo's Hearty Cord", code: "umc" },
            { name: "String of Ears", code: "ulc" },
            { name: "Thundergod's Vigor", code: "uhc" },
        ];

        const exceptionalUniqueWeapons = [
            { name: "Bloodletter", code: "9ss" },
            { name: "Coldsteel Eye", code: "9sm" },
            { name: "Hexfire", code: "9sb" },
            { name: "Blade of Ali Baba", code: "9fc" },
            { name: "Ginther's Rift", code: "9cr" },
            { name: "Headstriker", code: "9bs" },
            { name: "Plague Bearer", code: "9ls" },
            { name: "The Atlantean", code: "9wd" },
            { name: "Crainte Vomir", code: "92h" },
            { name: "Bing Sz Wang", code: "9cm" },
            { name: "The Vile Husk", code: "9gs" },
            { name: "Cloudcrack", code: "9b9" },
            { name: "Todesfaelle Flamme", code: "9fb" },
            { name: "Swordguard", code: "9gd" },
            { name: "Coldkill", code: "9ha" },
            { name: "Butcher's Pupil", code: "9ax" },
            { name: "Islestrike", code: "92a" },
            { name: "Pompeii's Wrath", code: "9mp" },
            { name: "Guardian Naga", code: "9mt" },
            { name: "Warlord's Trust", code: "9ma" },
            { name: "Spellsteel", code: "9ba" },
            { name: "Stormrider", code: "9bt" },
            { name: "Boneslayer Blade", code: "9ga" },
            { name: "The Minotaur", code: "9gi" },
            { name: "Dark Clan Crusher", code: "9cl" },
            { name: "Fleshrender", code: "9sp" },
            { name: "Sureshrill Frost", code: "9ma" },
            { name: "Moonfall", code: "9mt" },
            { name: "Baezil's Vortex", code: "9fl" },
            { name: "Earthshaker", code: "9wh" },
            { name: "Bloodtree Stump", code: "9m9" },
            { name: "The Gavel of Pain", code: "9mt" },
            { name: "Spineripper", code: "9dg" },
            { name: "Heart Carver", code: "9di" },
            { name: "Blackbog's Sharp", code: "9kr" },
            { name: "Stormspike", code: "9bl" },
            { name: "Razorswitch", code: "9s8" },
            { name: "Ribcracker", code: "9st" },
            { name: "Chromatic Ire", code: "9s9" },
            { name: "Warpspear", code: "9sb" },
            { name: "Skull Collector", code: "9ss" },
            { name: "Suicide Branch", code: "9bw" },
            { name: "Carin Shard", code: "9gw" },
            { name: "Arm of King Leoric", code: "9tw" },
            { name: "Blackhand Key", code: "9qr" },
            { name: "Zakarum's Hand", code: "9sc" },
            { name: "The Fetid Sprinkler", code: "9qs" },
            { name: "Hand of Blessed Light", code: "9ws" },
            { name: "The Meat Scraper", code: "9pa" },
            { name: "Blackleach Blade", code: "9h9" },
            { name: "Athena's Wrath", code: "9s7" },
            { name: "Pierre Tombale Couant", code: "9vo" },
            { name: "Husoldal Evo", code: "9s8" },
            { name: "Grim's Burning Dead", code: "9p9" },
            { name: "The Impaler", code: "9sr" },
            { name: "Kelpie Snare", code: "9tr" },
            { name: "Soulfeast Tine", code: "9br" },
            { name: "Hone Sundan", code: "9st" },
            { name: "Spire of Honor", code: "9p9" },
            { name: "Deathbit", code: "9b8" },
            { name: "The Scalper", code: "9ta" },
            { name: "Endlesshail", code: "8sb" },
            { name: "Witchwild String", code: "8lb" },
            { name: "Cliffkiller", code: "8cb" },
            { name: "Magewrath", code: "8s8" },
            { name: "Goldstrike Arch", code: "8l8" },
            { name: "Langer Briser", code: "8lx" },
            { name: "Pus Spitter", code: "8mx" },
            { name: "Buriza-Do Kyanon", code: "8hx" },
            { name: "Demon Machine", code: "8rx" },
        ];

        const exceptionalUniqueArmor = [
            { name: "Blackhorn's Face", code: "xh9" },
            { name: "Crown of Thieves", code: "xhm" },
            { name: "Kira's Guardian", code: "ci2" },
            { name: "Stealskull", code: "xrn" },
            { name: "Veil of Steel", code: "xsk" },
            { name: "Peasant Crown", code: "xow" },
            { name: "Rockstopper", code: "xh9" },
            { name: "Valkyrie Wing", code: "xlm" },
            { name: "Duriel's Shell", code: "xrs" },
            { name: "Shaftstop", code: "xpl" },
            { name: "Toothrow", code: "xui" },
            { name: "Atma's Wail", code: "xul" },
            { name: "Black Hades", code: "xmb" },
            { name: "Iron Pelt", code: "xlt" },
            { name: "Crow Caw", code: "xtu" },
            { name: "Spirit Forge", code: "xng" },
            { name: "Skin of the Vipermagi", code: "xea" },
            { name: "Skin of the Flayed One", code: "xla" },
            { name: "Rattlecage", code: "xhb" },
            { name: "Goldskin", code: "xtp" },
            { name: "Silks of the Victor", code: "xth" },
            { name: "The Spirit Shroud", code: "xuc" },
            { name: "Radament's Sphere", code: "pa9" },
            { name: "Lidless Wall", code: "paf" },
            { name: "Stormchaser", code: "paf" },
            { name: "Gerke's Sanctuary", code: "paf" },
            { name: "Tiamat's Rebuke", code: "paf" },
            { name: "Lance Guard", code: "paf" },
            { name: "Venom Grip", code: "xlg" },
            { name: "Gravepalm", code: "xmg" },
            { name: "Ghoulhide", code: "xhg" },
            { name: "Lava Gout", code: "xtg" },
            { name: "Hellmouth", code: "ulg" },
            { name: "Infernostride", code: "xlb" },
            { name: "Waterwalk", code: "xmb" },
            { name: "Silkweave", code: "xhb" },
            { name: "War Traveler", code: "xtb" },
            { name: "Gloomstrap", code: "zlb" },
            { name: "Snowclash", code: "ztb" },
            { name: "Goldwrap", code: "zmb" },
            { name: "Bladebuckle", code: "zhb" },
            { name: "String of Ears", code: "zlb" },
        ];

        const normalUniqueWeapons = [
            { name: "Rixot's Keen", code: "ssd" },
            { name: "Blood Crescent", code: "scm" },
            { name: "Skewer of Krintiz", code: "sbr" },
            { name: "Gleamscythe", code: "flc" },
            { name: "Griswold's Edge", code: "bsd" },
            { name: "Hellplague", code: "lsd" },
            { name: "Culwen's Point", code: "wsd" },
            { name: "Shadowfang", code: "2hs" },
            { name: "Soulflay", code: "clm" },
            { name: "Kinemil's Awl", code: "gis" },
            { name: "Blacktongue", code: "bsw" },
            { name: "Ripsaw", code: "flb" },
            { name: "The Patriarch", code: "gsd" },
            { name: "The Gnasher", code: "hax" },
            { name: "Deathspade", code: "axe" },
            { name: "Bladebone", code: "2ax" },
            { name: "Skull Splitter", code: "mpi" },
            { name: "Rakescar", code: "wax" },
            { name: "Axe of Fechmar", code: "lax" },
            { name: "Goreshovel", code: "bax" },
            { name: "The Chieftain", code: "btx" },
            { name: "Brainhew", code: "gax" },
            { name: "Humongous", code: "gix" },
            { name: "Felloak", code: "clb" },
            { name: "Stoutnail", code: "spc" },
            { name: "Crushflange", code: "mac" },
            { name: "Bloodrise", code: "mst" },
            { name: "The General's Tan Do Li Ga", code: "fla" },
            { name: "Ironstone", code: "whm" },
            { name: "Bonesnap", code: "mau" },
            { name: "Steeldriver", code: "gma" },
            { name: "Gull", code: "dgr" },
            { name: "The Diggler", code: "dir" },
            { name: "The Jade Tan Do", code: "kri" },
            { name: "Spectral Shard", code: "bld" },
            { name: "Bane Ash", code: "sst" },
            { name: "Serpent Lord", code: "lst" },
            { name: "Spire of Lazarus", code: "cst" },
            { name: "The Salamander", code: "bst" },
            { name: "The Iron Jang Bong", code: "wst" },
            { name: "Torch of Iro", code: "wnd" },
            { name: "Maelstrom", code: "ywn" },
            { name: "Gravenspine", code: "bwn" },
            { name: "Ume's Lament", code: "gwn" },
            { name: "Knell Striker", code: "scp" },
            { name: "Rusthandle", code: "gsc" },
            { name: "Stormeye", code: "wsp" },
            { name: "Dimoak's Hew", code: "bar" },
            { name: "Steelgoad", code: "vou" },
            { name: "Soul Harvest", code: "scy" },
            { name: "The Battlebranch", code: "pax" },
            { name: "Woestave", code: "hal" },
            { name: "The Grim Reaper", code: "wsc" },
            { name: "The Dragon Chang", code: "spr" },
            { name: "Razortine", code: "tri" },
            { name: "Bloodthief", code: "brn" },
            { name: "Lance of Yaggai", code: "spt" },
            { name: "The Tannr Gorerod", code: "pik" },
            { name: "Pluckeye", code: "sbw" },
            { name: "Witherstring", code: "hbw" },
            { name: "Raven Claw", code: "lbw" },
            { name: "Rogue's Bow", code: "cbw" },
            { name: "Stormstrike", code: "sbb" },
            { name: "Wizendraw", code: "lbb" },
            { name: "Hellclap", code: "swb" },
            { name: "Blastbark", code: "lwb" },
            { name: "Skystrike", code: "8sb" },
            { name: "Riphook", code: "lxb" },
            { name: "Kuko Shakaku", code: "mxb" },
            { name: "Leadcrow", code: "lxb" },
            { name: "Ichorsting", code: "mxb" },
            { name: "Hellcast", code: "hxb" },
            { name: "Doomslinger", code: "rxb" },
        ];

        const normalUniqueArmor = [
            { name: "Biggin's Bonnet", code: "cap" },
            { name: "Tarnhelm", code: "skp" },
            { name: "Coif of Glory", code: "hlm" },
            { name: "Duskdeep", code: "fhl" },
            { name: "Howltusk", code: "ghm" },
            { name: "Undead Crown", code: "crn" },
            { name: "Wormskull", code: "msk" },
            { name: "Greyform", code: "qui" },
            { name: "Blinkbat's Form", code: "lea" },
            { name: "The Centurion", code: "hla" },
            { name: "Twitchthroe", code: "stu" },
            { name: "Darkglow", code: "rng" },
            { name: "Hawkmail", code: "scl" },
            { name: "Sparking Mail", code: "chn" },
            { name: "Venom Ward", code: "brs" },
            { name: "Iceblink", code: "spl" },
            { name: "Boneflesh", code: "plt" },
            { name: "Rockfleece", code: "fld" },
            { name: "Rattlecage", code: "gth" },
            { name: "Goldskin", code: "ful" },
            { name: "Victors Silk", code: "aar" },
            { name: "Heavenly Garb", code: "ltp" },
            { name: "Pelta Lunata", code: "buc" },
            { name: "Umbral Disk", code: "sml" },
            { name: "Stormguild", code: "lrg" },
            { name: "Steelclash", code: "kit" },
            { name: "Swordback Hold", code: "spk" },
            { name: "Bverrit Keep", code: "tow" },
            { name: "Wall of the Eyeless", code: "gts" },
            { name: "The Ward", code: "lrg" },
            { name: "Visceratuant", code: "buc" },
            { name: "Moser's Blessed Circle", code: "xml" },
            { name: "The Hand of Broc", code: "lgl" },
            { name: "Bloodfist", code: "hgl" },
            { name: "Chance Guards", code: "mgl" },
            { name: "Magefist", code: "tgl" },
            { name: "Frostburn", code: "hgl" },
            { name: "Hotspur", code: "lbt" },
            { name: "Gorefoot", code: "hbt" },
            { name: "Treads of Cthon", code: "mbt" },
            { name: "Goblin Toe", code: "tbt" },
            { name: "Tearhaunch", code: "hbt" },
            { name: "Lenymo", code: "lbl" },
            { name: "Snakecord", code: "vbl" },
            { name: "Nightsmoke", code: "hbl" },
            { name: "Goldwrap", code: "hbl" },
            { name: "Bladebuckle", code: "mbl" },
        ];

        // Set items data - organized by level/tier
        const highLevelSets = [
            // Immortal King's (Barbarian)
            { name: "Immortal King's Will", code: "ba5", set: "IK" },
            { name: "Immortal King's Soul Cage", code: "uar", set: "IK" },
            { name: "Immortal King's Detail", code: "uhc", set: "IK" },
            { name: "Immortal King's Forge", code: "ulg", set: "IK" },
            { name: "Immortal King's Pillar", code: "uhb", set: "IK" },
            { name: "Immortal King's Stone Crusher", code: "2ha", set: "IK" },
            // Tal Rasha's (Sorceress)
            { name: "Tal Rasha's Horadric Crest", code: "xh9", set: "TR" },
            { name: "Tal Rasha's Guardianship", code: "utp", set: "TR" },
            { name: "Tal Rasha's Fine-Spun Cloth", code: "ulc", set: "TR" },
            { name: "Tal Rasha's Lidless Eye", code: "ob9", set: "TR" },
            { name: "Tal Rasha's Adjudication", code: "amu", set: "TR" },
            // Griswold's (Paladin)
            { name: "Griswold's Valor", code: "urn", set: "Gris" },
            { name: "Griswold's Heart", code: "uar", set: "Gris" },
            { name: "Griswold's Redemption", code: "pa9", set: "Gris" },
            { name: "Griswold's Honor", code: "pa9", set: "Gris" },
            // Trang-Oul's (Necromancer)
            { name: "Trang-Oul's Guise", code: "baf", set: "TO" },
            { name: "Trang-Oul's Scales", code: "uui", set: "TO" },
            { name: "Trang-Oul's Wing", code: "paf", set: "TO" },
            { name: "Trang-Oul's Claws", code: "uvg", set: "TO" },
            { name: "Trang-Oul's Girth", code: "uvc", set: "TO" },
            // M'avina's (Amazon)
            { name: "M'avina's True Sight", code: "ci3", set: "Mav" },
            { name: "M'avina's Embrace", code: "uea", set: "Mav" },
            { name: "M'avina's Icy Clutch", code: "ulg", set: "Mav" },
            { name: "M'avina's Tenet", code: "umc", set: "Mav" },
            { name: "M'avina's Caster", code: "6lw", set: "Mav" },
            // Natalya's (Assassin)
            { name: "Natalya's Totem", code: "ba7", set: "Nat" },
            { name: "Natalya's Shadow", code: "utp", set: "Nat" },
            { name: "Natalya's Mark", code: "7wc", set: "Nat" },
            { name: "Natalya's Soul", code: "uhb", set: "Nat" },
            // Aldur's (Druid)
            { name: "Aldur's Stony Gaze", code: "dr5", set: "Ald" },
            { name: "Aldur's Deception", code: "utp", set: "Ald" },
            { name: "Aldur's Rhythm", code: "7sc", set: "Ald" },
            { name: "Aldur's Advance", code: "utb", set: "Ald" },
            // The Disciple
            { name: "Laying of Hands", code: "xlg", set: "Disciple" },
            { name: "Rite of Passage", code: "utb", set: "Disciple" },
            { name: "Dark Adherent", code: "utp", set: "Disciple" },
            { name: "Credendum", code: "umc", set: "Disciple" },
            { name: "Telling of Beads", code: "amu", set: "Disciple" },
            // Sazabi's
            { name: "Sazabi's Mental Sheath", code: "xlm", set: "Sazabi" },
            { name: "Sazabi's Ghost Liberator", code: "7cr", set: "Sazabi" },
            { name: "Sazabi's Cobalt Redeemer", code: "paf", set: "Sazabi" },
            // Bul-Kathos'
            { name: "Bul-Kathos' Sacred Charge", code: "7fb", set: "BK" },
            { name: "Bul-Kathos' Tribal Guardian", code: "7fb", set: "BK" },
        ];

        const midLevelSets = [
            // Hwanin's Majesty
            { name: "Hwanin's Splendor", code: "xhl", set: "Hwanin" },
            { name: "Hwanin's Refuge", code: "xtp", set: "Hwanin" },
            { name: "Hwanin's Blessing", code: "zhb", set: "Hwanin" },
            { name: "Hwanin's Justice", code: "9bl", set: "Hwanin" },
            // Naj's Ancient Vestige
            { name: "Naj's Circlet", code: "ci1", set: "Naj" },
            { name: "Naj's Light Plate", code: "xar", set: "Naj" },
            { name: "Naj's Puzzler", code: "6ss", set: "Naj" },
            // Orphan's Call
            { name: "Guillaume's Face", code: "xlm", set: "Orphan" },
            { name: "Whitstan's Guard", code: "paf", set: "Orphan" },
            { name: "Magnus' Skin", code: "xng", set: "Orphan" },
            { name: "Wilhelm's Pride", code: "zhb", set: "Orphan" },
            // Sander's Folly
            { name: "Sander's Paragon", code: "cap", set: "Sander" },
            { name: "Sander's Riprap", code: "hbt", set: "Sander" },
            { name: "Sander's Taboo", code: "vgl", set: "Sander" },
            { name: "Sander's Superstition", code: "9wn", set: "Sander" },
            // Cow King's Leathers
            { name: "Cow King's Horns", code: "xap", set: "Cow" },
            { name: "Cow King's Hide", code: "xtu", set: "Cow" },
            { name: "Cow King's Hooves", code: "xhb", set: "Cow" },
            // Heaven's Brethren
            { name: "Dangoon's Teaching", code: "7ma", set: "Brethren" },
            { name: "Taebaek's Glory", code: "xhb", set: "Brethren" },
            { name: "Haemosu's Adamant", code: "xar", set: "Brethren" },
            { name: "Ondal's Almighty", code: "9sp", set: "Brethren" },
        ];

        const lowLevelSets = [
            // Angelic Raiment
            { name: "Angelic Halo", code: "rin", set: "Angelic" },
            { name: "Angelic Wings", code: "amu", set: "Angelic" },
            { name: "Angelic Sickle", code: "sbr", set: "Angelic" },
            { name: "Angelic Mantle", code: "rng", set: "Angelic" },
            // Arcanna's Tricks
            { name: "Arcanna's Head", code: "skp", set: "Arcanna" },
            { name: "Arcanna's Flesh", code: "ltp", set: "Arcanna" },
            { name: "Arcanna's Deathwand", code: "wnd", set: "Arcanna" },
            { name: "Arcanna's Sign", code: "amu", set: "Arcanna" },
            // Arctic Gear
            { name: "Arctic Horn", code: "ci0", set: "Arctic" },
            { name: "Arctic Furs", code: "qui", set: "Arctic" },
            { name: "Arctic Binding", code: "lbl", set: "Arctic" },
            { name: "Arctic Mitts", code: "lgl", set: "Arctic" },
            // Berserker's Arsenal
            { name: "Berserker's Headgear", code: "hlm", set: "Berserker" },
            { name: "Berserker's Hauberk", code: "spl", set: "Berserker" },
            { name: "Berserker's Hatchet", code: "2ax", set: "Berserker" },
            // Cathan's Traps
            { name: "Cathan's Visage", code: "msk", set: "Cathan" },
            { name: "Cathan's Mesh", code: "chn", set: "Cathan" },
            { name: "Cathan's Rule", code: "sst", set: "Cathan" },
            { name: "Cathan's Sigil", code: "amu", set: "Cathan" },
            { name: "Cathan's Seal", code: "rin", set: "Cathan" },
            // Civerb's Vestments
            { name: "Civerb's Cudgel", code: "gsc", set: "Civerb" },
            { name: "Civerb's Icon", code: "amu", set: "Civerb" },
            { name: "Civerb's Ward", code: "lrg", set: "Civerb" },
            // Cleglaw's Brace
            { name: "Cleglaw's Tooth", code: "lsd", set: "Cleglaw" },
            { name: "Cleglaw's Claw", code: "sml", set: "Cleglaw" },
            { name: "Cleglaw's Pincers", code: "mgl", set: "Cleglaw" },
            // Death's Disguise
            { name: "Death's Touch", code: "lea", set: "Death" },
            { name: "Death's Guard", code: "tgl", set: "Death" },
            { name: "Death's Hand", code: "hgl", set: "Death" },
            // Hsarus' Defense
            { name: "Hsarus' Iron Heel", code: "chn", set: "Hsarus" },
            { name: "Hsarus' Iron Fist", code: "vbt", set: "Hsarus" },
            { name: "Hsarus' Iron Stay", code: "vbl", set: "Hsarus" },
            // Infernal Tools
            { name: "Infernal Cranium", code: "cap", set: "Infernal" },
            { name: "Infernal Torch", code: "9wn", set: "Infernal" },
            { name: "Infernal Sign", code: "7tw", set: "Infernal" },
            // Iratha's Finery
            { name: "Iratha's Coil", code: "crn", set: "Iratha" },
            { name: "Iratha's Cuff", code: "lgl", set: "Iratha" },
            { name: "Iratha's Cord", code: "lbl", set: "Iratha" },
            { name: "Iratha's Collar", code: "amu", set: "Iratha" },
            // Isenhart's Armory
            { name: "Isenhart's Horns", code: "fhl", set: "Isenhart" },
            { name: "Isenhart's Case", code: "brs", set: "Isenhart" },
            { name: "Isenhart's Parry", code: "spk", set: "Isenhart" },
            { name: "Isenhart's Lightbrand", code: "bsw", set: "Isenhart" },
            // Milabrega's Regalia
            { name: "Milabrega's Diadem", code: "crn", set: "Milabrega" },
            { name: "Milabrega's Robe", code: "aar", set: "Milabrega" },
            { name: "Milabrega's Orb", code: "pa8", set: "Milabrega" },
            { name: "Milabrega's Rod", code: "wsp", set: "Milabrega" },
            // Sigon's Complete Steel
            { name: "Sigon's Visor", code: "ghm", set: "Sigon" },
            { name: "Sigon's Shelter", code: "gth", set: "Sigon" },
            { name: "Sigon's Guard", code: "tow", set: "Sigon" },
            { name: "Sigon's Gage", code: "hgl", set: "Sigon" },
            { name: "Sigon's Sabot", code: "hbt", set: "Sigon" },
            { name: "Sigon's Wrap", code: "hbl", set: "Sigon" },
            // Tancred's Battlegear
            { name: "Tancred's Skull", code: "bwn", set: "Tancred" },
            { name: "Tancred's Spine", code: "ful", set: "Tancred" },
            { name: "Tancred's Hobnails", code: "tbt", set: "Tancred" },
            { name: "Tancred's Weird", code: "amu", set: "Tancred" },
            { name: "Tancred's Crowbill", code: "mpi", set: "Tancred" },
            // Vidala's Rig
            { name: "Vidala's Barb", code: "amu", set: "Vidala" },
            { name: "Vidala's Fetlock", code: "lbt", set: "Vidala" },
            { name: "Vidala's Ambush", code: "lea", set: "Vidala" },
            { name: "Vidala's Snare", code: "lbw", set: "Vidala" },
        ];

        // Magic items data
        const magicJewelry = [
            { name: "Magic Amulets (ILVL 82+)", code: "amu", minIlvl: 82, desc: "High-level crafting/gambling" },
            { name: "Magic Amulets (ILVL 60-81)", code: "amu", minIlvl: 60, maxIlvl: 81, desc: "Mid-level amulets" },
            { name: "Magic Amulets (ILVL <60)", code: "amu", maxIlvl: 59, desc: "Low-level amulets" },
            { name: "Magic Rings (ILVL 71+)", code: "rin", minIlvl: 71, desc: "High-level crafting" },
            { name: "Magic Rings (ILVL 42-70)", code: "rin", minIlvl: 42, maxIlvl: 70, desc: "Mid-level rings" },
            { name: "Magic Rings (ILVL <42)", code: "rin", maxIlvl: 41, desc: "Low-level rings" },
            { name: "Magic Jewels", code: "jew", desc: "All magic jewels" },
        ];

        const magicCharms = [
            { name: "Grand Charms (ILVL 78+)", code: "cm3", minIlvl: 78, desc: "High-level skillers" },
            { name: "Grand Charms (ILVL 50-77)", code: "cm3", minIlvl: 50, maxIlvl: 77, desc: "Skiller range" },
            { name: "Grand Charms (ILVL <50)", code: "cm3", maxIlvl: 49, desc: "Low-level grands" },
            { name: "Large Charms (ILVL 80+)", code: "cm2", minIlvl: 80, desc: "High-level" },
            { name: "Large Charms (ILVL <80)", code: "cm2", maxIlvl: 79, desc: "Lower-level" },
            { name: "Small Charms (ILVL 90+)", code: "cm1", minIlvl: 90, desc: "Perfect stat range" },
            { name: "Small Charms (ILVL 48-89)", code: "cm1", minIlvl: 48, maxIlvl: 89, desc: "Good stat range" },
            { name: "Small Charms (ILVL <48)", code: "cm1", maxIlvl: 47, desc: "Low-level" },
        ];

        const magicCraftingBases = [
            { name: "Vampirebone Gloves (ILVL 85+)", code: "vgl", minIlvl: 85, desc: "Crafting Base" },
            { name: "Sharkskin Gloves (ILVL 85+)", code: "xvg", minIlvl: 85, desc: "Crafting Base" },
            { name: "Bramble Mitts (ILVL 85+)", code: "uvg", minIlvl: 85, desc: "Crafting Base" },
            { name: "Chain Gloves (ILVL 85+)", code: "mgl", minIlvl: 85, desc: "Crafting Base" },
            { name: "Heavy Bracers (ILVL 85+)", code: "xmg", minIlvl: 85, desc: "Crafting Base" },
            { name: "Vambraces (ILVL 85+)", code: "umg", minIlvl: 85, desc: "Crafting Base" },
            { name: "Demonhide Gloves (ILVL 85+)", code: "xlg", minIlvl: 85, desc: "Crafting Base" },
            { name: "Wyrmhide Boots (ILVL 85+)", code: "ulb", minIlvl: 85, desc: "Crafting Base" },
            { name: "Demonhide Boots (ILVL 85+)", code: "xlb", minIlvl: 85, desc: "Crafting Base" },
            { name: "Battle Boots (ILVL 85+)", code: "tbt", minIlvl: 85, desc: "Crafting Base" },
            { name: "Scarabshell Boots (ILVL 85+)", code: "xtb", minIlvl: 85, desc: "Crafting Base" },
            { name: "Boneweave Boots (ILVL 85+)", code: "utb", minIlvl: 85, desc: "Crafting Base" },
            { name: "Vampirefang Belt (ILVL 85+)", code: "uvc", minIlvl: 85, desc: "Crafting Base" },
            { name: "Mithril Coil (ILVL 85+)", code: "zmb", minIlvl: 85, desc: "Crafting Base" },
            { name: "Mesh Belt (ILVL 85+)", code: "umc", minIlvl: 85, desc: "Crafting Base" },
            { name: "Berserker Axe (ILVL 85+)", code: "72a", minIlvl: 85, desc: "Crafting Base" },
            { name: "Phase Blade (ILVL 85+)", code: "7sb", minIlvl: 85, desc: "Crafting Base" },
        ];

        // Rare items data
        const rareJewelry = [
            { name: "Rare Amulets", code: "amu", desc: "All rare amulets" },
            { name: "Rare Rings", code: "rin", desc: "All rare rings" },
            { name: "Rare Jewels", code: "jew", desc: "All rare jewels" },
        ];

        const rareClassItems = [
            { name: "Circlets (All)", code: "EQ7", desc: "All circlets/coronets/tiaras" },
            { name: "Claws (ILVL 50+)", code: "CL5", minIlvl: 50, desc: "Assassin claws" },
            { name: "Orbs (ILVL 50+)", code: "WP11", minIlvl: 50, desc: "Sorceress orbs" },
            { name: "Javelins (ILVL 56+)", code: "7ja", minIlvl: 56, desc: "Elite javelins" },
            { name: "Matriarchal Javelin (ILVL 56+)", code: "jav", minIlvl: 56, desc: "Elite javelin" },
            { name: "Bows (ILVL 56+)", code: "7wa", minIlvl: 56, desc: "Elite bows" },
            { name: "Matriarchal Bow (ILVL 56+)", code: "wax", minIlvl: 56, desc: "Elite bow" },
            { name: "Paladin Shields (Elite)", code: "CL3", tier: "elite", desc: "Elite paladin shields" },
        ];

        const rareEliteBases = [
            { name: "Elite Gloves (ILVL 50+)", code: "EQ4", tier: "elite", minIlvl: 50, desc: "Elite gloves" },
            { name: "Elite Boots (ILVL 50+)", code: "EQ5", tier: "elite", minIlvl: 50, desc: "Elite boots" },
            { name: "Elite Belts (ILVL 50+)", code: "EQ6", tier: "elite", minIlvl: 50, desc: "Elite belts" },
            { name: "Elite Helms (ILVL 50+)", code: "EQ1", tier: "elite", minIlvl: 50, desc: "Elite helms" },
            { name: "Elite Armors (ILVL 50+)", code: "EQ2", tier: "elite", minIlvl: 50, desc: "Elite body armor" },
            { name: "Elite Shields (ILVL 50+)", code: "EQ3", tier: "elite", minIlvl: 50, desc: "Elite shields" },
        ];

        // NMAG Runeword Bases
        const nmagPolearms = [
            { name: "Thresher", code: "7s8", quality: "elite", max_sockets: 5 },
            { name: "Giant Thresher", code: "7wc", quality: "elite", max_sockets: 6 },
            { name: "Cryptic Axe", code: "7pa", quality: "elite", max_sockets: 5 },
            { name: "Mancatcher", code: "7br", quality: "elite", max_sockets: 5 },
            { name: "Colossus Voulge", code: "7vo", quality: "elite", max_sockets: 4 },
            { name: "Great Poleaxe", code: "7h7", quality: "elite", max_sockets: 6 },
            { name: "Poleaxe", code: "pax", quality: "normal", max_sockets: 5 },
            { name: "Scythe", code: "scy", quality: "normal", max_sockets: 5 },
            { name: "Halberd", code: "hal", quality: "normal", max_sockets: 6 },
            { name: "War Scythe", code: "wsc", quality: "normal", max_sockets: 6 },
            { name: "Bill", code: "9vo", quality: "exceptional", max_sockets: 4 },
            { name: "Battle Scythe", code: "9s8", quality: "exceptional", max_sockets: 5 },
            { name: "Partizan", code: "9pa", quality: "exceptional", max_sockets: 5 },
            { name: "Bec-de-Corbin", code: "9h9", quality: "exceptional", max_sockets: 6 },
            { name: "War Pike", code: "7p7", quality: "elite", max_sockets: 6 },
            { name: "Ghost Spear", code: "7st", quality: "elite", max_sockets: 6 },
            { name: "Stygian Pike", code: "7tr", quality: "elite", max_sockets: 4 },
            { name: "Pike", code: "pik", quality: "normal", max_sockets: 6 },
            { name: "Lance", code: "9p9", quality: "exceptional", max_sockets: 6 },
            { name: "War Fork", code: "9br", quality: "exceptional", max_sockets: 5 },
            { name: "Fuscina", code: "9tr", quality: "exceptional", max_sockets: 4 },
            { name: "Brandistock", code: "brn", quality: "normal", max_sockets: 5 },
            { name: "Matriarchal Spear", code: "amd", quality: "elite", max_sockets: 6 },
        ];

        const nmagSwords = [
            { name: "Phase Blade", code: "7cr", quality: "elite", max_sockets: 6 },
            { name: "Colossus Blade", code: "7gd", quality: "elite", max_sockets: 6 },
            { name: "Colossus Sword", code: "7fb", quality: "elite", max_sockets: 5 },
            { name: "Crystal Sword", code: "crs", quality: "normal", max_sockets: 6 },
            { name: "Broad Sword", code: "bsd", quality: "normal", max_sockets: 4 },
            { name: "Long Sword", code: "lsd", quality: "normal", max_sockets: 4 },
            { name: "Legend Sword", code: "72h", quality: "elite", max_sockets: 3 },
            { name: "Cryptic Sword", code: "7ls", quality: "elite", max_sockets: 4 },
            { name: "Conquest Sword", code: "7bs", quality: "elite", max_sockets: 4 },
            { name: "Dimensional Blade", code: "9cr", quality: "exceptional", max_sockets: 6 },
            { name: "Mythical Sword", code: "7wd", quality: "elite", max_sockets: 3 },
            { name: "Highland Blade", code: "7cm", quality: "elite", max_sockets: 4 },
            { name: "Balrog Blade", code: "7gs", quality: "elite", max_sockets: 4 },
            { name: "War Sword", code: "wsd", quality: "normal", max_sockets: 3 },
            { name: "Rune Sword", code: "9ls", quality: "exceptional", max_sockets: 4 },
            { name: "Claymore", code: "clm", quality: "normal", max_sockets: 4 },
            { name: "Champion Sword", code: "7b7", quality: "elite", max_sockets: 4 },
        ];

        const nmagAxes = [
            { name: "Berserker Axe", code: "7wa", quality: "elite", max_sockets: 6 },
            { name: "Ettin Axe", code: "72a", quality: "elite", max_sockets: 5 },
            { name: "Double Axe", code: "2ax", quality: "normal", max_sockets: 5 },
            { name: "War Axe", code: "wax", quality: "normal", max_sockets: 6 },
            { name: "Small Crescent", code: "7ax", quality: "elite", max_sockets: 4 },
            { name: "Glorious Axe", code: "7gi", quality: "elite", max_sockets: 6 },
            { name: "Military Pick", code: "mpi", quality: "normal", max_sockets: 6 },
            { name: "War Spike", code: "7mp", quality: "elite", max_sockets: 6 },
        ];

        const nmagMaces = [
            { name: "Thunder Maul", code: "7gm", quality: "elite", max_sockets: 6 },
            { name: "Scourge", code: "7fl", quality: "elite", max_sockets: 5 },
            { name: "Flail", code: "fla", quality: "normal", max_sockets: 5 },
            { name: "Legendary Mallet", code: "7wh", quality: "elite", max_sockets: 4 },
            { name: "Knout", code: "9fl", quality: "exceptional", max_sockets: 5 },
            { name: "Morning Star", code: "mst", quality: "normal", max_sockets: 3 },
            { name: "War Hammer", code: "whm", quality: "normal", max_sockets: 4 },
        ];

        const nmagStaves = [
            { name: "Archon Staff", code: "6ws", quality: "elite", max_sockets: 6 },
            { name: "War Staff", code: "wst", quality: "normal", max_sockets: 6 },
            { name: "Gnarled Staff", code: "cst", quality: "normal", max_sockets: 4 },
            { name: "Cedar Staff", code: "8cs", quality: "exceptional", max_sockets: 4 },
            { name: "Battle Staff", code: "bst", quality: "normal", max_sockets: 4 },
            { name: "Elder Staff", code: "6cs", quality: "elite", max_sockets: 4 },
            { name: "Gothic Staff", code: "8bs", quality: "exceptional", max_sockets: 4 },
            { name: "Shillelagh", code: "6bs", quality: "elite", max_sockets: 4 },
            { name: "Rune Staff", code: "8ws", quality: "exceptional", max_sockets: 6 },
            { name: "Jo Staff", code: "8ss", quality: "exceptional", max_sockets: 2 },
        ];

        const nmagSpears = [
            { name: "War Pike", code: "7p7", quality: "elite", max_sockets: 6 },
            { name: "Ghost Spear", code: "7st", quality: "elite", max_sockets: 6 },
            { name: "Stygian Pike", code: "7tr", quality: "elite", max_sockets: 4 },
            { name: "Lance", code: "9p9", quality: "exceptional", max_sockets: 6 },
            { name: "Pike", code: "pik", quality: "normal", max_sockets: 6 },
            { name: "Fuscina", code: "9tr", quality: "exceptional", max_sockets: 4 },
            { name: "War Fork", code: "9br", quality: "exceptional", max_sockets: 5 },
            { name: "Brandistock", code: "brn", quality: "normal", max_sockets: 5 },
            { name: "Matriarchal Spear", code: "amd", quality: "elite", max_sockets: 6 },
        ];

        const nmagBows = [
            { name: "Matriarchal Bow", code: "amb", quality: "elite", max_sockets: 5 },
            { name: "Grand Matron Bow", code: "amc", quality: "elite", max_sockets: 5 },
            { name: "Hydra Bow", code: "6lw", quality: "elite", max_sockets: 6 },
            { name: "Crusader Bow", code: "6l7", quality: "elite", max_sockets: 6 },
            { name: "Short Bow", code: "sbw", quality: "normal", max_sockets: 3 },
            { name: "Great Bow", code: "6cb", quality: "elite", max_sockets: 4 },
            { name: "Blade Bow", code: "6hb", quality: "elite", max_sockets: 4 },
            { name: "Hunters Bow", code: "hbw", quality: "normal", max_sockets: 4 },
            { name: "Long Bow", code: "lbw", quality: "normal", max_sockets: 5 },
            { name: "Demon Crossbow", code: "6rx", quality: "elite", max_sockets: 5 },
            { name: "Composite Bow", code: "cbw", quality: "normal", max_sockets: 4 },
            { name: "Diamond Bow", code: "6s7", quality: "elite", max_sockets: 5 },
            { name: "Short Battle Bow", code: "sbb", quality: "normal", max_sockets: 5 },
            { name: "Shadow Bow", code: "6lb", quality: "elite", max_sockets: 5 },
            { name: "Long Battle Bow", code: "lbb", quality: "normal", max_sockets: 6 },
            { name: "Razor Bow", code: "8hb", quality: "exceptional", max_sockets: 4 },
            { name: "Reflex Bow", code: "am2", quality: "normal", max_sockets: 5 },
            { name: "Stag Bow", code: "am1", quality: "normal", max_sockets: 5 },
            { name: "Edge Bow", code: "8sb", quality: "exceptional", max_sockets: 3 },
            { name: "Short Siege Bow", code: "8s8", quality: "exceptional", max_sockets: 5 },
            { name: "Cedar Bow", code: "8lb", quality: "exceptional", max_sockets: 5 },
            { name: "Gothic Bow", code: "8lw", quality: "exceptional", max_sockets: 6 },
            { name: "Crossbow", code: "mxb", quality: "normal", max_sockets: 4 },
            { name: "Chu-Ko-Nu", code: "8rx", quality: "exceptional", max_sockets: 5 },
            { name: "Rune Bow", code: "8sw", quality: "exceptional", max_sockets: 5 },
            { name: "Short War Bow", code: "swb", quality: "normal", max_sockets: 5 },
            { name: "Double Bow", code: "8cb", quality: "exceptional", max_sockets: 4 },
            { name: "Ward Bow", code: "6sw", quality: "elite", max_sockets: 5 },
            { name: "Colossus Crossbow", code: "6hx", quality: "elite", max_sockets: 6 },
            { name: "Gorgon Crossbow", code: "6mx", quality: "elite", max_sockets: 4 },
        ];

        // Armor (Light + Heavy combined) from nmag-list.txt
        const nmagArmor = [
            { name: "Archon Plate", code: "utp", quality: "elite", max_sockets: 4 },
            { name: "Mage Plate", code: "xtp", quality: "exceptional", max_sockets: 3 },
            { name: "Dusk Shroud", code: "uui", quality: "elite", max_sockets: 4 },
            { name: "Wire Fleece", code: "utu", quality: "elite", max_sockets: 4 },
            { name: "Great Hauberk", code: "urs", quality: "elite", max_sockets: 4 },
            { name: "Sacred Armor", code: "uar", quality: "elite", max_sockets: 4 },
            { name: "Boneweave", code: "uhn", quality: "elite", max_sockets: 4 },
            { name: "Wyrmhide", code: "uea", quality: "elite", max_sockets: 4 },
            { name: "Loricated Mail", code: "ucl", quality: "elite", max_sockets: 4 },
            { name: "Balrog Skin", code: "upl", quality: "elite", max_sockets: 4 },
            { name: "Lacquered Plate", code: "uth", quality: "elite", max_sockets: 4 },
            { name: "Scarab Husk", code: "ula", quality: "elite", max_sockets: 4 },
            { name: "Hellforge Plate", code: "ult", quality: "elite", max_sockets: 4 },
            { name: "Kraken Shell", code: "uld", quality: "elite", max_sockets: 4 },
            { name: "Diamond Mail", code: "ung", quality: "elite", max_sockets: 4 },
            { name: "Shadow Plate", code: "uul", quality: "elite", max_sockets: 4 },
            { name: "Tigulated Mail", code: "xcl", quality: "exceptional", max_sockets: 3 },
            { name: "Cuirass", code: "xrs", quality: "exceptional", max_sockets: 3 },
            { name: "Breast Plate", code: "brs", quality: "normal", max_sockets: 3 },
            { name: "Ancient Armor", code: "aar", quality: "normal", max_sockets: 4 },
            { name: "Sharktooth Armor", code: "xld", quality: "exceptional", max_sockets: 3 },
            { name: "Ornate Plate", code: "xar", quality: "exceptional", max_sockets: 4 },
            { name: "Ring Mail", code: "rng", quality: "normal", max_sockets: 3 },
            { name: "Trellised Armor", code: "xtu", quality: "exceptional", max_sockets: 2 },
            { name: "Hard Leather Armor", code: "hla", quality: "normal", max_sockets: 2 },
            { name: "Gothic Plate", code: "gth", quality: "normal", max_sockets: 4 },
            { name: "Chaos Armor", code: "xul", quality: "exceptional", max_sockets: 4 },
        ];

        const nmagShieldsGeneric = [
            { name: "Monarch", code: "uit", quality: "elite", max_sockets: 4 },
            { name: "Bone Shield", code: "bsh", quality: "normal", max_sockets: 2 },
            { name: "Grim Shield", code: "xsh", quality: "exceptional", max_sockets: 2 },
            { name: "Heraldic Shield", code: "pa3", quality: "normal", max_sockets: 4 },
            { name: "Aerin Shield", code: "pa4", quality: "normal", max_sockets: 4 },
            { name: "Kite Shield", code: "kit", quality: "normal", max_sockets: 3 },
            { name: "Small Shield", code: "sml", quality: "normal", max_sockets: 2 },
            { name: "Hyperion", code: "urg", quality: "elite", max_sockets: 3 },
            { name: "Large Shield", code: "lrg", quality: "normal", max_sockets: 3 },
            { name: "Troll Nest", code: "ush", quality: "elite", max_sockets: 3 },
            { name: "Crown Shield", code: "pa5", quality: "normal", max_sockets: 4 },
            { name: "Dragon Shield", code: "xit", quality: "exceptional", max_sockets: 3 },
            { name: "Gothic Shield", code: "gts", quality: "normal", max_sockets: 3 },
            { name: "Heater", code: "uuc", quality: "elite", max_sockets: 2 },
        ];

        const nmagShieldsPaladin = [
            { name: "Sacred Targe", code: "pab", quality: "elite", max_sockets: 4 },
            { name: "Sacred Rondache", code: "pac", quality: "elite", max_sockets: 4 },
            { name: "Kurast Shield", code: "pad", quality: "elite", max_sockets: 4 },
            { name: "Zakarum Shield", code: "pae", quality: "elite", max_sockets: 4 },
            { name: "Vortex Shield", code: "paf", quality: "elite", max_sockets: 4 },
            { name: "Akaran Targe", code: "pa6", quality: "exceptional", max_sockets: 4 },
            { name: "Royal Shield", code: "paa", quality: "exceptional", max_sockets: 4 },
            { name: "Protector Shield", code: "pa8", quality: "exceptional", max_sockets: 4 },
            { name: "Gilded Shield", code: "pa9", quality: "exceptional", max_sockets: 4 },
            { name: "Rondache", code: "pa2", quality: "normal", max_sockets: 4 },
            { name: "Akaran Rondache", code: "pa7", quality: "exceptional", max_sockets: 4 },
            { name: "Targe", code: "pa1", quality: "normal", max_sockets: 4 },
        ];

        const nmagHelms = [
            { name: "Demonhead", code: "usk", quality: "elite", max_sockets: 3 },
            { name: "Bone Visage", code: "uh9", quality: "elite", max_sockets: 3 },
            { name: "Mask", code: "msk", quality: "normal", max_sockets: 3 },
            { name: "Diadem", code: "ci3", quality: "elite", max_sockets: 3 },
            { name: "Grand Crown", code: "xrn", quality: "exceptional", max_sockets: 3 },
            { name: "Tiara", code: "ci2", quality: "exceptional", max_sockets: 3 },
            { name: "Corona", code: "urn", quality: "elite", max_sockets: 3 },
            { name: "Cap", code: "cap", quality: "normal", max_sockets: 2 },
            { name: "Crown", code: "crn", quality: "normal", max_sockets: 3 },
            { name: "Great Helm", code: "ghm", quality: "normal", max_sockets: 3 },
            { name: "Death Mask", code: "xsk", quality: "exceptional", max_sockets: 3 },
            { name: "Bone Helm", code: "bhm", quality: "normal", max_sockets: 2 },
            { name: "Basinet", code: "xhl", quality: "exceptional", max_sockets: 2 },
            { name: "Helm", code: "hlm", quality: "normal", max_sockets: 2 },
        ];

        const nmagDruidPelts = [
            { name: "Wolf Head", code: "dr1", quality: "normal", max_sockets: 3 },
            { name: "Hawk Helm", code: "dr2", quality: "normal", max_sockets: 3 },
            { name: "Antlers", code: "dr3", quality: "normal", max_sockets: 3 },
            { name: "Falcon Mask", code: "dr4", quality: "normal", max_sockets: 3 },
            { name: "Spirit Mask", code: "dr5", quality: "normal", max_sockets: 3 },
            { name: "Alpha Helm", code: "dr6", quality: "exceptional", max_sockets: 3 },
            { name: "Griffon Headdress", code: "dr7", quality: "exceptional", max_sockets: 3 },
            { name: "Hunters Guise", code: "dr8", quality: "exceptional", max_sockets: 3 },
            { name: "Sacred Feathers", code: "dr9", quality: "exceptional", max_sockets: 3 },
            { name: "Totemic Mask", code: "dra", quality: "exceptional", max_sockets: 3 },
            { name: "Blood Spirit", code: "drb", quality: "elite", max_sockets: 3 },
            { name: "Sun Spirit", code: "drc", quality: "elite", max_sockets: 3 },
            { name: "Earth Spirit", code: "drd", quality: "elite", max_sockets: 3 },
            { name: "Sky Spirit", code: "dre", quality: "elite", max_sockets: 3 },
        ];

        const nmagNecroHeads = [
            { name: "Preserved Head", code: "ne1", quality: "normal", max_sockets: 2 },
            { name: "Zombie Head", code: "ne2", quality: "normal", max_sockets: 2 },
            { name: "Unraveller Head", code: "ne3", quality: "normal", max_sockets: 2 },
            { name: "Gargoyle Head", code: "ne4", quality: "normal", max_sockets: 2 },
            { name: "Demon Head", code: "ne5", quality: "normal", max_sockets: 2 },
            { name: "Mummified Trophy", code: "ne6", quality: "exceptional", max_sockets: 2 },
            { name: "Fetish Trophy", code: "ne7", quality: "exceptional", max_sockets: 2 },
            { name: "Sexton Trophy", code: "ne8", quality: "exceptional", max_sockets: 2 },
            { name: "Cantor Trophy", code: "ne9", quality: "exceptional", max_sockets: 2 },
            { name: "Hierophant Trophy", code: "nea", quality: "exceptional", max_sockets: 2 },
            { name: "Minion Skull", code: "neb", quality: "elite", max_sockets: 2 },
            { name: "Overseer Skull", code: "ned", quality: "elite", max_sockets: 2 },
            { name: "Succubae Skull", code: "nee", quality: "elite", max_sockets: 2 },
            { name: "Bloodlord Skull", code: "nef", quality: "elite", max_sockets: 2 },
            { name: "Hellspawn Skull", code: "neg", quality: "elite", max_sockets: 2 },
        ];

        const nmagAssassinClaws = [
            { name: "Katar", code: "ktr", quality: "normal", max_sockets: 2 },
            { name: "Wrist Blade", code: "wrb", quality: "normal", max_sockets: 2 },
            { name: "Hatchet Hands", code: "axf", quality: "normal", max_sockets: 2 },
            { name: "Cestus", code: "ces", quality: "normal", max_sockets: 2 },
            { name: "Claws", code: "clw", quality: "normal", max_sockets: 3 },
            { name: "Blade Talons", code: "btl", quality: "normal", max_sockets: 3 },
            { name: "Scissors Katar", code: "skr", quality: "normal", max_sockets: 3 },
            { name: "Quhab", code: "9ar", quality: "exceptional", max_sockets: 3 },
            { name: "Wrist Spike", code: "9wb", quality: "exceptional", max_sockets: 2 },
            { name: "Fascia", code: "9xf", quality: "exceptional", max_sockets: 2 },
            { name: "Hand Scythe", code: "9cs", quality: "exceptional", max_sockets: 2 },
            { name: "Greater Claws", code: "9lw", quality: "exceptional", max_sockets: 3 },
            { name: "Greater Talons", code: "9tw", quality: "exceptional", max_sockets: 3 },
            { name: "Scissors Quhab", code: "9qr", quality: "exceptional", max_sockets: 3 },
            { name: "Suwayyah", code: "7ar", quality: "elite", max_sockets: 3 },
            { name: "Wrist Sword", code: "7wb", quality: "elite", max_sockets: 3 },
            { name: "War Fist", code: "7xf", quality: "elite", max_sockets: 2 },
            { name: "Battle Cestus", code: "7cs", quality: "elite", max_sockets: 2 },
            { name: "Feral Claws", code: "7lw", quality: "elite", max_sockets: 3 },
            { name: "Runic Talons", code: "7tw", quality: "elite", max_sockets: 3 },
            { name: "Scissors Suwayyah", code: "7qr", quality: "elite", max_sockets: 3 },
        ];

        const nmagSorcOrbs = [
            { name: "Eagle Orb", code: "ob1", quality: "normal", max_sockets: 2 },
            { name: "Sacred Globe", code: "ob2", quality: "normal", max_sockets: 2 },
            { name: "Smoked Sphere", code: "ob3", quality: "normal", max_sockets: 2 },
            { name: "Clasped Orb", code: "ob4", quality: "normal", max_sockets: 2 },
            { name: "Jareds Stone", code: "ob5", quality: "normal", max_sockets: 3 },
            { name: "Glowing Orb", code: "ob6", quality: "exceptional", max_sockets: 2 },
            { name: "Crystalline Globe", code: "ob7", quality: "exceptional", max_sockets: 2 },
            { name: "Cloudy Sphere", code: "ob8", quality: "exceptional", max_sockets: 2 },
            { name: "Sparkling Ball", code: "ob9", quality: "exceptional", max_sockets: 2 },
            { name: "Swirling Crystal", code: "oba", quality: "exceptional", max_sockets: 3 },
            { name: "Heavenly Stone", code: "obb", quality: "elite", max_sockets: 2 },
            { name: "Eldritch Orb", code: "obc", quality: "elite", max_sockets: 2 },
            { name: "Demon Heart", code: "obd", quality: "elite", max_sockets: 2 },
            { name: "Vortex Orb", code: "obe", quality: "elite", max_sockets: 2 },
            { name: "Dimensional Shard", code: "obf", quality: "elite", max_sockets: 3 },
        ];

        // Extended NMAG categories - additional sockatable bases
        const nmagDaggers = [
            { name: "Dagger", code: "dgr", quality: "normal", max_sockets: 1 },
            { name: "Dirk", code: "dir", quality: "normal", max_sockets: 1 },
            { name: "Kris", code: "kri", quality: "normal", max_sockets: 3 },
            { name: "Blade", code: "bld", quality: "normal", max_sockets: 2 },
            { name: "Poignard", code: "9dg", quality: "exceptional", max_sockets: 1 },
            { name: "Rondel", code: "9di", quality: "exceptional", max_sockets: 1 },
            { name: "Cinquedeas", code: "9kr", quality: "exceptional", max_sockets: 3 },
            { name: "Stiletto", code: "9bl", quality: "exceptional", max_sockets: 2 },
            { name: "Bone Knife", code: "7dg", quality: "elite", max_sockets: 1 },
            { name: "Mithril Point", code: "7di", quality: "elite", max_sockets: 1 },
            { name: "Fanged Knife", code: "7kr", quality: "elite", max_sockets: 3 },
            { name: "Legend Spike", code: "7bl", quality: "elite", max_sockets: 2 },
        ];

        const nmagWands = [
            { name: "Wand", code: "wnd", quality: "normal", max_sockets: 1 },
            { name: "Yew Wand", code: "ywn", quality: "normal", max_sockets: 1 },
            { name: "Bone Wand", code: "bwn", quality: "normal", max_sockets: 2 },
            { name: "Grim Wand", code: "gwn", quality: "normal", max_sockets: 2 },
            { name: "Burnt Wand", code: "9wn", quality: "exceptional", max_sockets: 1 },
            { name: "Petrified Wand", code: "9yw", quality: "exceptional", max_sockets: 2 },
            { name: "Tomb Wand", code: "9bw", quality: "exceptional", max_sockets: 2 },
            { name: "Grave Wand", code: "9gw", quality: "exceptional", max_sockets: 2 },
            { name: "Polished Wand", code: "7wn", quality: "elite", max_sockets: 2 },
            { name: "Ghost Wand", code: "7yw", quality: "elite", max_sockets: 2 },
            { name: "Lich Wand", code: "7bw", quality: "elite", max_sockets: 2 },
            { name: "Unearthed Wand", code: "7gw", quality: "elite", max_sockets: 2 },
        ];

        const nmagScepters = [
            { name: "Scepter", code: "scp", quality: "normal", max_sockets: 2 },
            { name: "Grand Scepter", code: "gsc", quality: "normal", max_sockets: 3 },
            { name: "War Scepter", code: "wsp", quality: "normal", max_sockets: 5 },
            { name: "Rune Scepter", code: "9sc", quality: "exceptional", max_sockets: 2 },
            { name: "Holy Water Sprinkler", code: "9qs", quality: "exceptional", max_sockets: 3 },
            { name: "Divine Scepter", code: "9ws", quality: "exceptional", max_sockets: 5 },
            { name: "Mighty Scepter", code: "7sc", quality: "elite", max_sockets: 2 },
            { name: "Seraph Rod", code: "7qs", quality: "elite", max_sockets: 3 },
            { name: "Caduceus", code: "7ws", quality: "elite", max_sockets: 5 },
        ];

        const nmagBarbarianHelms = [
            { name: "Jawbone Cap", code: "ba1", quality: "normal", max_sockets: 3 },
            { name: "Fanged Helm", code: "ba2", quality: "normal", max_sockets: 3 },
            { name: "Horned Helm", code: "ba3", quality: "normal", max_sockets: 3 },
            { name: "Assault Helmet", code: "ba4", quality: "normal", max_sockets: 3 },
            { name: "Avenger Guard", code: "ba5", quality: "normal", max_sockets: 3 },
            { name: "Jawbone Visor", code: "ba6", quality: "exceptional", max_sockets: 3 },
            { name: "Lion Helm", code: "ba7", quality: "exceptional", max_sockets: 3 },
            { name: "Rage Mask", code: "ba8", quality: "exceptional", max_sockets: 3 },
            { name: "Savage Helmet", code: "ba9", quality: "exceptional", max_sockets: 3 },
            { name: "Slayer Guard", code: "baa", quality: "exceptional", max_sockets: 3 },
            { name: "Carnage Helm", code: "bab", quality: "elite", max_sockets: 3 },
            { name: "Fury Visor", code: "bac", quality: "elite", max_sockets: 3 },
            { name: "Destroyer Helm", code: "bad", quality: "elite", max_sockets: 3 },
            { name: "Conqueror Crown", code: "bae", quality: "elite", max_sockets: 3 },
            { name: "Guardian Crown", code: "baf", quality: "elite", max_sockets: 3 },
        ];

        // ===== Other NMAG base items to follow =====
        // Extended arrays contain all sockatable items NOT in nmag-list.txt

        const nmagPolearmsExtended = [
            { name: "Bardiche", code: "bar", quality: "normal", max_sockets: 3 },
            { name: "Voulge", code: "vou", quality: "normal", max_sockets: 4 },
            { name: "War Scythe", code: "wsc", quality: "normal", max_sockets: 6 },
            { name: "Lochaber Axe", code: "9b7", quality: "exceptional", max_sockets: 3 },
            { name: "Bill", code: "9vo", quality: "exceptional", max_sockets: 4 },
            { name: "Partizan", code: "9pa", quality: "exceptional", max_sockets: 5 },
            { name: "Grim Scythe", code: "9wc", quality: "exceptional", max_sockets: 6 },
            { name: "Ogre Axe", code: "7o7", quality: "elite", max_sockets: 3 },
        ];

        const nmagSwordsExtended = [
            { name: "Short Sword", code: "ssd", quality: "normal", max_sockets: 2 },
            { name: "Scimitar", code: "scm", quality: "normal", max_sockets: 2 },
            { name: "Saber", code: "sbr", quality: "normal", max_sockets: 2 },
            { name: "Falchion", code: "flc", quality: "normal", max_sockets: 2 },
            { name: "Two-handed Sword", code: "2hs", quality: "normal", max_sockets: 3 },
            { name: "Giant Sword", code: "gis", quality: "normal", max_sockets: 4 },
            { name: "Bastard Sword", code: "bsw", quality: "normal", max_sockets: 4 },
            { name: "Flamberge", code: "flb", quality: "normal", max_sockets: 5 },
            { name: "Great Sword", code: "gsd", quality: "normal", max_sockets: 6 },
            { name: "Gladius", code: "9ss", quality: "exceptional", max_sockets: 2 },
            { name: "Cutlass", code: "9sm", quality: "exceptional", max_sockets: 2 },
            { name: "Shamshir", code: "9sb", quality: "exceptional", max_sockets: 2 },
            { name: "Tulwar", code: "9fc", quality: "exceptional", max_sockets: 2 },
            { name: "Battle Sword", code: "9bs", quality: "exceptional", max_sockets: 4 },
            { name: "Ancient Sword", code: "9wd", quality: "exceptional", max_sockets: 3 },
            { name: "Espandon", code: "92h", quality: "exceptional", max_sockets: 3 },
            { name: "Dacian Falx", code: "9cm", quality: "exceptional", max_sockets: 4 },
            { name: "Tusk Sword", code: "9gs", quality: "exceptional", max_sockets: 4 },
            { name: "Gothic Sword", code: "9b9", quality: "exceptional", max_sockets: 4 },
            { name: "Zweihander", code: "9fb", quality: "exceptional", max_sockets: 5 },
            { name: "Executioner Sword", code: "9gd", quality: "exceptional", max_sockets: 6 },
            { name: "Falcata", code: "7ss", quality: "elite", max_sockets: 2 },
            { name: "Ataghan", code: "7sm", quality: "elite", max_sockets: 2 },
            { name: "Elegant Blade", code: "7sb", quality: "elite", max_sockets: 2 },
            { name: "Hydra Edge", code: "7fc", quality: "elite", max_sockets: 2 },
        ];

        const nmagAxesExtended = [
            { name: "Hand Axe", code: "hax", quality: "normal", max_sockets: 2 },
            { name: "Axe", code: "axe", quality: "normal", max_sockets: 4 },
            { name: "Military Pick", code: "mpi", quality: "normal", max_sockets: 6 },
            { name: "Large Axe", code: "lax", quality: "normal", max_sockets: 4 },
            { name: "Broad Axe", code: "bax", quality: "normal", max_sockets: 5 },
            { name: "Battle Axe", code: "btx", quality: "normal", max_sockets: 5 },
            { name: "Great Axe", code: "gax", quality: "normal", max_sockets: 6 },
            { name: "Giant Axe", code: "gix", quality: "normal", max_sockets: 6 },
            { name: "Hatchet", code: "9ha", quality: "exceptional", max_sockets: 2 },
            { name: "Cleaver", code: "9ax", quality: "exceptional", max_sockets: 4 },
            { name: "Twin Axe", code: "92a", quality: "exceptional", max_sockets: 5 },
            { name: "Crowbill", code: "9mp", quality: "exceptional", max_sockets: 6 },
            { name: "Naga", code: "9wa", quality: "exceptional", max_sockets: 6 },
            { name: "Military Axe", code: "9la", quality: "exceptional", max_sockets: 4 },
            { name: "Bearded Axe", code: "9ba", quality: "exceptional", max_sockets: 5 },
            { name: "Tabar", code: "9bt", quality: "exceptional", max_sockets: 5 },
            { name: "Gothic Axe", code: "9ga", quality: "exceptional", max_sockets: 6 },
            { name: "Ancient Axe", code: "9gi", quality: "exceptional", max_sockets: 6 },
            { name: "Tomahawk", code: "7ha", quality: "elite", max_sockets: 2 },
            { name: "Small Crescent", code: "7ax", quality: "elite", max_sockets: 4 },
            { name: "War Spike", code: "7mp", quality: "elite", max_sockets: 6 },
            { name: "Feral Axe", code: "7la", quality: "elite", max_sockets: 4 },
            { name: "Silver Edged Axe", code: "7ba", quality: "elite", max_sockets: 5 },
            { name: "Decapitator", code: "7bt", quality: "elite", max_sockets: 5 },
            { name: "Champion Axe", code: "7ga", quality: "elite", max_sockets: 6 },
        ];

        const nmagMacesExtended = [
            { name: "Club", code: "clb", quality: "normal", max_sockets: 2 },
            { name: "Spiked Club", code: "spc", quality: "normal", max_sockets: 2 },
            { name: "Mace", code: "mac", quality: "normal", max_sockets: 2 },
            { name: "Maul", code: "mau", quality: "normal", max_sockets: 6 },
            { name: "Great Maul", code: "gma", quality: "normal", max_sockets: 6 },
            { name: "Cudgel", code: "9cl", quality: "exceptional", max_sockets: 2 },
            { name: "Barbed Club", code: "9sp", quality: "exceptional", max_sockets: 3 },
            { name: "Flanged Mace", code: "9ma", quality: "exceptional", max_sockets: 2 },
            { name: "Jagged Star", code: "9mt", quality: "exceptional", max_sockets: 3 },
            { name: "Battle Hammer", code: "9wh", quality: "exceptional", max_sockets: 4 },
            { name: "War Club", code: "9m9", quality: "exceptional", max_sockets: 6 },
            { name: "Martel de Fer", code: "9gm", quality: "exceptional", max_sockets: 6 },
            { name: "Truncheon", code: "7cl", quality: "elite", max_sockets: 2 },
            { name: "Tyrant Club", code: "7sp", quality: "elite", max_sockets: 3 },
            { name: "Reinforced Mace", code: "7ma", quality: "elite", max_sockets: 2 },
            { name: "Devil Star", code: "7mt", quality: "elite", max_sockets: 3 },
            { name: "Ogre Maul", code: "7m7", quality: "elite", max_sockets: 6 },
        ];

        const nmagStavesExtended = [
            { name: "Short Staff", code: "sst", quality: "normal", max_sockets: 2 },
            { name: "Long Staff", code: "lst", quality: "normal", max_sockets: 3 },
            { name: "Jo Staff", code: "8ss", quality: "exceptional", max_sockets: 2 },
            { name: "Quarterstaff", code: "8ls", quality: "exceptional", max_sockets: 3 },
            { name: "Walking Stick", code: "6ss", quality: "elite", max_sockets: 2 },
            { name: "Stalagmite", code: "6ls", quality: "elite", max_sockets: 3 },
        ];

        const nmagSpearsExtended = [
            { name: "Spear", code: "spr", quality: "normal", max_sockets: 3 },
            { name: "Trident", code: "tri", quality: "normal", max_sockets: 4 },
            { name: "Spetum", code: "spt", quality: "normal", max_sockets: 6 },
            { name: "War Spear", code: "9sr", quality: "exceptional", max_sockets: 3 },
            { name: "Yari", code: "9st", quality: "exceptional", max_sockets: 6 },
            { name: "Hyperion Spear", code: "7sr", quality: "elite", max_sockets: 3 },
            { name: "Mancatcher", code: "7br", quality: "elite", max_sockets: 5 },
        ];

        const nmagBowsExtended = [
            { name: "Long War Bow", code: "lwb", quality: "normal", max_sockets: 6 },
            { name: "Long Siege Bow", code: "8l8", quality: "exceptional", max_sockets: 6 },
            { name: "Spider Bow", code: "6sb", quality: "elite", max_sockets: 3 },
        ];

        const nmagCrossbows = [
            { name: "Light Crossbow", code: "lxb", quality: "normal", max_sockets: 3 },
            { name: "Crossbow", code: "mxb", quality: "normal", max_sockets: 4 },
            { name: "Heavy Crossbow", code: "hxb", quality: "normal", max_sockets: 6 },
            { name: "Repeating Crossbow", code: "rxb", quality: "normal", max_sockets: 5 },
            { name: "Arbalest", code: "8lx", quality: "exceptional", max_sockets: 3 },
            { name: "Siege Crossbow", code: "8mx", quality: "exceptional", max_sockets: 4 },
            { name: "Ballista", code: "8hx", quality: "exceptional", max_sockets: 6 },
            { name: "Chu-Ko-Nu", code: "8rx", quality: "exceptional", max_sockets: 5 },
            { name: "Pellet Bow", code: "6lx", quality: "elite", max_sockets: 3 },
            { name: "Gorgon Crossbow", code: "6mx", quality: "elite", max_sockets: 4 },
            { name: "Colossus Crossbow", code: "6hx", quality: "elite", max_sockets: 6 },
            { name: "Demon Crossbow", code: "6rx", quality: "elite", max_sockets: 5 },
        ];

        const nmagJavelins = [
            { name: "Javelin", code: "jav", quality: "normal", max_sockets: 6 },
            { name: "Pilum", code: "pil", quality: "normal", max_sockets: 6 },
            { name: "Short Spear", code: "ssp", quality: "normal", max_sockets: 6 },
            { name: "Glaive", code: "glv", quality: "normal", max_sockets: 6 },
            { name: "Throwing Spear", code: "tsp", quality: "normal", max_sockets: 6 },
            { name: "War Javelin", code: "9ja", quality: "exceptional", max_sockets: 6 },
            { name: "Great Pilum", code: "9pi", quality: "exceptional", max_sockets: 6 },
            { name: "Simbilan", code: "9s9", quality: "exceptional", max_sockets: 6 },
            { name: "Spiculum", code: "9gl", quality: "exceptional", max_sockets: 6 },
            { name: "Harpoon", code: "9ts", quality: "exceptional", max_sockets: 6 },
            { name: "Hyperion Javelin", code: "7ja", quality: "elite", max_sockets: 6 },
            { name: "Stygian Pilum", code: "7pi", quality: "elite", max_sockets: 6 },
            { name: "Balrog Spear", code: "7s7", quality: "elite", max_sockets: 6 },
            { name: "Ghost Glaive", code: "7gl", quality: "elite", max_sockets: 6 },
            { name: "Winged Harpoon", code: "7ts", quality: "elite", max_sockets: 6 },
        ];

        const nmagArmorExtended = [
            { name: "Quilted Armor", code: "qui", quality: "normal", max_sockets: 2 },
            { name: "Leather Armor", code: "lea", quality: "normal", max_sockets: 2 },
            { name: "Studded Leather", code: "stu", quality: "normal", max_sockets: 2 },
            { name: "Scale Mail", code: "scl", quality: "normal", max_sockets: 2 },
            { name: "Chain Mail", code: "chn", quality: "normal", max_sockets: 2 },
            { name: "Splint Mail", code: "spl", quality: "normal", max_sockets: 2 },
            { name: "Plate Mail", code: "plt", quality: "normal", max_sockets: 2 },
            { name: "Field Plate", code: "fld", quality: "normal", max_sockets: 2 },
            { name: "Light Plate", code: "ltp", quality: "normal", max_sockets: 3 },
            { name: "Full Plate Mail", code: "ful", quality: "normal", max_sockets: 4 },
            { name: "Ghost Armor", code: "xui", quality: "exceptional", max_sockets: 2 },
            { name: "Serpentskin Armor", code: "xea", quality: "exceptional", max_sockets: 2 },
            { name: "Demonhide Armor", code: "xla", quality: "exceptional", max_sockets: 2 },
            { name: "Linked Mail", code: "xng", quality: "exceptional", max_sockets: 3 },
            { name: "Mesh Armor", code: "xhn", quality: "exceptional", max_sockets: 3 },
            { name: "Russet Armor", code: "xpl", quality: "exceptional", max_sockets: 3 },
            { name: "Templar Coat", code: "xlt", quality: "exceptional", max_sockets: 3 },
            { name: "Embossed Plate", code: "xth", quality: "exceptional", max_sockets: 4 },
        ];

        const nmagShieldsExtended = [
            { name: "Buckler", code: "buc", quality: "normal", max_sockets: 1 },
            { name: "Spiked Shield", code: "spk", quality: "normal", max_sockets: 2 },
            { name: "Tower Shield", code: "tow", quality: "normal", max_sockets: 3 },
            { name: "Gothic Shield", code: "gts", quality: "normal", max_sockets: 3 },
            { name: "Defender", code: "xuc", quality: "exceptional", max_sockets: 1 },
            { name: "Round Shield", code: "xml", quality: "exceptional", max_sockets: 2 },
            { name: "Scutum", code: "xrg", quality: "exceptional", max_sockets: 3 },
            { name: "Barbed Shield", code: "xpk", quality: "exceptional", max_sockets: 2 },
            { name: "Pavise", code: "xow", quality: "exceptional", max_sockets: 3 },
            { name: "Ancient Shield", code: "xts", quality: "exceptional", max_sockets: 3 },
            { name: "Luna", code: "uml", quality: "elite", max_sockets: 2 },
            { name: "Blade Barrier", code: "upk", quality: "elite", max_sockets: 3 },
            { name: "Aegis", code: "uow", quality: "elite", max_sockets: 4 },
            { name: "Ward", code: "uts", quality: "elite", max_sockets: 4 },
        ];

        const nmagPaladinShieldsExtended = [
            { name: "Targe", code: "pa1", quality: "normal", max_sockets: 4 },
        ];

        const nmagNecromancerShieldsExtended = [
            { name: "Preserved Head", code: "ne1", quality: "normal", max_sockets: 2 },
            { name: "Unraveller Head", code: "ne3", quality: "normal", max_sockets: 2 },
            { name: "Mummified Trophy", code: "ne6", quality: "exceptional", max_sockets: 2 },
            { name: "Sexton Trophy", code: "ne8", quality: "exceptional", max_sockets: 2 },
            { name: "Cantor Trophy", code: "ne9", quality: "exceptional", max_sockets: 2 },
            { name: "Hierophant Trophy", code: "nea", quality: "exceptional", max_sockets: 2 },
            { name: "Minion Skull", code: "neb", quality: "elite", max_sockets: 2 },
            { name: "Hellspawn Skull", code: "neg", quality: "elite", max_sockets: 2 },
            { name: "Overseer Skull", code: "ned", quality: "elite", max_sockets: 2 },
            { name: "Succubae Skull", code: "nee", quality: "elite", max_sockets: 2 },
            { name: "Bloodlord Skull", code: "nef", quality: "elite", max_sockets: 2 },
        ];

        const nmagHelmsExtended = [
            { name: "Skull Cap", code: "skp", quality: "normal", max_sockets: 2 },
            { name: "Full Helm", code: "fhl", quality: "normal", max_sockets: 2 },
            { name: "War Hat", code: "xap", quality: "exceptional", max_sockets: 2 },
            { name: "Sallet", code: "xkp", quality: "exceptional", max_sockets: 2 },
            { name: "Casque", code: "xlm", quality: "exceptional", max_sockets: 2 },
            { name: "Death Mask", code: "xsk", quality: "exceptional", max_sockets: 3 },
            { name: "Grim Helm", code: "xh9", quality: "exceptional", max_sockets: 2 },
            { name: "Winged Helm", code: "xhm", quality: "exceptional", max_sockets: 3 },
            { name: "Shako", code: "uap", quality: "elite", max_sockets: 2 },
            { name: "Hydraskull", code: "ukp", quality: "elite", max_sockets: 2 },
            { name: "Armet", code: "ulm", quality: "elite", max_sockets: 2 },
            { name: "Giant Conch", code: "uhl", quality: "elite", max_sockets: 2 },
            { name: "Spired Helm", code: "uhm", quality: "elite", max_sockets: 3 },
        ];

        const nmagDruidPeltsExtended = [];

        const nmagNecroHeadsExtended = [];

        const nmagAssassinClawsExtended = [
            { name: "Katar", code: "ktr", quality: "normal", max_sockets: 2 },
            { name: "Wrist Blade", code: "wrb", quality: "normal", max_sockets: 2 },
            { name: "Hatchet Hands", code: "axf", quality: "normal", max_sockets: 2 },
            { name: "Cestus", code: "ces", quality: "normal", max_sockets: 2 },
            { name: "Claws", code: "clw", quality: "normal", max_sockets: 3 },
            { name: "Scissors Katar", code: "skr", quality: "normal", max_sockets: 3 },
            { name: "Quhab", code: "9ar", quality: "exceptional", max_sockets: 3 },
            { name: "Wrist Spike", code: "9wb", quality: "exceptional", max_sockets: 2 },
            { name: "Fascia", code: "9xf", quality: "exceptional", max_sockets: 2 },
            { name: "Hand Scythe", code: "9cs", quality: "exceptional", max_sockets: 2 },
            { name: "War Fist", code: "7xf", quality: "elite", max_sockets: 2 },
            { name: "Battle Cestus", code: "7cs", quality: "elite", max_sockets: 2 },
        ];

        const nmagSorcOrbsExtended = [
            { name: "Eagle Orb", code: "ob1", quality: "normal", max_sockets: 2 },
            { name: "Sacred Globe", code: "ob2", quality: "normal", max_sockets: 2 },
            { name: "Smoked Sphere", code: "ob3", quality: "normal", max_sockets: 2 },
            { name: "Clasped Orb", code: "ob4", quality: "normal", max_sockets: 2 },
            { name: "Glowing Orb", code: "ob6", quality: "exceptional", max_sockets: 2 },
            { name: "Crystalline Globe", code: "ob7", quality: "exceptional", max_sockets: 2 },
            { name: "Cloudy Sphere", code: "ob8", quality: "exceptional", max_sockets: 2 },
            { name: "Sparkling Ball", code: "ob9", quality: "exceptional", max_sockets: 2 },
            { name: "Swirling Crystal", code: "oba", quality: "exceptional", max_sockets: 3 },
            { name: "Heavenly Stone", code: "obb", quality: "elite", max_sockets: 2 },
            { name: "Eldritch Orb", code: "obc", quality: "elite", max_sockets: 2 },
            { name: "Demon Heart", code: "obd", quality: "elite", max_sockets: 2 },
            { name: "Vortex Orb", code: "obe", quality: "elite", max_sockets: 2 },
        ];

        const nmagDaggersExtended = [];

        const nmagWandsExtended = [
            { name: "Wand", code: "wnd", quality: "normal", max_sockets: 1 },
            { name: "Yew Wand", code: "ywn", quality: "normal", max_sockets: 1 },
            { name: "Grim Wand", code: "gwn", quality: "normal", max_sockets: 2 },
            { name: "Burnt Wand", code: "9wn", quality: "exceptional", max_sockets: 1 },
            { name: "Petrified Wand", code: "9yw", quality: "exceptional", max_sockets: 2 },
            { name: "Tomb Wand", code: "9bw", quality: "exceptional", max_sockets: 2 },
            { name: "Polished Wand", code: "7wn", quality: "elite", max_sockets: 2 },
            { name: "Ghost Wand", code: "7yw", quality: "elite", max_sockets: 2 },
            { name: "Lich Wand", code: "7bw", quality: "elite", max_sockets: 2 },
            { name: "Unearthed Wand", code: "7gw", quality: "elite", max_sockets: 2 },
        ];

        const nmagSceptersExtended = [
            { name: "Scepter", code: "scp", quality: "normal", max_sockets: 2 },
            { name: "Grand Scepter", code: "gsc", quality: "normal", max_sockets: 3 },
            { name: "Rune Scepter", code: "9sc", quality: "exceptional", max_sockets: 2 },
            { name: "Holy Water Sprinkler", code: "9qs", quality: "exceptional", max_sockets: 3 },
            { name: "Mighty Scepter", code: "7sc", quality: "elite", max_sockets: 2 },
            { name: "Seraph Rod", code: "7qs", quality: "elite", max_sockets: 3 },
        ];

        const nmagBarbarianHelmsExtended = [
            { name: "Jawbone Cap", code: "ba1", quality: "normal", max_sockets: 3 },
            { name: "Fanged Helm", code: "ba2", quality: "normal", max_sockets: 3 },
            { name: "Assault Helmet", code: "ba4", quality: "normal", max_sockets: 3 },
            { name: "Lion Helm", code: "ba7", quality: "exceptional", max_sockets: 3 },
            { name: "Rage Mask", code: "ba8", quality: "exceptional", max_sockets: 3 },
            { name: "Savage Helmet", code: "ba9", quality: "exceptional", max_sockets: 3 },
            { name: "Slayer Guard", code: "baa", quality: "exceptional", max_sockets: 3 },
            { name: "Carnage Helm", code: "bab", quality: "elite", max_sockets: 3 },
            { name: "Fury Visor", code: "bac", quality: "elite", max_sockets: 3 },
            { name: "Conqueror Crown", code: "bae", quality: "elite", max_sockets: 3 },
            { name: "Guardian Crown", code: "baf", quality: "elite", max_sockets: 3 },
        ];

        const nmagAmazonWeapons = [
            { name: "Maiden Spear", code: "am3", quality: "normal", max_sockets: 6 },
            { name: "Maiden Pike", code: "am4", quality: "normal", max_sockets: 6 },
            { name: "Ceremonial Spear", code: "am8", quality: "exceptional", max_sockets: 6 },
            { name: "Ceremonial Pike", code: "am9", quality: "exceptional", max_sockets: 6 },
            { name: "Maiden Javelin", code: "am5", quality: "normal", max_sockets: 6 },
            { name: "Ceremonial Javelin", code: "ama", quality: "exceptional", max_sockets: 6 },
            { name: "Matriarchal Javelin", code: "amf", quality: "elite", max_sockets: 6 },
            { name: "Matriarchal Pike", code: "ame", quality: "elite", max_sockets: 6 },
        ];

        const nmagCirclets = [
            { name: "Circlet", code: "ci0", quality: "normal", max_sockets: 2 },
            { name: "Coronet", code: "ci1", quality: "normal", max_sockets: 2 },
        ];

        // Global settings state
        const globalSettings = {
            enableFilterLevels: false,
            levelNames: [
                '', '', '', '', '',
                '', '', '', '', ''
            ],
            hideJunk: true,
            showAll: true
        };

        // State management
        const filterState = {
            utility: {},
            runes: {},
            gems: {},
            misc: {},
            jewelryCharms: {},
            classUniques: {},
            eliteWeapons: {},
            eliteArmor: {},
            excWeapons: {},
            excArmor: {},
            normWeapons: {},
            normArmor: {},
            highSets: {},
            midSets: {},
            lowSets: {},
            magicJewelry: {},
            magicCharms: {},
            magicCrafting: {},
            rareJewelry: {},
            rareClassItems: {},
            rareEliteBases: {},
            nmagPolearms: {},
            nmagSwords: {},
            nmagAxes: {},
            nmagMaces: {},
            nmagStaves: {},
            nmagSpears: {},
            nmagBows: {},
            nmagArmor: {},
            nmagShieldsGeneric: {},
            nmagShieldsPaladin: {},
            nmagHelms: {},
            nmagDruidPelts: {},
            nmagNecroHeads: {},
            nmagAssassinClaws: {},
            nmagSorcOrbs: {},
            nmagDaggers: {},
            nmagWands: {},
            nmagScepters: {},
            nmagBarbarianHelms: {},
            nmagPolearmsExtended: {},
            nmagSwordsExtended: {},
            nmagAxesExtended: {},
            nmagMacesExtended: {},
            nmagStavesExtended: {},
            nmagSpearsExtended: {},
            nmagBowsExtended: {},
            nmagCrossbows: {},
            nmagJavelins: {},
            nmagArmorExtended: {},
            nmagShieldsExtended: {},
            nmagPaladinShieldsExtended: {},
            nmagNecromancerShieldsExtended: {},
            nmagHelmsExtended: {},
            nmagDruidPeltsExtended: {},
            nmagNecroHeadsExtended: {},
            nmagAssassinClawsExtended: {},
            nmagSorcOrbsExtended: {},
            nmagDaggersExtended: {},
            nmagWandsExtended: {},
            nmagSceptersExtended: {},
            nmagBarbarianHelmsExtended: {},
            nmagAmazonWeapons: {},
            nmagCirclets: {}
        };

        // Initialize utility items state
        utilityItems.forEach(item => {
            filterState.utility[item.code] = {
                show: true,
                useCustomColors: false,
                chatNotification: false,
                biggerClickbox: false,
                fontColor: 'WHITE',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        // Initialize rune items state
        runeItems.forEach(item => {
            filterState.runes[item.code] = {
                show: true,
                useCustomColors: false,
                chatNotification: false,
                biggerClickbox: false,
                fontColor: 'ORANGE',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        // Initialize gems state
        gemItems.forEach(item => {
            filterState.gems[item.code] = {
                show: true,
                useCustomColors: false,
                chatNotification: false,
                biggerClickbox: false,
                fontColor: 'WHITE',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        // Initialize misc items state
        miscItems.forEach(item => {
            filterState.misc[item.code] = {
                show: true,
                useCustomColors: false,
                chatNotification: false,
                biggerClickbox: false,
                fontColor: 'PURPLE',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        // Initialize unique items state
        jewelryAndCharms.forEach(item => {
            const key = item.name.replace(/[^a-zA-Z0-9]/g, '_');
            filterState.jewelryCharms[key] = {
                name: item.name,
                code: item.code,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'DARK_GREEN',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        classSpecificUniques.forEach(item => {
            // Use name as key since same code may be used by multiple items
            const key = item.name.replace(/[^a-zA-Z0-9]/g, '_');
            filterState.classUniques[key] = {
                name: item.name,
                code: item.code,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'DARK_GREEN',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        eliteUniqueWeapons.forEach(item => {
            const key = item.name.replace(/[^a-zA-Z0-9]/g, '_');
            filterState.eliteWeapons[key] = {
                name: item.name,
                code: item.code,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'DARK_GREEN',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        eliteUniqueArmor.forEach(item => {
            const key = item.name.replace(/[^a-zA-Z0-9]/g, '_');
            filterState.eliteArmor[key] = {
                name: item.name,
                code: item.code,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'DARK_GREEN',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        exceptionalUniqueWeapons.forEach(item => {
            const key = item.name.replace(/[^a-zA-Z0-9]/g, '_');
            filterState.excWeapons[key] = {
                name: item.name,
                code: item.code,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'DARK_GREEN',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        exceptionalUniqueArmor.forEach(item => {
            const key = item.name.replace(/[^a-zA-Z0-9]/g, '_');
            filterState.excArmor[key] = {
                name: item.name,
                code: item.code,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'DARK_GREEN',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        normalUniqueWeapons.forEach(item => {
            const key = item.name.replace(/[^a-zA-Z0-9]/g, '_');
            filterState.normWeapons[key] = {
                name: item.name,
                code: item.code,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'DARK_GREEN',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        normalUniqueArmor.forEach(item => {
            const key = item.name.replace(/[^a-zA-Z0-9]/g, '_');
            filterState.normArmor[key] = {
                name: item.name,
                code: item.code,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'DARK_GREEN',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        // Initialize state for set items
        highLevelSets.forEach(item => {
            const key = item.code + '_' + item.set;
            filterState.highSets[key] = {
                name: item.name,
                code: item.code,
                set: item.set,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'DARK_GREEN',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        midLevelSets.forEach(item => {
            const key = item.code + '_' + item.set;
            filterState.midSets[key] = {
                name: item.name,
                code: item.code,
                set: item.set,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'DARK_GREEN',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        lowLevelSets.forEach(item => {
            const key = item.code + '_' + item.set;
            filterState.lowSets[key] = {
                name: item.name,
                code: item.code,
                set: item.set,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'DARK_GREEN',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        // Initialize state for magic items
        magicJewelry.forEach((item, idx) => {
            const key = item.code + '_' + idx;
            filterState.magicJewelry[key] = {
                name: item.name,
                code: item.code,
                minIlvl: item.minIlvl,
                maxIlvl: item.maxIlvl,
                desc: item.desc,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'BLUE',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        magicCharms.forEach((item, idx) => {
            const key = item.code + '_' + idx;
            filterState.magicCharms[key] = {
                name: item.name,
                code: item.code,
                minIlvl: item.minIlvl,
                maxIlvl: item.maxIlvl,
                desc: item.desc,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'BLUE',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        magicCraftingBases.forEach((item, idx) => {
            const key = item.code + '_' + idx;
            filterState.magicCrafting[key] = {
                name: item.name,
                code: item.code,
                minIlvl: item.minIlvl,
                maxIlvl: item.maxIlvl,
                desc: item.desc,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'BLUE',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        // Initialize state for rare items
        rareJewelry.forEach((item, idx) => {
            const key = item.code + '_' + idx;
            filterState.rareJewelry[key] = {
                name: item.name,
                code: item.code,
                desc: item.desc,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'YELLOW',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        rareClassItems.forEach((item, idx) => {
            const key = item.code + '_' + idx;
            filterState.rareClassItems[key] = {
                name: item.name,
                code: item.code,
                minIlvl: item.minIlvl,
                tier: item.tier,
                desc: item.desc,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'YELLOW',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        rareEliteBases.forEach((item, idx) => {
            const key = item.code + '_' + idx;
            filterState.rareEliteBases[key] = {
                name: item.name,
                code: item.code,
                minIlvl: item.minIlvl,
                tier: item.tier,
                desc: item.desc,
                show: true,
                useCustomColors: false,
                chatNotification: false,
                fontColor: 'YELLOW',
                borderColor: null,
                backgroundColor: null,
                filterLevels: [true, true, true, true, true, true, true, true, true, true]
            };
        });

        // Initialize NMAG runeword bases state
        const initializeNmagState = (items, stateCategory) => {
            items.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                filterState[stateCategory][key] = {
                    name: item.name,
                    code: item.code,
                    quality: item.quality,
                    rw: item.rw,
                    max_sockets: item.max_sockets || 6,
                    show: true,
                    ethFilter: 'both',  // 'both', 'eth-only', 'non-eth'
                    sockFilter: [],     // Array of selected socket counts: ['0', '3', '4', etc]
                    edFilter: 'any',    // 'any', '10+', '12+', '13+', '14+', '15'
                    useCustomColors: false,
                    chatNotification: false,
                    fontColor: 'WHITE',
                    borderColor: null,
                    backgroundColor: null,
                    filterLevels: [true, true, true, true, true, true, true, true, true, true]
                };
            });
        };

        initializeNmagState(nmagPolearms, 'nmagPolearms');
        initializeNmagState(nmagSwords, 'nmagSwords');
        initializeNmagState(nmagAxes, 'nmagAxes');
        initializeNmagState(nmagMaces, 'nmagMaces');
        initializeNmagState(nmagStaves, 'nmagStaves');
        initializeNmagState(nmagSpears, 'nmagSpears');
        initializeNmagState(nmagBows, 'nmagBows');
        initializeNmagState(nmagArmor, 'nmagArmor');
        initializeNmagState(nmagShieldsGeneric, 'nmagShieldsGeneric');
        initializeNmagState(nmagShieldsPaladin, 'nmagShieldsPaladin');
        initializeNmagState(nmagHelms, 'nmagHelms');
        initializeNmagState(nmagDruidPelts, 'nmagDruidPelts');
        initializeNmagState(nmagNecroHeads, 'nmagNecroHeads');
        initializeNmagState(nmagAssassinClaws, 'nmagAssassinClaws');
        initializeNmagState(nmagSorcOrbs, 'nmagSorcOrbs');
        initializeNmagState(nmagDaggers, 'nmagDaggers');
        initializeNmagState(nmagWands, 'nmagWands');
        initializeNmagState(nmagScepters, 'nmagScepters');
        initializeNmagState(nmagBarbarianHelms, 'nmagBarbarianHelms');
        initializeNmagState(nmagPolearmsExtended, 'nmagPolearmsExtended');
        initializeNmagState(nmagSwordsExtended, 'nmagSwordsExtended');
        initializeNmagState(nmagAxesExtended, 'nmagAxesExtended');
        initializeNmagState(nmagMacesExtended, 'nmagMacesExtended');
        initializeNmagState(nmagStavesExtended, 'nmagStavesExtended');
        initializeNmagState(nmagSpearsExtended, 'nmagSpearsExtended');
        initializeNmagState(nmagBowsExtended, 'nmagBowsExtended');
        initializeNmagState(nmagCrossbows, 'nmagCrossbows');
        initializeNmagState(nmagJavelins, 'nmagJavelins');
        initializeNmagState(nmagArmorExtended, 'nmagArmorExtended');
        initializeNmagState(nmagShieldsExtended, 'nmagShieldsExtended');
        initializeNmagState(nmagPaladinShieldsExtended, 'nmagPaladinShieldsExtended');
        initializeNmagState(nmagNecromancerShieldsExtended, 'nmagNecromancerShieldsExtended');
        initializeNmagState(nmagHelmsExtended, 'nmagHelmsExtended');
        initializeNmagState(nmagDruidPeltsExtended, 'nmagDruidPeltsExtended');
        initializeNmagState(nmagNecroHeadsExtended, 'nmagNecroHeadsExtended');
        initializeNmagState(nmagAssassinClawsExtended, 'nmagAssassinClawsExtended');
        initializeNmagState(nmagSorcOrbsExtended, 'nmagSorcOrbsExtended');
        initializeNmagState(nmagDaggersExtended, 'nmagDaggersExtended');
        initializeNmagState(nmagWandsExtended, 'nmagWandsExtended');
        initializeNmagState(nmagSceptersExtended, 'nmagSceptersExtended');
        initializeNmagState(nmagBarbarianHelmsExtended, 'nmagBarbarianHelmsExtended');
        initializeNmagState(nmagAmazonWeapons, 'nmagAmazonWeapons');
        initializeNmagState(nmagCirclets, 'nmagCirclets');

        // Render items
        function renderUtilityItems() {
            const container = document.getElementById('utility-items');
            container.innerHTML = '';
            
            utilityItems.forEach(item => {
                const state = filterState.utility[item.code];
                const row = document.createElement('div');
                row.className = 'item-row';
                
                // Build font color options
                const fontOptions = FONT_COLORS.map(color => 
                    `<option value="${color}" ${state.fontColor === color ? 'selected' : ''}>${color}</option>`
                ).join('');
                
                // Build filter levels checkboxes (only for named levels)
                const levelCheckboxes = state.filterLevels
                    .map((checked, idx) => {
                        if (!globalSettings.levelNames[idx]) return null;
                        return `
                            <div class="level-checkbox-wrapper" title="${globalSettings.levelNames[idx]}">
                                <input type="checkbox" class="level-checkbox" 
                                    ${checked ? 'checked' : ''}
                                    onchange="updateItemLevel('utility', '${item.code}', ${idx}, this.checked)">
                                <span class="level-checkbox-label">${idx + 1}</span>
                            </div>
                        `;
                    })
                    .filter(cb => cb !== null)
                    .join('');
                
                const isModified = isItemModified(state, 'simple');
                
                row.innerHTML = `
                    <input type="checkbox" class="item-checkbox" 
                        ${state.show ? 'checked' : ''} 
                        onchange="updateItemState('utility', '${item.code}', 'show', this.checked)">
                    <span class="item-name">${item.name}</span>
                    <div class="levels-selector ${!globalSettings.enableFilterLevels ? 'disabled' : ''}">
                        <span class="levels-label">FilterLevels:</span>
                        <button class="btn-link" onclick="setAllLevels('utility', '${item.code}', true); event.preventDefault();" title="Select all levels">All</button>
                        <button class="btn-link" onclick="setAllLevels('utility', '${item.code}', false); event.preventDefault();" title="Deselect all levels">None</button>
                        <div class="level-checkboxes">
                            ${levelCheckboxes}
                        </div>
                    </div>
                    <button class="settings-btn ${isModified ? 'modified' : ''}" 
                        onclick="openItemSettings('utility', '${item.code}', \`${item.name}\`, 'simple')" 
                        title="Configure item settings">⚙</button>
                `;
                container.appendChild(row);
            });

            updateItemCount('utility');
        }

        function renderRuneItems() {
            const container = document.getElementById('runes-items');
            container.innerHTML = '';
            
            runeItems.forEach(item => {
                const state = filterState.runes[item.code];
                const row = document.createElement('div');
                row.className = 'item-row';
                
                // Build font color options
                const fontOptions = FONT_COLORS.map(color => 
                    `<option value="${color}" ${state.fontColor === color ? 'selected' : ''}>${color}</option>`
                ).join('');
                
                // Build filter levels checkboxes (only for named levels)
                const levelCheckboxes = state.filterLevels
                    .map((checked, idx) => {
                        if (!globalSettings.levelNames[idx]) return null;
                        return `
                            <div class="level-checkbox-wrapper" title="${globalSettings.levelNames[idx]}">
                                <input type="checkbox" class="level-checkbox" 
                                    ${checked ? 'checked' : ''}
                                    onchange="updateItemLevel('runes', '${item.code}', ${idx}, this.checked)">
                                <span class="level-checkbox-label">${idx + 1}</span>
                            </div>
                        `;
                    })
                    .filter(cb => cb !== null)
                    .join('');
                
                const isModified = isItemModified(state, 'simple');
                
                row.innerHTML = `
                    <input type="checkbox" class="item-checkbox" 
                        ${state.show ? 'checked' : ''} 
                        onchange="updateItemState('runes', '${item.code}', 'show', this.checked)">
                    <span class="item-name">${item.name}</span>
                    <div class="levels-selector ${!globalSettings.enableFilterLevels ? 'disabled' : ''}">
                        <span class="levels-label">FilterLevels:</span>
                        <button class="btn-link" onclick="setAllLevels('runes', '${item.code}', true); event.preventDefault();" title="Select all levels">All</button>
                        <button class="btn-link" onclick="setAllLevels('runes', '${item.code}', false); event.preventDefault();" title="Deselect all levels">None</button>
                        <div class="level-checkboxes">
                            ${levelCheckboxes}
                        </div>
                    </div>
                    <button class="settings-btn ${isModified ? 'modified' : ''}" 
                        onclick="openItemSettings('runes', '${item.code}', \`${item.name}\`, 'simple')" 
                        title="Configure item settings">⚙</button>
                `;
                container.appendChild(row);
            });

            updateItemCount('runes');
        }

        function renderGemsItems() {
            const container = document.getElementById('gems-items');
            container.innerHTML = '';
            
            gemItems.forEach(item => {
                const state = filterState.gems[item.code];
                const row = document.createElement('div');
                row.className = 'item-row';
                
                // Build font color options
                const fontOptions = FONT_COLORS.map(color => 
                    `<option value="${color}" ${state.fontColor === color ? 'selected' : ''}>${color}</option>`
                ).join('');
                
                // Build filter levels checkboxes (only for named levels)
                const levelCheckboxes = state.filterLevels
                    .map((checked, idx) => {
                        if (!globalSettings.levelNames[idx]) return null;
                        return `
                            <div class="level-checkbox-wrapper" title="${globalSettings.levelNames[idx]}">
                                <input type="checkbox" class="level-checkbox" 
                                    ${checked ? 'checked' : ''}
                                    onchange="updateItemLevel('gems', '${item.code}', ${idx}, this.checked)">
                                <span class="level-checkbox-label">${idx + 1}</span>
                            </div>
                        `;
                    })
                    .filter(cb => cb !== null)
                    .join('');
                
                const isModified = isItemModified(state, 'simple');
                
                row.innerHTML = `
                    <input type="checkbox" class="item-checkbox" 
                        ${state.show ? 'checked' : ''} 
                        onchange="updateItemState('gems', '${item.code}', 'show', this.checked)">
                    <span class="item-name">${item.name}</span>
                    <div class="levels-selector ${!globalSettings.enableFilterLevels ? 'disabled' : ''}">
                        <span class="levels-label">FilterLevels:</span>
                        <button class="btn-link" onclick="setAllLevels('gems', '${item.code}', true); event.preventDefault();" title="Select all levels">All</button>
                        <button class="btn-link" onclick="setAllLevels('gems', '${item.code}', false); event.preventDefault();" title="Deselect all levels">None</button>
                        <div class="level-checkboxes">
                            ${levelCheckboxes}
                        </div>
                    </div>
                    <button class="settings-btn ${isModified ? 'modified' : ''}" 
                        onclick="openItemSettings('gems', '${item.code}', \`${item.name}\`, 'simple')" 
                        title="Configure item settings">⚙</button>
                `;
                container.appendChild(row);
            });

            updateItemCount('gems');
        }

        function renderMiscItems() {
            const container = document.getElementById('misc-items');
            container.innerHTML = '';
            
            miscItems.forEach(item => {
                const state = filterState.misc[item.code];
                const row = document.createElement('div');
                row.className = 'item-row';
                
                // Build font color options
                const fontOptions = FONT_COLORS.map(color => 
                    `<option value="${color}" ${state.fontColor === color ? 'selected' : ''}>${color}</option>`
                ).join('');
                
                // Build filter levels checkboxes (only for named levels)
                const levelCheckboxes = state.filterLevels
                    .map((checked, idx) => {
                        if (!globalSettings.levelNames[idx]) return null;
                        return `
                            <div class="level-checkbox-wrapper" title="${globalSettings.levelNames[idx]}">
                                <input type="checkbox" class="level-checkbox" 
                                    ${checked ? 'checked' : ''}
                                    onchange="updateItemLevel('misc', '${item.code}', ${idx}, this.checked)">
                                <span class="level-checkbox-label">${idx + 1}</span>
                            </div>
                        `;
                    })
                    .filter(cb => cb !== null)
                    .join('');
                
                const isModified = isItemModified(state, 'simple');
                
                row.innerHTML = `
                    <input type="checkbox" class="item-checkbox" 
                        ${state.show ? 'checked' : ''} 
                        onchange="updateItemState('misc', '${item.code}', 'show', this.checked)">
                    <span class="item-name">${item.name}</span>
                    <div class="levels-selector ${!globalSettings.enableFilterLevels ? 'disabled' : ''}">
                        <span class="levels-label">FilterLevels:</span>
                        <button class="btn-link" onclick="setAllLevels('misc', '${item.code}', true); event.preventDefault();" title="Select all levels">All</button>
                        <button class="btn-link" onclick="setAllLevels('misc', '${item.code}', false); event.preventDefault();" title="Deselect all levels">None</button>
                        <div class="level-checkboxes">
                            ${levelCheckboxes}
                        </div>
                    </div>
                    <button class="settings-btn ${isModified ? 'modified' : ''}" 
                        onclick="openItemSettings('misc', '${item.code}', \`${item.name}\`, 'simple')" 
                        title="Configure item settings">⚙</button>
                `;
                container.appendChild(row);
            });

            updateItemCount('misc');
        }

        // Helper to find item code from key for different categories
        function findItemCodeByKey(category, key, items) {
            const item = items.find(i => {
                const itemKey = (category === 'highSets' || category === 'midSets' || category === 'lowSets') 
                    ? i.code + '_' + i.set
                    : i.name.replace(/[^a-zA-Z0-9]/g, '_');
                return itemKey === key;
            });
            return item ? item.code : null;
        }

        // Update state and regenerate filter
        function updateItemState(category, code, property, value) {
            filterState[category][code][property] = value;
            
            // Re-render if useCustomColors changed to update UI
            if (property === 'useCustomColors') {
                if (category === 'utility') {
                    renderUtilityItems();
                } else if (category === 'runes') {
                    renderRuneItems();
                } else if (category === 'gems') {
                    renderGemsItems();
                } else if (category === 'misc') {
                    renderMiscItems();
                }
            }
            
            updateItemCount(category);
            generateFilter();
            // Delay highlighting to ensure DOM updates complete
            setTimeout(() => highlightItemInOutput(code), 100);
        }

        // Clear a color value
        function clearColor(category, code, property) {
            filterState[category][code][property] = null;
            if (category === 'utility') {
                renderUtilityItems();
            } else if (category === 'runes') {
                renderRuneItems();
            } else if (category === 'gems') {
                renderGemsItems();
            } else if (category === 'misc') {
                renderMiscItems();
            }
            generateFilter();
            setTimeout(() => highlightItemInOutput(code), 100);
        }

        // Clear font color to default
        function clearFontColor(category, code) {
            let defaultColor = 'WHITE';
            if (category === 'runes') defaultColor = 'ORANGE';
            else if (category === 'misc') defaultColor = 'PURPLE';
            
            filterState[category][code].fontColor = defaultColor;
            if (category === 'utility') {
                renderUtilityItems();
            } else if (category === 'runes') {
                renderRuneItems();
            } else if (category === 'gems') {
                renderGemsItems();
            } else if (category === 'misc') {
                renderMiscItems();
            }
            generateFilter();
            setTimeout(() => highlightItemInOutput(code), 100);
        }

        // Check if an item has been modified from defaults
        function isItemModified(state, itemType = 'simple') {
            // Check common modifications
            if (state.useCustomColors) return true;
            if (state.chatNotification) return true;
            if (state.biggerClickbox) return true;
            
            // Check NMAG-specific modifications
            if (itemType === 'nmag') {
                if (state.ethFilter && state.ethFilter !== 'both') return true;
                if (state.sockFilter && state.sockFilter.length > 0) return true;
                if (state.edFilter && state.edFilter !== 'any') return true;
            }
            
            return false;
        }

        // Update settings button visual state after modifications
        function updateSettingsButtonState(category, itemKey, itemType = 'simple') {
            const state = filterState[category]?.[itemKey];
            if (!state) return;
            
            const isModified = isItemModified(state, itemType);
            
            // Find all settings buttons and update the one for this item
            const itemRows = document.querySelectorAll('.item-row');
            itemRows.forEach(row => {
                const settingsBtn = row.querySelector('.settings-btn');
                if (settingsBtn) {
                    const onclickAttr = settingsBtn.getAttribute('onclick');
                    // Check if this button belongs to our item
                    // Need to handle both single quotes in onclick and escaped single quotes in item key
                    if (onclickAttr && 
                        onclickAttr.includes(`'${category}'`) && 
                        (onclickAttr.includes(`'${itemKey}'`) || onclickAttr.includes(`'${itemKey.replace(/'/g, "\\'")}'`))) {
                        if (isModified) {
                            settingsBtn.classList.add('modified');
                        } else {
                            settingsBtn.classList.remove('modified');
                        }
                    }
                }
            });
        }

        // Update item counts
        function updateItemCount(category) {
            const state = filterState[category];
            const total = Object.keys(state).length;
            const shown = Object.values(state).filter(item => item.show).length;
            document.getElementById(`${category}-count`).textContent = `(${shown}/${total} shown)`;
        }

        // Section toggling
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('expanded');
        }

        // Presets
        function applyUtilityPreset(preset) {
            if (!preset) return;

            const essentialCodes = ['rvl', 'rvs', 'hp5', 'mp5', 'tbk', 'ibk', 'tsc', 'isc'];
            const lowPotions = ['hp1', 'hp2', 'hp3', 'mp1', 'mp2', 'mp3'];

            switch(preset) {
                case 'show-all':
                    Object.keys(filterState.utility).forEach(code => {
                        filterState.utility[code].show = true;
                    });
                    break;
                case 'hide-all':
                    Object.keys(filterState.utility).forEach(code => {
                        filterState.utility[code].show = false;
                    });
                    break;
                case 'essential-only':
                    Object.keys(filterState.utility).forEach(code => {
                        filterState.utility[code].show = essentialCodes.includes(code);
                    });
                    break;
                case 'endgame':
                    Object.keys(filterState.utility).forEach(code => {
                        filterState.utility[code].show = !lowPotions.includes(code);
                    });
                    break;
            }

            renderUtilityItems();
            generateFilter();
        }

        function applyRunePreset(preset) {
            if (!preset) return;

            switch(preset) {
                case 'show-all':
                    Object.keys(filterState.runes).forEach(code => {
                        filterState.runes[code].show = true;
                    });
                    break;
                case 'hide-all':
                    Object.keys(filterState.runes).forEach(code => {
                        filterState.runes[code].show = false;
                    });
                    break;
                case 'hide-low':
                    runeItems.forEach(item => {
                        filterState.runes[item.code].show = item.code > 'r09'; // After Ort
                    });
                    break;
                case 'mid-plus':
                    runeItems.forEach(item => {
                        filterState.runes[item.code].show = item.code >= 'r10'; // Thul+
                    });
                    break;
                case 'high-only':
                    runeItems.forEach(item => {
                        filterState.runes[item.code].show = item.code >= 'r21'; // Pul+
                    });
                    break;
            }

            renderRuneItems();
            generateFilter();
        }

        function applyGemPreset(preset) {
            if (!preset) return;

            switch(preset) {
                case 'show-all':
                    Object.keys(filterState.gems).forEach(code => {
                        filterState.gems[code].show = true;
                    });
                    break;
                case 'hide-all':
                    Object.keys(filterState.gems).forEach(code => {
                        filterState.gems[code].show = false;
                    });
                    break;
                case 'perfect-only':
                    gemItems.forEach(item => {
                        filterState.gems[item.code].show = item.level === 5;
                    });
                    break;
                case 'flawless-plus':
                    gemItems.forEach(item => {
                        filterState.gems[item.code].show = item.level >= 4;
                    });
                    break;
                case 'regular-plus':
                    gemItems.forEach(item => {
                        filterState.gems[item.code].show = item.level >= 3;
                    });
                    break;
            }

            renderGemsItems();
            generateFilter();
        }

        function applyMiscPreset(preset) {
            if (!preset) return;

            const essentials = ['cx5', 'cx9', 'pk1', 'pk2', 'pk3', 'dhn', 'bey', 'mbr', 'tes', 'ceh', 'bet', 'fed'];

            switch(preset) {
                case 'show-all':
                    Object.keys(filterState.misc).forEach(code => {
                        filterState.misc[code].show = true;
                    });
                    break;
                case 'hide-all':
                    Object.keys(filterState.misc).forEach(code => {
                        filterState.misc[code].show = false;
                    });
                    break;
                case 'essentials':
                    Object.keys(filterState.misc).forEach(code => {
                        filterState.misc[code].show = essentials.includes(code);
                    });
                    break;
            }

            renderMiscItems();
            generateFilter();
        }

        // ====== UNIQUE ITEMS FUNCTIONS ======

        // Generic render function for all unique item categories
        function renderUniqueItems(items, stateCategory, containerId, countId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            items.forEach(item => {
                const key = item.name.replace(/[^a-zA-Z0-9]/g, '_');
                const state = filterState[stateCategory][key];
                const row = document.createElement('div');
                row.className = 'item-row';
                
                // Build filter levels checkboxes (only for named levels)
                const levelCheckboxes = state.filterLevels
                    .map((checked, idx) => {
                        if (!globalSettings.levelNames[idx]) return null;
                        return `
                            <div class="level-checkbox-wrapper" title="${globalSettings.levelNames[idx]}">
                                <input type="checkbox" class="level-checkbox" 
                                    ${checked ? 'checked' : ''}
                                    onchange="updateItemLevel('${stateCategory}', '${key}', ${idx}, this.checked)">
                                <span class="level-checkbox-label">${idx + 1}</span>
                            </div>
                        `;
                    })
                    .filter(cb => cb !== null)
                    .join('');
                
                const isModified = isItemModified(state, 'unique');
                
                row.innerHTML = `
                    <input type="checkbox" class="item-checkbox" 
                        ${state.show ? 'checked' : ''} 
                        onchange="updateUniqueItemState('${stateCategory}', '${key}', 'show', this.checked)">
                    <span class="item-name">${item.name}</span>
                    <div class="levels-selector ${!globalSettings.enableFilterLevels ? 'disabled' : ''}">
                        <span class="levels-label">Levels:</span>
                        <button class="btn-link" onclick="setAllLevels('${stateCategory}', '${key}', true); event.preventDefault();" title="Select all levels">All</button>
                        <button class="btn-link" onclick="setAllLevels('${stateCategory}', '${key}', false); event.preventDefault();" title="Deselect all levels">None</button>
                        <div class="level-checkboxes">
                            ${levelCheckboxes}
                        </div>
                    </div>
                    <button class="settings-btn ${isModified ? 'modified' : ''}" 
                        onclick="openItemSettings('${stateCategory}', '${key}', '${item.name.replace(/'/g, "\\'")}', 'unique')" 
                        title="Configure item settings">⚙</button>
                `;
                container.appendChild(row);
            });

            updateUniqueCount(stateCategory, countId);
        }

        function renderJewelryCharmsItems() {
            renderUniqueItems(jewelryAndCharms, 'jewelryCharms', 'jewelry-charms-items', 'jewelry-charms');
        }

        function renderClassUniquesItems() {
            renderUniqueItems(classSpecificUniques, 'classUniques', 'class-uniques-items', 'class-uniques');
        }

        function renderEliteWeaponsItems() {
            renderUniqueItems(eliteUniqueWeapons, 'eliteWeapons', 'elite-weapons-items', 'elite-weapons');
        }

        function renderEliteArmorItems() {
            renderUniqueItems(eliteUniqueArmor, 'eliteArmor', 'elite-armor-items', 'elite-armor');
        }

        function renderExcWeaponsItems() {
            renderUniqueItems(exceptionalUniqueWeapons, 'excWeapons', 'exc-weapons-items', 'exc-weapons');
        }

        function renderExcArmorItems() {
            renderUniqueItems(exceptionalUniqueArmor, 'excArmor', 'exc-armor-items', 'exc-armor');
        }

        function renderNormWeaponsItems() {
            renderUniqueItems(normalUniqueWeapons, 'normWeapons', 'norm-weapons-items', 'norm-weapons');
        }

        function renderNormArmorItems() {
            renderUniqueItems(normalUniqueArmor, 'normArmor', 'norm-armor-items', 'norm-armor');
        }

        // Generic set items rendering function (uses SET keyword instead of UNI)
        function renderSetItems(items, stateCategory, containerId, countId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = '';
            let shownCount = 0;

            items.forEach(item => {
                const key = item.code + '_' + item.set;
                const state = filterState[stateCategory][key];
                if (state.show) shownCount++;

                const row = document.createElement('div');
                row.className = 'item-row';

                // Build filter levels checkboxes (only for named levels)
                const levelCheckboxes = state.filterLevels
                    .map((checked, idx) => {
                        if (!globalSettings.levelNames[idx]) return null;
                        return `
                            <div class="level-checkbox-wrapper" title="${globalSettings.levelNames[idx]}">
                                <input type="checkbox" class="level-checkbox" 
                                    ${checked ? 'checked' : ''}
                                    onchange="updateItemLevel('${stateCategory}', '${key}', ${idx}, this.checked)">
                                <span class="level-checkbox-label">${idx + 1}</span>
                            </div>
                        `;
                    })
                    .filter(cb => cb !== null)
                    .join('');

                const isModified = isItemModified(state, 'set');

                row.innerHTML = `
                    <input type="checkbox" class="item-checkbox" ${state.show ? 'checked' : ''}
                        onchange="updateSetItemState('${stateCategory}', '${key}', 'show', this.checked)">
                    <span class="item-name">${state.name}</span>
                    <div class="levels-selector ${!globalSettings.enableFilterLevels ? 'disabled' : ''}">
                        <span class="levels-label">Levels:</span>
                        <button class="btn-link" onclick="setAllLevels('${stateCategory}', '${key}', true); event.preventDefault();" title="Select all levels">All</button>
                        <button class="btn-link" onclick="setAllLevels('${stateCategory}', '${key}', false); event.preventDefault();" title="Deselect all levels">None</button>
                        <div class="level-checkboxes">
                            ${levelCheckboxes}
                        </div>
                    </div>
                    <button class="settings-btn ${isModified ? 'modified' : ''}" 
                        onclick="openItemSettings('${stateCategory}', '${key}', '${state.name.replace(/'/g, "\\'")}', 'set')" 
                        title="Configure item settings">⚙</button>
                `;

                container.appendChild(row);
            });

            document.getElementById(countId).textContent = `(${shownCount}/${items.length} shown)`;
        }

        // Specific set rendering functions
        function renderHighSetsItems() {
            renderSetItems(highLevelSets, 'highSets', 'high-sets-items', 'high-sets-count');
        }

        function renderMidSetsItems() {
            renderSetItems(midLevelSets, 'midSets', 'mid-sets-items', 'mid-sets-count');
        }

        function renderLowSetsItems() {
            renderSetItems(lowLevelSets, 'lowSets', 'low-sets-items', 'low-sets-count');
        }

        // Generic magic/rare items rendering function
        function renderMagicRareItems(items, stateCategory, containerId, countId, defaultColor) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = '';
            let shownCount = 0;

            // Determine if this is magic or rare based on defaultColor
            const itemType = defaultColor === 'BLUE' ? 'magic' : 'rare';

            items.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                const state = filterState[stateCategory][key];
                if (state.show) shownCount++;

                const row = document.createElement('div');
                row.className = 'item-row';

                // Build filter levels checkboxes (only for named levels)
                const levelCheckboxes = state.filterLevels
                    .map((checked, idx) => {
                        if (!globalSettings.levelNames[idx]) return null;
                        return `
                            <div class="level-checkbox-wrapper" title="${globalSettings.levelNames[idx]}">
                                <input type="checkbox" class="level-checkbox" 
                                    ${checked ? 'checked' : ''}
                                    onchange="updateItemLevel('${stateCategory}', '${key}', ${idx}, this.checked)">
                                <span class="level-checkbox-label">${idx + 1}</span>
                            </div>
                        `;
                    })
                    .filter(cb => cb !== null)
                    .join('');

                const isModified = isItemModified(state, itemType);

                row.innerHTML = `
                    <input type="checkbox" class="item-checkbox" ${state.show ? 'checked' : ''}
                        onchange="updateMagicRareItemState('${stateCategory}', '${key}', 'show', this.checked)">
                    <span class="item-name">${state.name}</span>
                    <div class="levels-selector ${!globalSettings.enableFilterLevels ? 'disabled' : ''}">
                        <span class="levels-label">Levels:</span>
                        <button class="btn-link" onclick="setAllLevels('${stateCategory}', '${key}', true); event.preventDefault();" title="Select all levels">All</button>
                        <button class="btn-link" onclick="setAllLevels('${stateCategory}', '${key}', false); event.preventDefault();" title="Deselect all levels">None</button>
                        <div class="level-checkboxes">
                            ${levelCheckboxes}
                        </div>
                    </div>
                    <button class="settings-btn ${isModified ? 'modified' : ''}" 
                        onclick="openItemSettings('${stateCategory}', '${key}', '${state.name.replace(/'/g, "\\'")}', '${itemType}')" 
                        title="Configure item settings">⚙</button>
                `;

                container.appendChild(row);
            });

            document.getElementById(countId).textContent = `(${shownCount}/${items.length} shown)`;
        }

        // Specific render functions for magic/rare items
        function renderMagicJewelryItems() {
            renderMagicRareItems(magicJewelry, 'magicJewelry', 'magic-jewelry-items', 'magic-jewelry-count', 'BLUE');
        }

        function renderMagicCharmsItems() {
            renderMagicRareItems(magicCharms, 'magicCharms', 'magic-charms-items', 'magic-charms-count', 'BLUE');
        }

        function renderMagicCraftingItems() {
            renderMagicRareItems(magicCraftingBases, 'magicCrafting', 'magic-crafting-items', 'magic-crafting-count', 'BLUE');
        }

        function renderRareJewelryItems() {
            renderMagicRareItems(rareJewelry, 'rareJewelry', 'rare-jewelry-items', 'rare-jewelry-count', 'YELLOW');
        }

        function renderRareClassItemsItems() {
            renderMagicRareItems(rareClassItems, 'rareClassItems', 'rare-class-items-items', 'rare-class-items-count', 'YELLOW');
        }

        function renderRareEliteBasesItems() {
            renderMagicRareItems(rareEliteBases, 'rareEliteBases', 'rare-elite-bases-items', 'rare-elite-bases-count', 'YELLOW');
        }

        // Generate socket checkboxes based on max_sockets from item state
        function generateSocketCheckboxes(itemCode, selectedSockets, stateCategory, key) {
            // Get max sockets from state (stored from item array)
            const state = filterState[stateCategory][key];
            const maxSockets = state.max_sockets || 6;
            
            // Available socket options: 0, 2, 3, 4, 5, 6 but limited by max_sockets
            const socketOptions = ['0', '2', '3', '4', '5', '6'].filter(sock => {
                const sockNum = parseInt(sock);
                return sock === '0' || sockNum <= maxSockets;
            });
            
            let html = '<div style="display: flex; align-items: center; gap: 4px; font-size: 11px;">';
            html += '<span style="margin-right: 2px;">Sockets:</span>';
            
            socketOptions.forEach(sock => {
                const isChecked = selectedSockets.includes(sock);
                html += `
                    <label style="display: flex; align-items: center; gap: 2px; cursor: pointer;">
                        <input type="checkbox" 
                            ${isChecked ? 'checked' : ''}
                            onchange="toggleNmagSocket('${stateCategory}', '${key}', '${sock}', this.checked)"
                            style="margin: 0; cursor: pointer;">
                        <span>${sock}</span>
                    </label>
                `;
            });
            
            html += '</div>';
            return html;
        }

        // Generic NMAG runeword bases rendering function
        function renderNmagItems(items, stateCategory, containerId, countId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = '';
            let shownCount = 0;

            items.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                const state = filterState[stateCategory][key];
                if (state.show) shownCount++;

                const row = document.createElement('div');
                row.className = 'item-row';

                // Build filter levels checkboxes (only for named levels)
                const levelCheckboxes = state.filterLevels
                    .map((checked, idx) => {
                        if (!globalSettings.levelNames[idx]) return null;
                        return `
                            <div class="level-checkbox-wrapper" title="${globalSettings.levelNames[idx]}">
                                <input type="checkbox" class="level-checkbox" 
                                    ${checked ? 'checked' : ''}
                                    onchange="updateItemLevel('${stateCategory}', '${key}', ${idx}, this.checked)">
                                <span class="level-checkbox-label">${idx + 1}</span>
                            </div>
                        `;
                    })
                    .filter(cb => cb !== null)
                    .join('');

                const isModified = isItemModified(state, 'nmag');

                row.innerHTML = `
                    <input type="checkbox" class="item-checkbox" ${state.show ? 'checked' : ''}
                        onchange="updateNmagItemState('${stateCategory}', '${key}', 'show', this.checked)">
                    <span class="item-name">${state.name}</span>
                    <span style="color: #888; font-size: 11px; margin-left: 8px;">[${state.quality}]</span>
                    <div class="levels-selector ${!globalSettings.enableFilterLevels ? 'disabled' : ''}">
                        <span class="levels-label">Levels:</span>
                        <button class="btn-link" onclick="setAllLevels('${stateCategory}', '${key}', true); event.preventDefault();" title="Select all levels">All</button>
                        <button class="btn-link" onclick="setAllLevels('${stateCategory}', '${key}', false); event.preventDefault();" title="Deselect all levels">None</button>
                        <div class="level-checkboxes">
                            ${levelCheckboxes}
                        </div>
                    </div>
                    <button class="settings-btn ${isModified ? 'modified' : ''}" 
                        onclick="openItemSettings('${stateCategory}', '${key}', '${state.name.replace(/'/g, "\\'")}', 'nmag')" 
                        title="Configure item settings">⚙</button>
                `;

                container.appendChild(row);
            });

            const total = items.length;
            document.getElementById(countId).textContent = `(${shownCount}/${total} shown)`;
        }

        function renderNmagPolearmsItems() {
            renderNmagItems(nmagPolearms, 'nmagPolearms', 'nmag-polearms-items', 'nmag-polearms-count');
        }

        function renderNmagSwordsItems() {
            renderNmagItems(nmagSwords, 'nmagSwords', 'nmag-swords-items', 'nmag-swords-count');
        }

        function renderNmagAxesItems() {
            renderNmagItems(nmagAxes, 'nmagAxes', 'nmag-axes-items', 'nmag-axes-count');
        }

        function renderNmagMacesItems() {
            renderNmagItems(nmagMaces, 'nmagMaces', 'nmag-maces-items', 'nmag-maces-count');
        }

        function renderNmagStavesItems() {
            renderNmagItems(nmagStaves, 'nmagStaves', 'nmag-staves-items', 'nmag-staves-count');
        }

        function renderNmagBowsItems() {
            renderNmagItems(nmagBows, 'nmagBows', 'nmag-bows-items', 'nmag-bows-count');
        }

        function renderNmagSpearsItems() {
            renderNmagItems(nmagSpears, 'nmagSpears', 'nmag-spears-items', 'nmag-spears-count');
        }

        function renderNmagArmorItems() {
            renderNmagItems(nmagArmor, 'nmagArmor', 'nmag-armor-items', 'nmag-armor-count');
        }

        function renderNmagShieldsGenericItems() {
            renderNmagItems(nmagShieldsGeneric, 'nmagShieldsGeneric', 'nmag-shields-generic-items', 'nmag-shields-generic-count');
        }

        function renderNmagShieldsPaladinItems() {
            renderNmagItems(nmagShieldsPaladin, 'nmagShieldsPaladin', 'nmag-shields-paladin-items', 'nmag-shields-paladin-count');
        }

        function renderNmagHelmsItems() {
            renderNmagItems(nmagHelms, 'nmagHelms', 'nmag-helms-items', 'nmag-helms-count');
        }

        function renderNmagDruidPeltsItems() {
            renderNmagItems(nmagDruidPelts, 'nmagDruidPelts', 'nmag-druid-pelts-items', 'nmag-druid-pelts-count');
        }

        function renderNmagNecroHeadsItems() {
            renderNmagItems(nmagNecroHeads, 'nmagNecroHeads', 'nmag-necro-heads-items', 'nmag-necro-heads-count');
        }

        function renderNmagAssassinClawsItems() {
            renderNmagItems(nmagAssassinClaws, 'nmagAssassinClaws', 'nmag-assassin-claws-items', 'nmag-assassin-claws-count');
        }

        function renderNmagSorcOrbsItems() {
            renderNmagItems(nmagSorcOrbs, 'nmagSorcOrbs', 'nmag-sorc-orbs-items', 'nmag-sorc-orbs-count');
        }

        function renderNmagDaggersItems() {
            renderNmagItems(nmagDaggers, 'nmagDaggers', 'nmag-daggers-items', 'nmag-daggers-count');
        }

        function renderNmagWandsItems() {
            renderNmagItems(nmagWands, 'nmagWands', 'nmag-wands-items', 'nmag-wands-count');
        }

        function renderNmagSceptersItems() {
            renderNmagItems(nmagScepters, 'nmagScepters', 'nmag-scepters-items', 'nmag-scepters-count');
        }

        function renderNmagBarbarianHelmsItems() {
            renderNmagItems(nmagBarbarianHelms, 'nmagBarbarianHelms', 'nmag-barbarian-helms-items', 'nmag-barbarian-helms-count');
        }

        // Extended NMAG render functions
        function renderNmagPolearmsExtendedItems() {
            renderNmagItems(nmagPolearmsExtended, 'nmagPolearmsExtended', 'nmag-polearms-extended-items', 'nmag-polearms-extended-count');
        }

        function renderNmagSwordsExtendedItems() {
            renderNmagItems(nmagSwordsExtended, 'nmagSwordsExtended', 'nmag-swords-extended-items', 'nmag-swords-extended-count');
        }

        function renderNmagAxesExtendedItems() {
            renderNmagItems(nmagAxesExtended, 'nmagAxesExtended', 'nmag-axes-extended-items', 'nmag-axes-extended-count');
        }

        function renderNmagMacesExtendedItems() {
            renderNmagItems(nmagMacesExtended, 'nmagMacesExtended', 'nmag-maces-extended-items', 'nmag-maces-extended-count');
        }

        function renderNmagStavesExtendedItems() {
            renderNmagItems(nmagStavesExtended, 'nmagStavesExtended', 'nmag-staves-extended-items', 'nmag-staves-extended-count');
        }

        function renderNmagSpearsExtendedItems() {
            renderNmagItems(nmagSpearsExtended, 'nmagSpearsExtended', 'nmag-spears-extended-items', 'nmag-spears-extended-count');
        }

        function renderNmagBowsExtendedItems() {
            renderNmagItems(nmagBowsExtended, 'nmagBowsExtended', 'nmag-bows-extended-items', 'nmag-bows-extended-count');
        }

        function renderNmagCrossbowsItems() {
            renderNmagItems(nmagCrossbows, 'nmagCrossbows', 'nmag-crossbows-items', 'nmag-crossbows-count');
        }

        function renderNmagJavelinsItems() {
            renderNmagItems(nmagJavelins, 'nmagJavelins', 'nmag-javelins-items', 'nmag-javelins-count');
        }

        function renderNmagArmorExtendedItems() {
            renderNmagItems(nmagArmorExtended, 'nmagArmorExtended', 'nmag-armor-extended-items', 'nmag-armor-extended-count');
        }

        function renderNmagShieldsExtendedItems() {
            renderNmagItems(nmagShieldsExtended, 'nmagShieldsExtended', 'nmag-shields-extended-items', 'nmag-shields-extended-count');
        }

        function renderNmagPaladinShieldsExtendedItems() {
            renderNmagItems(nmagPaladinShieldsExtended, 'nmagPaladinShieldsExtended', 'nmag-paladin-shields-extended-items', 'nmag-paladin-shields-extended-count');
        }

        function renderNmagNecromancerShieldsExtendedItems() {
            renderNmagItems(nmagNecromancerShieldsExtended, 'nmagNecromancerShieldsExtended', 'nmag-necromancer-shields-extended-items', 'nmag-necromancer-shields-extended-count');
        }

        function renderNmagHelmsExtendedItems() {
            renderNmagItems(nmagHelmsExtended, 'nmagHelmsExtended', 'nmag-helms-extended-items', 'nmag-helms-extended-count');
        }

        function renderNmagDruidPeltsExtendedItems() {
            renderNmagItems(nmagDruidPeltsExtended, 'nmagDruidPeltsExtended', 'nmag-druid-pelts-extended-items', 'nmag-druid-pelts-extended-count');
        }

        function renderNmagNecroHeadsExtendedItems() {
            renderNmagItems(nmagNecroHeadsExtended, 'nmagNecroHeadsExtended', 'nmag-necro-heads-extended-items', 'nmag-necro-heads-extended-count');
        }

        function renderNmagAssassinClawsExtendedItems() {
            renderNmagItems(nmagAssassinClawsExtended, 'nmagAssassinClawsExtended', 'nmag-assassin-claws-extended-items', 'nmag-assassin-claws-extended-count');
        }

        function renderNmagSorcOrbsExtendedItems() {
            renderNmagItems(nmagSorcOrbsExtended, 'nmagSorcOrbsExtended', 'nmag-sorc-orbs-extended-items', 'nmag-sorc-orbs-extended-count');
        }

        function renderNmagDaggersExtendedItems() {
            renderNmagItems(nmagDaggersExtended, 'nmagDaggersExtended', 'nmag-daggers-extended-items', 'nmag-daggers-extended-count');
        }

        function renderNmagWandsExtendedItems() {
            renderNmagItems(nmagWandsExtended, 'nmagWandsExtended', 'nmag-wands-extended-items', 'nmag-wands-extended-count');
        }

        function renderNmagSceptersExtendedItems() {
            renderNmagItems(nmagSceptersExtended, 'nmagSceptersExtended', 'nmag-scepters-extended-items', 'nmag-scepters-extended-count');
        }

        function renderNmagBarbarianHelmsExtendedItems() {
            renderNmagItems(nmagBarbarianHelmsExtended, 'nmagBarbarianHelmsExtended', 'nmag-barbarian-helms-extended-items', 'nmag-barbarian-helms-extended-count');
        }

        function renderNmagAmazonWeaponsItems() {
            renderNmagItems(nmagAmazonWeapons, 'nmagAmazonWeapons', 'nmag-amazon-weapons-items', 'nmag-amazon-weapons-count');
        }

        function renderNmagCircletsItems() {
            renderNmagItems(nmagCirclets, 'nmagCirclets', 'nmag-circlets-items', 'nmag-circlets-count');
        }

        // Helper functions for unique items
        function updateUniqueItemState(category, key, field, value) {
            filterState[category][key][field] = value;
            
            if (category === 'jewelryCharms') {
                renderJewelryCharmsItems();
            } else if (category === 'classUniques') {
                renderClassUniquesItems();
            } else if (category === 'eliteWeapons') {
                renderEliteWeaponsItems();
            } else if (category === 'eliteArmor') {
                renderEliteArmorItems();
            } else if (category === 'excWeapons') {
                renderExcWeaponsItems();
            } else if (category === 'excArmor') {
                renderExcArmorItems();
            } else if (category === 'normWeapons') {
                renderNormWeaponsItems();
            } else if (category === 'normArmor') {
                renderNormArmorItems();
            }
            
            generateFilter();
            
            // Find item code and highlight
            const itemArrays = {
                'jewelryCharms': jewelryAndCharms,
                'classUniques': classSpecificUniques,
                'eliteWeapons': eliteUniqueWeapons,
                'eliteArmor': eliteUniqueArmor,
                'excWeapons': exceptionalUniqueWeapons,
                'excArmor': exceptionalUniqueArmor,
                'normWeapons': normalUniqueWeapons,
                'normArmor': normalUniqueArmor
            };
            const code = findItemCodeByKey(category, key, itemArrays[category]);
            if (code) setTimeout(() => highlightItemInOutput(code, 'UNI'), 100);
        }

        function clearUniqueFontColor(category, key) {
            filterState[category][key].fontColor = 'DARK_GREEN';
            
            if (category === 'jewelryCharms') {
                renderJewelryCharmsItems();
            } else if (category === 'classUniques') {
                renderClassUniquesItems();
            } else if (category === 'eliteWeapons') {
                renderEliteWeaponsItems();
            } else if (category === 'eliteArmor') {
                renderEliteArmorItems();
            } else if (category === 'excWeapons') {
                renderExcWeaponsItems();
            } else if (category === 'excArmor') {
                renderExcArmorItems();
            } else if (category === 'normWeapons') {
                renderNormWeaponsItems();
            } else if (category === 'normArmor') {
                renderNormArmorItems();
            }
            
            generateFilter();
            
            const itemArrays = {
                'jewelryCharms': jewelryAndCharms,
                'classUniques': classSpecificUniques,
                'eliteWeapons': eliteUniqueWeapons,
                'eliteArmor': eliteUniqueArmor,
                'excWeapons': exceptionalUniqueWeapons,
                'excArmor': exceptionalUniqueArmor,
                'normWeapons': normalUniqueWeapons,
                'normArmor': normalUniqueArmor
            };
            const code = findItemCodeByKey(category, key, itemArrays[category]);
            if (code) setTimeout(() => highlightItemInOutput(code, 'UNI'), 100);
        }

        function clearUniqueColor(category, key, colorType) {
            filterState[category][key][colorType] = null;
            
            if (category === 'jewelryCharms') {
                renderJewelryCharmsItems();
            } else if (category === 'classUniques') {
                renderClassUniquesItems();
            } else if (category === 'eliteWeapons') {
                renderEliteWeaponsItems();
            } else if (category === 'eliteArmor') {
                renderEliteArmorItems();
            } else if (category === 'excWeapons') {
                renderExcWeaponsItems();
            } else if (category === 'excArmor') {
                renderExcArmorItems();
            } else if (category === 'normWeapons') {
                renderNormWeaponsItems();
            } else if (category === 'normArmor') {
                renderNormArmorItems();
            }
            
            generateFilter();
            
            const itemArrays = {
                'jewelryCharms': jewelryAndCharms,
                'classUniques': classSpecificUniques,
                'eliteWeapons': eliteUniqueWeapons,
                'eliteArmor': eliteUniqueArmor,
                'excWeapons': exceptionalUniqueWeapons,
                'excArmor': exceptionalUniqueArmor,
                'normWeapons': normalUniqueWeapons,
                'normArmor': normalUniqueArmor
            };
            const code = findItemCodeByKey(category, key, itemArrays[category]);
            if (code) setTimeout(() => highlightItemInOutput(code, 'UNI'), 100);
        }

        function updateUniqueCount(category, countId) {
            const state = filterState[category];
            const total = Object.keys(state).length;
            const shown = Object.values(state).filter(item => item.show).length;
            document.getElementById(`${countId}-count`).textContent = `(${shown}/${total} shown)`;
        }

        // Update set item state and re-render
        function updateSetItemState(category, key, field, value, index = null) {
            if (index !== null) {
                filterState[category][key][field][index] = value;
            } else {
                filterState[category][key][field] = value;
            }

            // Re-render the appropriate section
            if (category === 'highSets') {
                renderHighSetsItems();
            } else if (category === 'midSets') {
                renderMidSetsItems();
            } else if (category === 'lowSets') {
                renderLowSetsItems();
            }
            
            generateFilter();
            
            const itemArrays = {
                'highSets': highLevelSets,
                'midSets': midLevelSets,
                'lowSets': lowLevelSets
            };
            const code = findItemCodeByKey(category, key, itemArrays[category]);
            if (code) setTimeout(() => highlightItemInOutput(code, 'SET'), 100);
        }

        // Clear set item font color (reset to DARK_GREEN)
        function clearSetFontColor(category, key) {
            filterState[category][key].fontColor = 'DARK_GREEN';
            if (category === 'highSets') {
                renderHighSetsItems();
            } else if (category === 'midSets') {
                renderMidSetsItems();
            } else if (category === 'lowSets') {
                renderLowSetsItems();
            }
            generateFilter();
            
            const itemArrays = {
                'highSets': highLevelSets,
                'midSets': midLevelSets,
                'lowSets': lowLevelSets
            };
            const code = findItemCodeByKey(category, key, itemArrays[category]);
            if (code) setTimeout(() => highlightItemInOutput(code, 'SET'), 100);
        }

        // Clear set item border or background color
        function clearSetColor(category, key, colorType) {
            filterState[category][key][colorType] = null;
            if (category === 'highSets') {
                renderHighSetsItems();
            } else if (category === 'midSets') {
                renderMidSetsItems();
            } else if (category === 'lowSets') {
                renderLowSetsItems();
            }
            generateFilter();
            
            const itemArrays = {
                'highSets': highLevelSets,
                'midSets': midLevelSets,
                'lowSets': lowLevelSets
            };
            const code = findItemCodeByKey(category, key, itemArrays[category]);
            if (code) setTimeout(() => highlightItemInOutput(code, 'SET'), 100);
        }

        // Set all filter levels for a set item
        function setAllSetLevels(category, key, enabled) {
            for (let i = 0; i < 10; i++) {
                filterState[category][key].filterLevels[i] = enabled;
            }
            if (category === 'highSets') {
                renderHighSetsItems();
            } else if (category === 'midSets') {
                renderMidSetsItems();
            } else if (category === 'lowSets') {
                renderLowSetsItems();
            }
            generateFilter();
            
            const itemArrays = {
                'highSets': highLevelSets,
                'midSets': midLevelSets,
                'lowSets': lowLevelSets
            };
            const code = findItemCodeByKey(category, key, itemArrays[category]);
            if (code) setTimeout(() => highlightItemInOutput(code, 'SET'), 100);
        }

        // Preset functions for unique items
        function applyUniquePreset(category, items, preset) {
            items.forEach(item => {
                const key = item.name.replace(/[^a-zA-Z0-9]/g, '_');
                if (preset === 'show-all') {
                    filterState[category][key].show = true;
                } else if (preset === 'hide-all') {
                    filterState[category][key].show = false;
                }
            });
            
            // Re-render the appropriate section
            if (category === 'jewelryCharms') {
                renderJewelryCharmsItems();
            } else if (category === 'classUniques') {
                renderClassUniquesItems();
            } else if (category === 'eliteWeapons') {
                renderEliteWeaponsItems();
            } else if (category === 'eliteArmor') {
                renderEliteArmorItems();
            } else if (category === 'excWeapons') {
                renderExcWeaponsItems();
            } else if (category === 'excArmor') {
                renderExcArmorItems();
            } else if (category === 'normWeapons') {
                renderNormWeaponsItems();
            } else if (category === 'normArmor') {
                renderNormArmorItems();
            }
            
            generateFilter();
        }

        function applyJewelryCharmsPreset(preset) {
            if (!preset) return;
            applyUniquePreset('jewelryCharms', jewelryAndCharms, preset);
        }

        function applyClassUniquesPreset(preset) {
            if (!preset) return;
            applyUniquePreset('classUniques', classSpecificUniques, preset);
        }

        function applyEliteWeaponsPreset(preset) {
            if (!preset) return;
            applyUniquePreset('eliteWeapons', eliteUniqueWeapons, preset);
        }

        function applyEliteArmorPreset(preset) {
            if (!preset) return;
            applyUniquePreset('eliteArmor', eliteUniqueArmor, preset);
        }

        function applyExcWeaponsPreset(preset) {
            if (!preset) return;
            applyUniquePreset('excWeapons', exceptionalUniqueWeapons, preset);
        }

        function applyExcArmorPreset(preset) {
            if (!preset) return;
            applyUniquePreset('excArmor', exceptionalUniqueArmor, preset);
        }

        function applyNormWeaponsPreset(preset) {
            if (!preset) return;
            applyUniquePreset('normWeapons', normalUniqueWeapons, preset);
        }

        function applyNormArmorPreset(preset) {
            if (!preset) return;
            applyUniquePreset('normArmor', normalUniqueArmor, preset);
        }

        // Preset functions for set items
        function applyHighSetsPreset(preset) {
            if (!preset) return;
            highLevelSets.forEach(item => {
                const key = item.code + '_' + item.set;
                if (preset === 'show-all') {
                    filterState.highSets[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.highSets[key].show = false;
                }
            });
            renderHighSetsItems();
            generateFilter();
        }

        function applyMidSetsPreset(preset) {
            if (!preset) return;
            midLevelSets.forEach(item => {
                const key = item.code + '_' + item.set;
                if (preset === 'show-all') {
                    filterState.midSets[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.midSets[key].show = false;
                }
            });
            renderMidSetsItems();
            generateFilter();
        }

        function applyLowSetsPreset(preset) {
            if (!preset) return;
            lowLevelSets.forEach(item => {
                const key = item.code + '_' + item.set;
                if (preset === 'show-all') {
                    filterState.lowSets[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.lowSets[key].show = false;
                }
            });
            renderLowSetsItems();
            generateFilter();
        }

        // State update functions for magic/rare items
        function updateMagicRareItemState(category, key, field, value, index = null) {
            if (index !== null) {
                filterState[category][key][field][index] = value;
            } else {
                filterState[category][key][field] = value;
            }

            // Re-render the appropriate section
            if (category === 'magicJewelry') {
                renderMagicJewelryItems();
            } else if (category === 'magicCharms') {
                renderMagicCharmsItems();
            } else if (category === 'magicCrafting') {
                renderMagicCraftingItems();
            } else if (category === 'rareJewelry') {
                renderRareJewelryItems();
            } else if (category === 'rareClassItems') {
                renderRareClassItemsItems();
            } else if (category === 'rareEliteBases') {
                renderRareEliteBasesItems();
            }
            
            generateFilter();
            
            // Extract code from key format "code_index"
            const code = key.split('_')[0];
            const prefix = category.startsWith('magic') ? 'MAG' : 'RARE';
            if (code) setTimeout(() => highlightItemInOutput(code, prefix), 100);
        }

        function clearMagicRareFontColor(category, key, defaultColor) {
            filterState[category][key].fontColor = defaultColor;
            if (category === 'magicJewelry') {
                renderMagicJewelryItems();
            } else if (category === 'magicCharms') {
                renderMagicCharmsItems();
            } else if (category === 'magicCrafting') {
                renderMagicCraftingItems();
            } else if (category === 'rareJewelry') {
                renderRareJewelryItems();
            } else if (category === 'rareClassItems') {
                renderRareClassItemsItems();
            } else if (category === 'rareEliteBases') {
                renderRareEliteBasesItems();
            }
            generateFilter();
            
            const code = key.split('_')[0];
            const prefix = category.startsWith('magic') ? 'MAG' : 'RARE';
            if (code) setTimeout(() => highlightItemInOutput(code, prefix), 100);
        }

        function clearMagicRareColor(category, key, colorType) {
            filterState[category][key][colorType] = null;
            if (category === 'magicJewelry') {
                renderMagicJewelryItems();
            } else if (category === 'magicCharms') {
                renderMagicCharmsItems();
            } else if (category === 'magicCrafting') {
                renderMagicCraftingItems();
            } else if (category === 'rareJewelry') {
                renderRareJewelryItems();
            } else if (category === 'rareClassItems') {
                renderRareClassItemsItems();
            } else if (category === 'rareEliteBases') {
                renderRareEliteBasesItems();
            }
            generateFilter();
            
            const code = key.split('_')[0];
            const prefix = category.startsWith('magic') ? 'MAG' : 'RARE';
            if (code) setTimeout(() => highlightItemInOutput(code, prefix), 100);
        }

        function setAllMagicRareLevels(category, key, enabled) {
            for (let i = 0; i < 10; i++) {
                filterState[category][key].filterLevels[i] = enabled;
            }
            if (category === 'magicJewelry') {
                renderMagicJewelryItems();
            } else if (category === 'magicCharms') {
                renderMagicCharmsItems();
            } else if (category === 'magicCrafting') {
                renderMagicCraftingItems();
            } else if (category === 'rareJewelry') {
                renderRareJewelryItems();
            } else if (category === 'rareClassItems') {
                renderRareClassItemsItems();
            } else if (category === 'rareEliteBases') {
                renderRareEliteBasesItems();
            }
            generateFilter();
            
            const code = key.split('_')[0];
            const prefix = category.startsWith('magic') ? 'MAG' : 'RARE';
            if (code) setTimeout(() => highlightItemInOutput(code, prefix), 100);
        }

        // Preset functions for magic/rare items
        function applyMagicJewelryPreset(preset) {
            if (!preset) return;
            magicJewelry.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.magicJewelry[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.magicJewelry[key].show = false;
                } else if (preset === 'high-ilvl') {
                    filterState.magicJewelry[key].show = !item.maxIlvl || item.minIlvl >= 71;
                }
            });
            renderMagicJewelryItems();
            generateFilter();
        }

        function applyMagicCharmsPreset(preset) {
            if (!preset) return;
            magicCharms.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.magicCharms[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.magicCharms[key].show = false;
                } else if (preset === 'high-ilvl') {
                    filterState.magicCharms[key].show = !item.maxIlvl || item.minIlvl >= 50;
                }
            });
            renderMagicCharmsItems();
            generateFilter();
        }

        function applyMagicCraftingPreset(preset) {
            if (!preset) return;
            magicCraftingBases.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.magicCrafting[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.magicCrafting[key].show = false;
                }
            });
            renderMagicCraftingItems();
            generateFilter();
        }

        function applyRareJewelryPreset(preset) {
            if (!preset) return;
            rareJewelry.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.rareJewelry[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.rareJewelry[key].show = false;
                }
            });
            renderRareJewelryItems();
            generateFilter();
        }

        function applyRareClassItemsPreset(preset) {
            if (!preset) return;
            rareClassItems.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.rareClassItems[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.rareClassItems[key].show = false;
                }
            });
            renderRareClassItemsItems();
            generateFilter();
        }

        function applyRareEliteBasesPreset(preset) {
            if (!preset) return;
            rareEliteBases.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.rareEliteBases[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.rareEliteBases[key].show = false;
                }
            });
            renderRareEliteBasesItems();
            generateFilter();
        }

        // State update functions for NMAG items
        function updateNmagItemState(category, key, field, value, index = null) {
            if (index !== null) {
                filterState[category][key][field][index] = value;
            } else {
                filterState[category][key][field] = value;
            }

            // Re-render the appropriate section
            const renderMap = {
                'nmagPolearms': renderNmagPolearmsItems,
                'nmagSwords': renderNmagSwordsItems,
                'nmagAxes': renderNmagAxesItems,
                'nmagMaces': renderNmagMacesItems,
                'nmagStaves': renderNmagStavesItems,
                'nmagSpears': renderNmagSpearsItems,
                'nmagBows': renderNmagBowsItems,
                'nmagArmor': renderNmagArmorItems,
                'nmagShieldsGeneric': renderNmagShieldsGenericItems,
                'nmagShieldsPaladin': renderNmagShieldsPaladinItems,
                'nmagHelms': renderNmagHelmsItems,
                'nmagDruidPelts': renderNmagDruidPeltsItems,
                'nmagNecroHeads': renderNmagNecroHeadsItems,
                'nmagAssassinClaws': renderNmagAssassinClawsItems,
                'nmagSorcOrbs': renderNmagSorcOrbsItems,
                'nmagDaggers': renderNmagDaggersItems,
                'nmagWands': renderNmagWandsItems,
                'nmagScepters': renderNmagSceptersItems,
                'nmagBarbarianHelms': renderNmagBarbarianHelmsItems
            };
            if (renderMap[category]) renderMap[category]();
            generateFilter();
            
            const code = key.split('_')[0];
            if (code) setTimeout(() => highlightItemInOutput(code, 'NMAG'), 100);
        }

        // Toggle socket selection for NMAG items
        function toggleNmagSocket(category, key, socketValue, checked) {
            const state = filterState[category][key];
            if (checked) {
                if (!state.sockFilter.includes(socketValue)) {
                    state.sockFilter.push(socketValue);
                }
            } else {
                state.sockFilter = state.sockFilter.filter(s => s !== socketValue);
            }
            generateFilter();
            
            const code = key.split('_')[0];
            if (code) setTimeout(() => highlightItemInOutput(code, 'NMAG'), 100);
        }

        function clearNmagFontColor(category, key) {
            filterState[category][key].fontColor = 'WHITE';
            const renderMap = {
                'nmagPolearms': renderNmagPolearmsItems,
                'nmagSwords': renderNmagSwordsItems,
                'nmagAxes': renderNmagAxesItems,
                'nmagMaces': renderNmagMacesItems,
                'nmagStaves': renderNmagStavesItems,
                'nmagSpears': renderNmagSpearsItems,
                'nmagBows': renderNmagBowsItems,
                'nmagArmor': renderNmagArmorItems,
                'nmagShieldsGeneric': renderNmagShieldsGenericItems,
                'nmagShieldsPaladin': renderNmagShieldsPaladinItems,
                'nmagHelms': renderNmagHelmsItems,
                'nmagDruidPelts': renderNmagDruidPeltsItems,
                'nmagNecroHeads': renderNmagNecroHeadsItems,
                'nmagAssassinClaws': renderNmagAssassinClawsItems,
                'nmagSorcOrbs': renderNmagSorcOrbsItems,
                'nmagDaggers': renderNmagDaggersItems,
                'nmagWands': renderNmagWandsItems,
                'nmagScepters': renderNmagSceptersItems,
                'nmagBarbarianHelms': renderNmagBarbarianHelmsItems,
                'nmagPolearmsExtended': renderNmagPolearmsExtendedItems,
                'nmagSwordsExtended': renderNmagSwordsExtendedItems,
                'nmagAxesExtended': renderNmagAxesExtendedItems,
                'nmagMacesExtended': renderNmagMacesExtendedItems,
                'nmagStavesExtended': renderNmagStavesExtendedItems,
                'nmagSpearsExtended': renderNmagSpearsExtendedItems,
                'nmagBowsExtended': renderNmagBowsExtendedItems,
                'nmagCrossbows': renderNmagCrossbowsItems,
                'nmagJavelins': renderNmagJavelinsItems,
                'nmagArmorExtended': renderNmagArmorExtendedItems,
                'nmagShieldsExtended': renderNmagShieldsExtendedItems,
                'nmagPaladinShieldsExtended': renderNmagPaladinShieldsExtendedItems,
                'nmagNecromancerShieldsExtended': renderNmagNecromancerShieldsExtendedItems,
                'nmagHelmsExtended': renderNmagHelmsExtendedItems,
                'nmagDruidPeltsExtended': renderNmagDruidPeltsExtendedItems,
                'nmagNecroHeadsExtended': renderNmagNecroHeadsExtendedItems,
                'nmagAssassinClawsExtended': renderNmagAssassinClawsExtendedItems,
                'nmagSorcOrbsExtended': renderNmagSorcOrbsExtendedItems,
                'nmagDaggersExtended': renderNmagDaggersExtendedItems,
                'nmagWandsExtended': renderNmagWandsExtendedItems,
                'nmagSceptersExtended': renderNmagSceptersExtendedItems,
                'nmagBarbarianHelmsExtended': renderNmagBarbarianHelmsExtendedItems,
                'nmagAmazonWeapons': renderNmagAmazonWeaponsItems,
                'nmagCirclets': renderNmagCircletsItems
            };
            if (renderMap[category]) renderMap[category]();
            generateFilter();
            
            const code = key.split('_')[0];
            if (code) setTimeout(() => highlightItemInOutput(code, 'NMAG'), 100);
        }

        function clearNmagColor(category, key, colorType) {
            filterState[category][key][colorType] = null;
            const renderMap = {
                'nmagPolearms': renderNmagPolearmsItems,
                'nmagSwords': renderNmagSwordsItems,
                'nmagAxes': renderNmagAxesItems,
                'nmagMaces': renderNmagMacesItems,
                'nmagStaves': renderNmagStavesItems,
                'nmagSpears': renderNmagSpearsItems,
                'nmagBows': renderNmagBowsItems,
                'nmagArmor': renderNmagArmorItems,
                'nmagShieldsGeneric': renderNmagShieldsGenericItems,
                'nmagShieldsPaladin': renderNmagShieldsPaladinItems,
                'nmagHelms': renderNmagHelmsItems,
                'nmagDruidPelts': renderNmagDruidPeltsItems,
                'nmagNecroHeads': renderNmagNecroHeadsItems,
                'nmagAssassinClaws': renderNmagAssassinClawsItems,
                'nmagSorcOrbs': renderNmagSorcOrbsItems,
                'nmagDaggers': renderNmagDaggersItems,
                'nmagWands': renderNmagWandsItems,
                'nmagScepters': renderNmagSceptersItems,
                'nmagBarbarianHelms': renderNmagBarbarianHelmsItems,
                'nmagPolearmsExtended': renderNmagPolearmsExtendedItems,
                'nmagSwordsExtended': renderNmagSwordsExtendedItems,
                'nmagAxesExtended': renderNmagAxesExtendedItems,
                'nmagMacesExtended': renderNmagMacesExtendedItems,
                'nmagStavesExtended': renderNmagStavesExtendedItems,
                'nmagSpearsExtended': renderNmagSpearsExtendedItems,
                'nmagBowsExtended': renderNmagBowsExtendedItems,
                'nmagCrossbows': renderNmagCrossbowsItems,
                'nmagJavelins': renderNmagJavelinsItems,
                'nmagArmorExtended': renderNmagArmorExtendedItems,
                'nmagShieldsExtended': renderNmagShieldsExtendedItems,
                'nmagPaladinShieldsExtended': renderNmagPaladinShieldsExtendedItems,
                'nmagNecromancerShieldsExtended': renderNmagNecromancerShieldsExtendedItems,
                'nmagHelmsExtended': renderNmagHelmsExtendedItems,
                'nmagDruidPeltsExtended': renderNmagDruidPeltsExtendedItems,
                'nmagNecroHeadsExtended': renderNmagNecroHeadsExtendedItems,
                'nmagAssassinClawsExtended': renderNmagAssassinClawsExtendedItems,
                'nmagSorcOrbsExtended': renderNmagSorcOrbsExtendedItems,
                'nmagDaggersExtended': renderNmagDaggersExtendedItems,
                'nmagWandsExtended': renderNmagWandsExtendedItems,
                'nmagSceptersExtended': renderNmagSceptersExtendedItems,
                'nmagBarbarianHelmsExtended': renderNmagBarbarianHelmsExtendedItems,
                'nmagAmazonWeapons': renderNmagAmazonWeaponsItems,
                'nmagCirclets': renderNmagCircletsItems
            };
            if (renderMap[category]) renderMap[category]();
            generateFilter();
            
            const code = key.split('_')[0];
            if (code) setTimeout(() => highlightItemInOutput(code, 'NMAG'), 100);
        }

        function setAllNmagLevels(category, key, enabled) {
            for (let i = 0; i < 10; i++) {
                filterState[category][key].filterLevels[i] = enabled;
            }
            const renderMap = {
                'nmagPolearms': renderNmagPolearmsItems,
                'nmagSwords': renderNmagSwordsItems,
                'nmagAxes': renderNmagAxesItems,
                'nmagMaces': renderNmagMacesItems,
                'nmagStaves': renderNmagStavesItems,
                'nmagSpears': renderNmagSpearsItems,
                'nmagBows': renderNmagBowsItems,
                'nmagArmor': renderNmagArmorItems,
                'nmagShieldsGeneric': renderNmagShieldsGenericItems,
                'nmagShieldsPaladin': renderNmagShieldsPaladinItems,
                'nmagHelms': renderNmagHelmsItems,
                'nmagDruidPelts': renderNmagDruidPeltsItems,
                'nmagNecroHeads': renderNmagNecroHeadsItems,
                'nmagAssassinClaws': renderNmagAssassinClawsItems,
                'nmagSorcOrbs': renderNmagSorcOrbsItems,
                'nmagDaggers': renderNmagDaggersItems,
                'nmagWands': renderNmagWandsItems,
                'nmagScepters': renderNmagSceptersItems,
                'nmagBarbarianHelms': renderNmagBarbarianHelmsItems,
                'nmagPolearmsExtended': renderNmagPolearmsExtendedItems,
                'nmagSwordsExtended': renderNmagSwordsExtendedItems,
                'nmagAxesExtended': renderNmagAxesExtendedItems,
                'nmagMacesExtended': renderNmagMacesExtendedItems,
                'nmagStavesExtended': renderNmagStavesExtendedItems,
                'nmagSpearsExtended': renderNmagSpearsExtendedItems,
                'nmagBowsExtended': renderNmagBowsExtendedItems,
                'nmagCrossbows': renderNmagCrossbowsItems,
                'nmagJavelins': renderNmagJavelinsItems,
                'nmagArmorExtended': renderNmagArmorExtendedItems,
                'nmagShieldsExtended': renderNmagShieldsExtendedItems,
                'nmagPaladinShieldsExtended': renderNmagPaladinShieldsExtendedItems,
                'nmagNecromancerShieldsExtended': renderNmagNecromancerShieldsExtendedItems,
                'nmagHelmsExtended': renderNmagHelmsExtendedItems,
                'nmagDruidPeltsExtended': renderNmagDruidPeltsExtendedItems,
                'nmagNecroHeadsExtended': renderNmagNecroHeadsExtendedItems,
                'nmagAssassinClawsExtended': renderNmagAssassinClawsExtendedItems,
                'nmagSorcOrbsExtended': renderNmagSorcOrbsExtendedItems,
                'nmagDaggersExtended': renderNmagDaggersExtendedItems,
                'nmagWandsExtended': renderNmagWandsExtendedItems,
                'nmagSceptersExtended': renderNmagSceptersExtendedItems,
                'nmagBarbarianHelmsExtended': renderNmagBarbarianHelmsExtendedItems,
                'nmagAmazonWeapons': renderNmagAmazonWeaponsItems,
                'nmagCirclets': renderNmagCircletsItems
            };
            if (renderMap[category]) renderMap[category]();
            generateFilter();
            
            const code = key.split('_')[0];
            if (code) setTimeout(() => highlightItemInOutput(code, 'NMAG'), 100);
        }

        // Preset functions for NMAG items
        function applyNmagPolearmsPreset(preset) {
            if (!preset) return;
            nmagPolearms.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagPolearms[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagPolearms[key].show = false;
                } else if (preset === 'eth-only') {
                    filterState.nmagPolearms[key].show = true;
                    filterState.nmagPolearms[key].ethFilter = 'eth-only';
                } else if (preset === '4sock') {
                    filterState.nmagPolearms[key].show = true;
                    filterState.nmagPolearms[key].sockFilter = '4';
                }
            });
            renderNmagPolearmsItems();
            generateFilter();
        }

        function applyNmagSwordsPreset(preset) {
            if (!preset) return;
            nmagSwords.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagSwords[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagSwords[key].show = false;
                } else if (preset === 'elite-only') {
                    filterState.nmagSwords[key].show = item.quality === 'elite';
                }
            });
            renderNmagSwordsItems();
            generateFilter();
        }

        function applyNmagAxesPreset(preset) {
            if (!preset) return;
            nmagAxes.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagAxes[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagAxes[key].show = false;
                }
            });
            renderNmagAxesItems();
            generateFilter();
        }

        function applyNmagMacesPreset(preset) {
            if (!preset) return;
            nmagMaces.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagMaces[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagMaces[key].show = false;
                }
            });
            renderNmagMacesItems();
            generateFilter();
        }

        function applyNmagStavesPreset(preset) {
            if (!preset) return;
            nmagStaves.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagStaves[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagStaves[key].show = false;
                }
            });
            renderNmagStavesItems();
            generateFilter();
        }

        function applyNmagBowsPreset(preset) {
            if (!preset) return;
            nmagBows.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagBows[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagBows[key].show = false;
                }
            });
            renderNmagBowsItems();
            generateFilter();
        }

        function applyNmagSpearsPreset(preset) {
            if (!preset) return;
            nmagSpears.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagSpears[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagSpears[key].show = false;
                }
            });
            renderNmagSpearsItems();
            generateFilter();
        }

        function applyNmagArmorPreset(preset) {
            if (!preset) return;
            nmagArmor.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagArmor[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagArmor[key].show = false;
                } else if (preset === 'elite-only') {
                    filterState.nmagArmor[key].show = item.quality === 'elite';
                }
            });
            renderNmagArmorItems();
            generateFilter();
        }

        function applyNmagShieldsGenericPreset(preset) {
            if (!preset) return;
            nmagShieldsGeneric.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagShieldsGeneric[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagShieldsGeneric[key].show = false;
                }
            });
            renderNmagShieldsGenericItems();
            generateFilter();
        }

        function applyNmagShieldsPaladinPreset(preset) {
            if (!preset) return;
            nmagShieldsPaladin.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagShieldsPaladin[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagShieldsPaladin[key].show = false;
                }
            });
            renderNmagShieldsPaladinItems();
            generateFilter();
        }

        function applyNmagHelmsPreset(preset) {
            if (!preset) return;
            nmagHelms.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagHelms[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagHelms[key].show = false;
                }
            });
            renderNmagHelmsItems();
            generateFilter();
        }

        function applyNmagDruidPeltsPreset(preset) {
            if (!preset) return;
            nmagDruidPelts.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagDruidPelts[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagDruidPelts[key].show = false;
                }
            });
            renderNmagDruidPeltsItems();
            generateFilter();
        }

        function applyNmagNecroHeadsPreset(preset) {
            if (!preset) return;
            nmagNecroHeads.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagNecroHeads[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagNecroHeads[key].show = false;
                }
            });
            renderNmagNecroHeadsItems();
            generateFilter();
        }

        function applyNmagAssassinClawsPreset(preset) {
            if (!preset) return;
            nmagAssassinClaws.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagAssassinClaws[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagAssassinClaws[key].show = false;
                }
            });
            renderNmagAssassinClawsItems();
            generateFilter();
        }

        function applyNmagSorcOrbsPreset(preset) {
            if (!preset) return;
            nmagSorcOrbs.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagSorcOrbs[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagSorcOrbs[key].show = false;
                }
            });
            renderNmagSorcOrbsItems();
            generateFilter();
        }

        function applyNmagDaggersPreset(preset) {
            if (!preset) return;
            nmagDaggers.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagDaggers[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagDaggers[key].show = false;
                } else if (preset === 'elite-only') {
                    filterState.nmagDaggers[key].show = (item.quality === 'elite');
                }
            });
            renderNmagDaggersItems();
            generateFilter();
        }

        function applyNmagWandsPreset(preset) {
            if (!preset) return;
            nmagWands.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagWands[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagWands[key].show = false;
                } else if (preset === 'elite-only') {
                    filterState.nmagWands[key].show = (item.quality === 'elite');
                }
            });
            renderNmagWandsItems();
            generateFilter();
        }

        function applyNmagSceptersPreset(preset) {
            if (!preset) return;
            nmagScepters.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagScepters[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagScepters[key].show = false;
                } else if (preset === 'elite-only') {
                    filterState.nmagScepters[key].show = (item.quality === 'elite');
                }
            });
            renderNmagSceptersItems();
            generateFilter();
        }

        function applyNmagBarbarianHelmsPreset(preset) {
            if (!preset) return;
            nmagBarbarianHelms.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagBarbarianHelms[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagBarbarianHelms[key].show = false;
                } else if (preset === 'elite-only') {
                    filterState.nmagBarbarianHelms[key].show = (item.quality === 'elite');
                }
            });
            renderNmagBarbarianHelmsItems();
            generateFilter();
        }

        function applyNmagPolearmsExtendedPreset(preset) {
            if (!preset) return;
            nmagPolearmsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagPolearmsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagPolearmsExtended[key].show = false;
                }
            });
            renderNmagPolearmsExtendedItems();
            generateFilter();
        }

        function applyNmagSwordsExtendedPreset(preset) {
            if (!preset) return;
            nmagSwordsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagSwordsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagSwordsExtended[key].show = false;
                }
            });
            renderNmagSwordsExtendedItems();
            generateFilter();
        }

        function applyNmagAxesExtendedPreset(preset) {
            if (!preset) return;
            nmagAxesExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagAxesExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagAxesExtended[key].show = false;
                }
            });
            renderNmagAxesExtendedItems();
            generateFilter();
        }

        function applyNmagMacesExtendedPreset(preset) {
            if (!preset) return;
            nmagMacesExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagMacesExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagMacesExtended[key].show = false;
                }
            });
            renderNmagMacesExtendedItems();
            generateFilter();
        }

        function applyNmagStavesExtendedPreset(preset) {
            if (!preset) return;
            nmagStavesExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagStavesExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagStavesExtended[key].show = false;
                }
            });
            renderNmagStavesExtendedItems();
            generateFilter();
        }

        function applyNmagSpearsExtendedPreset(preset) {
            if (!preset) return;
            nmagSpearsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagSpearsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagSpearsExtended[key].show = false;
                }
            });
            renderNmagSpearsExtendedItems();
            generateFilter();
        }

        function applyNmagBowsExtendedPreset(preset) {
            if (!preset) return;
            nmagBowsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagBowsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagBowsExtended[key].show = false;
                }
            });
            renderNmagBowsExtendedItems();
            generateFilter();
        }

        function applyNmagCrossbowsPreset(preset) {
            if (!preset) return;
            nmagCrossbows.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagCrossbows[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagCrossbows[key].show = false;
                }
            });
            renderNmagCrossbowsItems();
            generateFilter();
        }

        function applyNmagJavelinsPreset(preset) {
            if (!preset) return;
            nmagJavelins.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagJavelins[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagJavelins[key].show = false;
                }
            });
            renderNmagJavelinsItems();
            generateFilter();
        }

        function applyNmagArmorExtendedPreset(preset) {
            if (!preset) return;
            nmagArmorExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagArmorExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagArmorExtended[key].show = false;
                }
            });
            renderNmagArmorExtendedItems();
            generateFilter();
        }

        function applyNmagShieldsExtendedPreset(preset) {
            if (!preset) return;
            nmagShieldsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagShieldsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagShieldsExtended[key].show = false;
                }
            });
            renderNmagShieldsExtendedItems();
            generateFilter();
        }

        function applyNmagPaladinShieldsExtendedPreset(preset) {
            if (!preset) return;
            nmagPaladinShieldsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagPaladinShieldsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagPaladinShieldsExtended[key].show = false;
                }
            });
            renderNmagPaladinShieldsExtendedItems();
            generateFilter();
        }

        function applyNmagNecromancerShieldsExtendedPreset(preset) {
            if (!preset) return;
            nmagNecromancerShieldsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagNecromancerShieldsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagNecromancerShieldsExtended[key].show = false;
                }
            });
            renderNmagNecromancerShieldsExtendedItems();
            generateFilter();
        }

        function applyNmagHelmsExtendedPreset(preset) {
            if (!preset) return;
            nmagHelmsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagHelmsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagHelmsExtended[key].show = false;
                }
            });
            renderNmagHelmsExtendedItems();
            generateFilter();
        }

        function applyNmagDruidPeltsExtendedPreset(preset) {
            if (!preset) return;
            nmagDruidPeltsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagDruidPeltsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagDruidPeltsExtended[key].show = false;
                }
            });
            renderNmagDruidPeltsExtendedItems();
            generateFilter();
        }

        function applyNmagNecroHeadsExtendedPreset(preset) {
            if (!preset) return;
            nmagNecroHeadsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagNecroHeadsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagNecroHeadsExtended[key].show = false;
                }
            });
            renderNmagNecroHeadsExtendedItems();
            generateFilter();
        }

        function applyNmagAssassinClawsExtendedPreset(preset) {
            if (!preset) return;
            nmagAssassinClawsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagAssassinClawsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagAssassinClawsExtended[key].show = false;
                }
            });
            renderNmagAssassinClawsExtendedItems();
            generateFilter();
        }

        function applyNmagSorcOrbsExtendedPreset(preset) {
            if (!preset) return;
            nmagSorcOrbsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagSorcOrbsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagSorcOrbsExtended[key].show = false;
                }
            });
            renderNmagSorcOrbsExtendedItems();
            generateFilter();
        }

        function applyNmagDaggersExtendedPreset(preset) {
            if (!preset) return;
            nmagDaggersExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagDaggersExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagDaggersExtended[key].show = false;
                }
            });
            renderNmagDaggersExtendedItems();
            generateFilter();
        }

        function applyNmagWandsExtendedPreset(preset) {
            if (!preset) return;
            nmagWandsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagWandsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagWandsExtended[key].show = false;
                }
            });
            renderNmagWandsExtendedItems();
            generateFilter();
        }

        function applyNmagSceptersExtendedPreset(preset) {
            if (!preset) return;
            nmagSceptersExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagSceptersExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagSceptersExtended[key].show = false;
                }
            });
            renderNmagSceptersExtendedItems();
            generateFilter();
        }

        function applyNmagBarbarianHelmsExtendedPreset(preset) {
            if (!preset) return;
            nmagBarbarianHelmsExtended.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagBarbarianHelmsExtended[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagBarbarianHelmsExtended[key].show = false;
                }
            });
            renderNmagBarbarianHelmsExtendedItems();
            generateFilter();
        }

        function applyNmagAmazonWeaponsPreset(preset) {
            if (!preset) return;
            nmagAmazonWeapons.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagAmazonWeapons[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagAmazonWeapons[key].show = false;
                }
            });
            renderNmagAmazonWeaponsItems();
            generateFilter();
        }

        function applyNmagCircletsPreset(preset) {
            if (!preset) return;
            nmagCirclets.forEach((item, idx) => {
                const key = item.code + '_' + idx;
                if (preset === 'show-all') {
                    filterState.nmagCirclets[key].show = true;
                } else if (preset === 'hide-all') {
                    filterState.nmagCirclets[key].show = false;
                }
            });
            renderNmagCircletsItems();
            generateFilter();
        }

        // Generate filter output
        function generateFilter() {
            // Get current date formatted as "DD MMM"
            const now = new Date();
            const day = now.getDate();
            const month = now.toLocaleString('en-US', { month: 'short' });
            const dateStr = `${day} ${month}`;
            
            let filter = '// FilterPhoenix Visual Filter Builder\n';
            filter += '// Generated: ' + new Date().toLocaleString() + '\n\n';
            filter += 'Attribute[Author]: Filter Builder\n';
            filter += 'Attribute[Name]: You\n';
            filter += `Attribute[Date]: ${dateStr}\n\n`;

            // Add FilterLevel declarations if enabled (only for named levels)
            if (globalSettings.enableFilterLevels) {
                const namedLevels = globalSettings.levelNames
                    .map((name, idx) => ({ name, level: idx + 1 }))
                    .filter(item => item.name);
                
                if (namedLevels.length > 0) {
                    filter += '// === FILTER LEVELS ===\n\n';
                    namedLevels.forEach(item => {
                        filter += `FilterLevel[${item.level}]: ${item.name}\n`;
                    });
                    filter += '\n';
                }
            }

            // Check if any items need custom styles (for border/background colors)
            let needsCustomStyle = false;
            
            utilityItems.forEach(item => {
                const state = filterState.utility[item.code];
                if (state.show) {
                    const needsBorder = state.useCustomColors && state.borderColor !== null;
                    const needsBackground = state.useCustomColors && state.backgroundColor !== null;
                    const needsNotification = state.chatNotification;
                    if (needsBorder || needsBackground || needsNotification) {
                        needsCustomStyle = true;
                    }
                }
            });

            runeItems.forEach(item => {
                const state = filterState.runes[item.code];
                if (state.show) {
                    const needsBorder = state.useCustomColors && state.borderColor !== null;
                    const needsBackground = state.useCustomColors && state.backgroundColor !== null;
                    const needsNotification = state.chatNotification;
                    if (needsBorder || needsBackground || needsNotification) {
                        needsCustomStyle = true;
                    }
                }
            });

            gemItems.forEach(item => {
                const state = filterState.gems[item.code];
                if (state.show) {
                    const needsBorder = state.useCustomColors && state.borderColor !== null;
                    const needsBackground = state.useCustomColors && state.backgroundColor !== null;
                    const needsNotification = state.chatNotification;
                    if (needsBorder || needsBackground || needsNotification) {
                        needsCustomStyle = true;
                    }
                }
            });

            miscItems.forEach(item => {
                const state = filterState.misc[item.code];
                if (state.show) {
                    const needsBorder = state.useCustomColors && state.borderColor !== null;
                    const needsBackground = state.useCustomColors && state.backgroundColor !== null;
                    const needsNotification = state.chatNotification;
                    if (needsBorder || needsBackground || needsNotification) {
                        needsCustomStyle = true;
                    }
                }
            });

            // Generate single ItemStyle declaration if needed
            if (needsCustomStyle) {
                filter += '// === CUSTOM STYLE ===\n\n';
                filter += 'ItemStyle[CustomDisplay]: NotificationColor = WHITE\n\n';
            }

            // Filter Start
            filter += '// === Default of never hiding runewords or identified items ===\n\n';
//            filter += 'ItemDisplay[RW]: %NAME%\n';
//            filter += 'ItemDisplay[ID]: %NAME%\n\n';


            // Utility items
            filter += '// === UTILITY ITEMS ===\n\n';
            utilityItems.forEach(item => {
                const state = filterState.utility[item.code];
                if (state.show) {
                    // Generate filter level condition if enabled
                    const filtLvlCondition = generateFilterLevelCondition(state.filterLevels);
                    let line = `ItemDisplay[${item.code}${filtLvlCondition}]:`;
                    
                    // Only add colors if custom colors are enabled
                    if (state.useCustomColors && state.fontColor !== 'WHITE') {
                        line += ` %${state.fontColor}%`;
                    }
                    
                    if (state.biggerClickbox) {
                        line += ` %NL%       %NAME%       %NL%%NL%`;
                    } else {
                        line += ` %NAME%`;
                    }
                    
                    // Add style reference for border/background/notification if needed
                    if (state.useCustomColors || state.chatNotification) {
                        const needsBorder = state.useCustomColors && state.borderColor !== null;
                        const needsBackground = state.useCustomColors && state.backgroundColor !== null;
                        const needsNotification = state.chatNotification;
                        
                        if (needsBorder || needsBackground || needsNotification) {
                            const rgbParts = [];
                            if (needsNotification) {
                                rgbParts.push(`NotificationColor = ${state.fontColor}`);
                            }
                            if (needsBorder) {
                                const rgb = hexToRGBSlash(state.borderColor);
                                rgbParts.push(`BorderColor = RGB(${rgb}), BorderSize = 3`);
                            }
                            if (needsBackground) {
                                const rgb = hexToRGBSlash(state.backgroundColor);
                                rgbParts.push(`BackgroundColor = RGB(${rgb})`);
                            }
                            line += ` <:CustomDisplay: ${rgbParts.join(', ')}>`;
                        }
                    }
                    
                    filter += line + '\n';
                } else {
                    filter += `ItemDisplay[${item.code}]:\n`;
                }
            });

            // Runes
            filter += '\n// === RUNES ===\n\n';
            runeItems.forEach(item => {
                const state = filterState.runes[item.code];
                if (state.show) {
                    // Generate filter level condition if enabled
                    const filtLvlCondition = generateFilterLevelCondition(state.filterLevels);
                    let line = `ItemDisplay[${item.code}${filtLvlCondition}]:`;
                    
                    // Only add colors if custom colors are enabled
                    if (state.useCustomColors && state.fontColor !== 'ORANGE') {
                        line += ` %${state.fontColor}%`;
                    }
                    
                    if (state.biggerClickbox) {
                        line += ` %NL%       %NAME%       %NL%%NL%`;
                    } else {
                        line += ` %NAME%`;
                    }
                    
                    // Add style reference for border/background/notification if needed
                    if (state.useCustomColors || state.chatNotification) {
                        const needsBorder = state.useCustomColors && state.borderColor !== null;
                        const needsBackground = state.useCustomColors && state.backgroundColor !== null;
                        const needsNotification = state.chatNotification;
                        
                        if (needsBorder || needsBackground || needsNotification) {
                            const rgbParts = [];
                            if (needsNotification) {
                                rgbParts.push(`NotificationColor = ${state.fontColor}`);
                            }
                            if (needsBorder) {
                                const rgb = hexToRGBSlash(state.borderColor);
                                rgbParts.push(`BorderColor = RGB(${rgb}), BorderSize = 3`);
                            }
                            if (needsBackground) {
                                const rgb = hexToRGBSlash(state.backgroundColor);
                                rgbParts.push(`BackgroundColor = RGB(${rgb})`);
                            }
                            line += ` <:CustomDisplay: ${rgbParts.join(', ')}>`;
                        }
                    }
                    
                    filter += line + '\n';
                } else {
                    filter += `ItemDisplay[${item.code}]:\n`;
                }
            });

            // Gems
            filter += '\n// === GEMS ===\n\n';
            gemItems.forEach(item => {
                const state = filterState.gems[item.code];
                if (state.show) {
                    // Generate filter level condition if enabled
                    const filtLvlCondition = generateFilterLevelCondition(state.filterLevels);
                    let line = `ItemDisplay[${item.code}${filtLvlCondition}]:`;
                    
                    // Only add colors if custom colors are enabled
                    if (state.useCustomColors && state.fontColor !== 'WHITE') {
                        line += ` %${state.fontColor}%`;
                    }
                    
                    if (state.biggerClickbox) {
                        line += ` %NL%       %NAME%       %NL%%NL%`;
                    } else {
                        line += ` %NAME%`;
                    }
                    
                    // Add style reference for border/background/notification if needed
                    if (state.useCustomColors || state.chatNotification) {
                        const needsBorder = state.useCustomColors && state.borderColor !== null;
                        const needsBackground = state.useCustomColors && state.backgroundColor !== null;
                        const needsNotification = state.chatNotification;
                        
                        if (needsBorder || needsBackground || needsNotification) {
                            const rgbParts = [];
                            if (needsNotification) {
                                rgbParts.push(`NotificationColor = ${state.fontColor}`);
                            }
                            if (needsBorder) {
                                const rgb = hexToRGBSlash(state.borderColor);
                                rgbParts.push(`BorderColor = RGB(${rgb}), BorderSize = 3`);
                            }
                            if (needsBackground) {
                                const rgb = hexToRGBSlash(state.backgroundColor);
                                rgbParts.push(`BackgroundColor = RGB(${rgb})`);
                            }
                            line += ` <:CustomDisplay: ${rgbParts.join(', ')}>`;
                        }
                    }
                    
                    filter += line + '\n';
                } else {
                    filter += `ItemDisplay[${item.code}]:\n`;
                }
            });

            // PoD/Misc Items
            filter += '\n// === POD/Keys/Maps/MISC ITEMS ===\n\n';
            miscItems.forEach(item => {
                const state = filterState.misc[item.code];
                if (state.show) {
                    // Generate filter level condition if enabled
                    const filtLvlCondition = generateFilterLevelCondition(state.filterLevels);
                    let line = `ItemDisplay[${item.code}${filtLvlCondition}]:`;
                    
                    // Only add colors if custom colors are enabled
                    if (state.useCustomColors && state.fontColor !== 'PURPLE') {
                        line += ` %${state.fontColor}%`;
                    }
                    
                    if (state.biggerClickbox) {
                        line += ` %NL%       %NAME%       %NL%%NL%`;
                    } else {
                        line += ` %NAME%`;
                    }
                    
                    // Add style reference for border/background/notification if needed
                    if (state.useCustomColors || state.chatNotification) {
                        const needsBorder = state.useCustomColors && state.borderColor !== null;
                        const needsBackground = state.useCustomColors && state.backgroundColor !== null;
                        const needsNotification = state.chatNotification;
                        
                        if (needsBorder || needsBackground || needsNotification) {
                            const rgbParts = [];
                            if (needsNotification) {
                                rgbParts.push(`NotificationColor = ${state.fontColor}`);
                            }
                            if (needsBorder) {
                                const rgb = hexToRGBSlash(state.borderColor);
                                rgbParts.push(`BorderColor = RGB(${rgb}), BorderSize = 3`);
                            }
                            if (needsBackground) {
                                const rgb = hexToRGBSlash(state.backgroundColor);
                                rgbParts.push(`BackgroundColor = RGB(${rgb})`);
                            }
                            line += ` <:CustomDisplay: ${rgbParts.join(', ')}>`;
                        }
                    }
                    
                    filter += line + '\n';
                } else {
                    filter += `ItemDisplay[${item.code}]:\n`;
                }
            });

            // === UNIQUE ITEMS ===
            filter += '\n// === UNIQUE ITEMS ===\n\n';
            
            // Helper function to generate unique item filter lines
            function generateUniqueItemLines(items, stateCategory, sectionTitle) {
                let lines = `// ${sectionTitle}\n`;
                let hasItems = false;
                
                items.forEach(item => {
                    const key = item.name.replace(/[^a-zA-Z0-9]/g, '_');
                    const state = filterState[stateCategory][key];
                    if (state.show) {
                        hasItems = true;
                        // Generate filter level condition if enabled
                        const filtLvlCondition = generateFilterLevelCondition(state.filterLevels);
                        let line = `ItemDisplay[UNI ${item.code}${filtLvlCondition}]:`;
                        
                        // Only add colors if custom colors are enabled
                        if (state.useCustomColors && state.fontColor !== 'DARK_GREEN') {
                            line += ` %${state.fontColor}%`;
                        }
                        
                        line += ` %NAME%`;
                        
                        // Add style reference for border/background/notification if needed
                        if (state.useCustomColors || state.chatNotification) {
                            const needsBorder = state.useCustomColors && state.borderColor !== null;
                            const needsBackground = state.useCustomColors && state.backgroundColor !== null;
                            const needsNotification = state.chatNotification;
                            
                            if (needsBorder || needsBackground || needsNotification) {
                                const rgbParts = [];
                                if (needsNotification) {
                                    rgbParts.push(`NotificationColor = ${state.fontColor}`);
                                }
                                if (needsBorder) {
                                    const rgb = hexToRGBSlash(state.borderColor);
                                    rgbParts.push(`BorderColor = RGB(${rgb}), BorderSize = 3`);
                                }
                                if (needsBackground) {
                                    const rgb = hexToRGBSlash(state.backgroundColor);
                                    rgbParts.push(`BackgroundColor = RGB(${rgb})`);
                                }
                                line += ` <:CustomDisplay: ${rgbParts.join(', ')}>`;
                            }
                        }
                        
                        lines += line + '\n';
                    } else {
                        lines += `ItemDisplay[UNI ${item.code}]:\n`;
                    }
                });
                
                return hasItems ? lines + '\n' : '';
            }

            // Helper function to generate set item filter lines (uses SET keyword)
            function generateSetItemLines(items, stateCategory, sectionTitle) {
                let lines = `// ${sectionTitle}\n`;
                let hasItems = false;
                
                items.forEach(item => {
                    const key = item.code + '_' + item.set;
                    const state = filterState[stateCategory][key];
                    if (state.show) {
                        hasItems = true;
                        // Generate filter level condition if enabled
                        const filtLvlCondition = generateFilterLevelCondition(state.filterLevels);
                        let line = `ItemDisplay[SET ${item.code}${filtLvlCondition}]:`;
                        
                        // Only add colors if custom colors are enabled
                        if (state.useCustomColors && state.fontColor !== 'DARK_GREEN') {
                            line += ` %${state.fontColor}%`;
                        }
                        
                        line += ` %NAME%`;
                        
                        // Add style reference for border/background/notification if needed
                        if (state.useCustomColors || state.chatNotification) {
                            const needsBorder = state.useCustomColors && state.borderColor !== null;
                            const needsBackground = state.useCustomColors && state.backgroundColor !== null;
                            const needsNotification = state.chatNotification;
                            
                            if (needsBorder || needsBackground || needsNotification) {
                                const rgbParts = [];
                                if (needsNotification) {
                                    rgbParts.push(`NotificationColor = ${state.fontColor}`);
                                }
                                if (needsBorder) {
                                    const rgb = hexToRGBSlash(state.borderColor);
                                    rgbParts.push(`BorderColor = RGB(${rgb}), BorderSize = 3`);
                                }
                                if (needsBackground) {
                                    const rgb = hexToRGBSlash(state.backgroundColor);
                                    rgbParts.push(`BackgroundColor = RGB(${rgb})`);
                                }
                                line += ` <:CustomDisplay: ${rgbParts.join(', ')}>`;
                            }
                        }
                        
                        lines += line + '\n';
                    } else {
                        lines += `ItemDisplay[SET ${item.code}]:\n`;
                    }
                });
                
                return hasItems ? lines + '\n' : '';
            }
            
            function generateMagicRareItemLines(items, stateCategory, sectionTitle, rarity) {
                let lines = `// ${sectionTitle}\n`;
                let hasItems = false;
                
                items.forEach((item, idx) => {
                    const key = item.code + '_' + idx;
                    const state = filterState[stateCategory][key];
                    if (state.show) {
                        hasItems = true;
                        // Generate filter level condition if enabled
                        const filtLvlCondition = generateFilterLevelCondition(state.filterLevels);
                        
                        // Build ILVL condition
                        let ilvlCondition = '';
                        if (item.minIlvl !== undefined && item.maxIlvl !== undefined) {
                            ilvlCondition = ` ILVL>${item.minIlvl} ILVL<${item.maxIlvl}`;
                        } else if (item.minIlvl !== undefined) {
                            ilvlCondition = ` ILVL>${item.minIlvl}`;
                        } else if (item.maxIlvl !== undefined) {
                            ilvlCondition = ` ILVL<${item.maxIlvl}`;
                        }
                        
                        let line = `ItemDisplay[${rarity} ${item.code} !ID${ilvlCondition}${filtLvlCondition}]:`;
                        
                        // Add font color
                        if (state.useCustomColors && state.fontColor) {
                            line += ` %${state.fontColor}%`;
                        } else if (rarity === 'MAG') {
                            line += ` %BLUE%`;
                        } else {
                            line += ` %YELLOW%`;
                        }
                        
                        line += ` %NAME%`;
                        
                        // Add ILVL display for magic jewelry and charms, description for others
                        if (stateCategory === 'magicJewelry' || stateCategory === 'magicCharms') {
                            line += ` %WHITE%[%ILVL%]`;
                        } else if (item.desc) {
                            line += ` {${item.desc}}`;
                        }
                        
                        // Add style reference for border/background/notification if needed
                        if (state.useCustomColors || state.chatNotification) {
                            const needsBorder = state.useCustomColors && state.borderColor !== null;
                            const needsBackground = state.useCustomColors && state.backgroundColor !== null;
                            const needsNotification = state.chatNotification;
                            
                            if (needsBorder || needsBackground || needsNotification) {
                                const rgbParts = [];
                                if (needsNotification) {
                                    const notifyColor = state.fontColor || (rarity === 'MAG' ? 'BLUE' : 'YELLOW');
                                    rgbParts.push(`NotificationColor = ${notifyColor}`);
                                }
                                if (needsBorder) {
                                    const rgb = hexToRGBSlash(state.borderColor);
                                    rgbParts.push(`BorderColor = RGB(${rgb}), BorderSize = 3`);
                                }
                                if (needsBackground) {
                                    const rgb = hexToRGBSlash(state.backgroundColor);
                                    rgbParts.push(`BackgroundColor = RGB(${rgb})`);
                                }
                                line += ` <:CustomDisplay: ${rgbParts.join(', ')}>`;
                            }
                        }
                        
                        lines += line + '\n';
                    } else {
                        // Build hide condition
                        let ilvlCondition = '';
                        if (item.minIlvl !== undefined && item.maxIlvl !== undefined) {
                            ilvlCondition = ` ILVL>${item.minIlvl} ILVL<${item.maxIlvl}`;
                        } else if (item.minIlvl !== undefined) {
                            ilvlCondition = ` ILVL>${item.minIlvl}`;
                        } else if (item.maxIlvl !== undefined) {
                            ilvlCondition = ` ILVL<${item.maxIlvl}`;
                        }
                        lines += `ItemDisplay[${rarity} ${item.code} !ID${ilvlCondition}]:\n`;
                    }
                });
                
                return hasItems ? lines + '\n' : '';
            }
            
            function generateNmagItemLines(items, stateCategory, sectionTitle) {
                let lines = `// ${sectionTitle}\n`;
                let hasItems = false;
                
                items.forEach((item, idx) => {
                    const key = item.code + '_' + idx;
                    const state = filterState[stateCategory][key];
                    if (state.show) {
                        hasItems = true;
                        
                        // Add comment with item name and code for debugging
                        lines += `// ${item.name} (${item.code})\n`;
                        
                        // Generate filter level condition if enabled
                        const filtLvlCondition = generateFilterLevelCondition(state.filterLevels);
                        
                        // Build socket condition
                        let sockCondition = '';
                        if (state.sockFilter.length > 0) {
                            if (state.sockFilter.length === 1) {
                                sockCondition = ` SOCK=${state.sockFilter[0]}`;
                            } else {
                                // Multiple socket values: (SOCK=3 OR SOCK=4)
                                const sockParts = state.sockFilter.map(s => `SOCK=${s}`).join(' OR ');
                                sockCondition = ` (${sockParts})`;
                            }
                        }
                        
                        // Build ED condition
                        let edCondition = '';
                        if (state.edFilter === '15') {
                            edCondition = ' ED=15';
                        } else if (state.edFilter === '14+') {
                            edCondition = ' ED>13';
                        } else if (state.edFilter === '13+') {
                            edCondition = ' ED>12';
                        } else if (state.edFilter === '12+') {
                            edCondition = ' ED>11';
                        } else if (state.edFilter === '10+') {
                            edCondition = ' ED>9';
                        }
                        
                        // Build style reference for border/background/notification if needed
                        let styleRef = '';
                        if (state.useCustomColors || state.chatNotification) {
                            const needsBorder = state.useCustomColors && state.borderColor !== null;
                            const needsBackground = state.useCustomColors && state.backgroundColor !== null;
                            const needsNotification = state.chatNotification;
                            
                            if (needsBorder || needsBackground || needsNotification) {
                                const rgbParts = [];
                                if (needsNotification) {
                                    const notifyColor = state.fontColor || 'WHITE';
                                    rgbParts.push(`NotificationColor = ${notifyColor}`);
                                }
                                if (needsBorder) {
                                    const rgb = hexToRGBSlash(state.borderColor);
                                    rgbParts.push(`BorderColor = RGB(${rgb}), BorderSize = 3`);
                                }
                                if (needsBackground) {
                                    const rgb = hexToRGBSlash(state.backgroundColor);
                                    rgbParts.push(`BackgroundColor = RGB(${rgb})`);
                                }
                                styleRef = ` <:CustomDisplay: ${rgbParts.join(', ')}>`;
                            }
                        }
                        
                        // Handle ETH filter - generate two lines when 'any'
                        if (state.ethFilter === 'eth-only') {
                            // ETH only - gray font for everything
                            let line = `ItemDisplay[NMAG ${item.code} ETH${sockCondition}${edCondition}${filtLvlCondition}]: %GRAY% %NAME% [%SOCKETS%]${styleRef}`;
                            lines += line + '\n';
                        } else if (state.ethFilter === 'non-eth') {
                            // Non-ETH only - white name, gray sockets
                            let line = `ItemDisplay[NMAG ${item.code} !ETH${sockCondition}${edCondition}${filtLvlCondition}]:`;
                            if (state.useCustomColors && state.fontColor) {
                                line += ` %${state.fontColor}%`;
                            } else {
                                line += ` %WHITE%`;
                            }
                            line += ` %NAME% %GRAY%[%SOCKETS%]${styleRef}`;
                            lines += line + '\n';
                        } else {
                            // 'any' - generate two lines: ETH first (gray), then non-ETH (white+gray)
                            // Line 1: ETH - all gray
                            let ethLine = `ItemDisplay[NMAG ${item.code} ETH${sockCondition}${edCondition}${filtLvlCondition}]: %GRAY% %NAME% [%SOCKETS%]${styleRef}`;
                            lines += ethLine + '\n';
                            
                            // Line 2: Non-ETH - white name, gray sockets
                            let nonEthLine = `ItemDisplay[NMAG ${item.code}${sockCondition}${edCondition}${filtLvlCondition}]:`;
                            if (state.useCustomColors && state.fontColor) {
                                nonEthLine += ` %${state.fontColor}%`;
                            } else {
                                nonEthLine += ` %WHITE%`;
                            }
                            nonEthLine += ` %NAME% %GRAY%[%SOCKETS%]${styleRef}`;
                            lines += nonEthLine + '\n';
                        }
                    } else {
                        // Build hide condition - match the show conditions
                        let ethCondition = '';
                        if (state.ethFilter === 'eth-only') {
                            ethCondition = ' ETH';
                        } else if (state.ethFilter === 'non-eth') {
                            ethCondition = ' !ETH';
                        }
                        
                        let sockCondition = '';
                        if (state.sockFilter !== 'any') {
                            sockCondition = ` SOCK=${state.sockFilter}`;
                        }
                        
                        let edCondition = '';
                        if (state.edFilter === '15') {
                            edCondition = ' ED=15';
                        } else if (state.edFilter === '14+') {
                            edCondition = ' ED>13';
                        } else if (state.edFilter === '13+') {
                            edCondition = ' ED>12';
                        } else if (state.edFilter === '12+') {
                            edCondition = ' ED>11';
                        } else if (state.edFilter === '10+') {
                            edCondition = ' ED>9';
                        }
                        
                        lines += `ItemDisplay[NMAG ${item.code}${ethCondition}${sockCondition}${edCondition}]:\n`;
                    }
                });
                
                return hasItems ? lines + '\n' : '';
            }
            
            filter += generateUniqueItemLines(jewelryAndCharms, 'jewelryCharms', 'Unique Jewelry & Charms');
            filter += generateUniqueItemLines(classSpecificUniques, 'classUniques', 'Class-Specific Uniques');
            filter += generateUniqueItemLines(eliteUniqueWeapons, 'eliteWeapons', 'Elite Unique Weapons');
            filter += generateUniqueItemLines(eliteUniqueArmor, 'eliteArmor', 'Elite Unique Armor');
            filter += generateUniqueItemLines(exceptionalUniqueWeapons, 'excWeapons', 'Exceptional Unique Weapons');
            filter += generateUniqueItemLines(exceptionalUniqueArmor, 'excArmor', 'Exceptional Unique Armor');
            filter += generateUniqueItemLines(normalUniqueWeapons, 'normWeapons', 'Normal Unique Weapons');
            filter += generateUniqueItemLines(normalUniqueArmor, 'normArmor', 'Normal Unique Armor');

            // === SET ITEMS ===
            filter += '\n// === SET ITEMS ===\n\n';
            filter += generateSetItemLines(highLevelSets, 'highSets', 'High-Level Set Items');
            filter += generateSetItemLines(midLevelSets, 'midSets', 'Mid-Level Set Items');
            filter += generateSetItemLines(lowLevelSets, 'lowSets', 'Low-Level Set Items');

            // === MAGIC ITEMS ===
            filter += '\n// === MAGIC ITEMS ===\n\n';
            filter += generateMagicRareItemLines(magicJewelry, 'magicJewelry', 'Magic Jewelry & Jewels', 'MAG');
            filter += generateMagicRareItemLines(magicCharms, 'magicCharms', 'Magic Charms', 'MAG');
            filter += generateMagicRareItemLines(magicCraftingBases, 'magicCrafting', 'Magic Crafting Bases', 'MAG');

            // === RARE ITEMS ===
            filter += '\n// === RARE ITEMS ===\n\n';
            filter += generateMagicRareItemLines(rareJewelry, 'rareJewelry', 'Rare Jewelry & Jewels', 'RARE');
            filter += generateMagicRareItemLines(rareClassItems, 'rareClassItems', 'Rare Class-Specific Items', 'RARE');
            filter += generateMagicRareItemLines(rareEliteBases, 'rareEliteBases', 'Rare Elite Bases', 'RARE');

            filter += '\n// === Always show runewords and identified items ===\n';
            filter += 'ItemDisplay[RW]: %NAME%\n';
            filter += 'ItemDisplay[(MAG OR RARE OR SET OR UNI OR CRAFT) ID]: %NAME%\n\n';

            // === NMAG RUNEWORD BASES ===
            filter += '\n// === NMAG RUNEWORD BASES ===\n\n';
            filter += generateNmagItemLines(nmagPolearms, 'nmagPolearms', 'NMAG: Polearms (Insight, Infinity, Obedience)');
            filter += generateNmagItemLines(nmagSwords, 'nmagSwords', 'NMAG: Swords (Spirit, Grief)');
            filter += generateNmagItemLines(nmagAxes, 'nmagAxes', 'NMAG: Axes (Grief, Beast, Death)');
            filter += generateNmagItemLines(nmagMaces, 'nmagMaces', 'NMAG: Maces (BoTD, Heart of the Oak)');
            filter += generateNmagItemLines(nmagStaves, 'nmagStaves', 'NMAG: Staves (CTA, Memory');
            filter += generateNmagItemLines(nmagSpears, 'nmagSpears', 'NMAG: Spears (Infinity, Insight, Pride, Obedience)');
            filter += generateNmagItemLines(nmagBows, 'nmagBows', 'NMAG: Bows (Faith, Ice, Brand, Insight)');
            filter += generateNmagItemLines(nmagArmor, 'nmagArmor', 'NMAG: Armor (Enigma, Fortitude, CoH, Bramble)');
            filter += generateNmagItemLines(nmagShieldsGeneric, 'nmagShieldsGeneric', 'NMAG: Shields - Generic (Spirit, Dream, Splendor)');
            filter += generateNmagItemLines(nmagShieldsPaladin, 'nmagShieldsPaladin', 'NMAG: Shields - Paladin (Spirit, Exile)');
            filter += generateNmagItemLines(nmagHelms, 'nmagHelms', 'NMAG: Helms (Delirium, Dream)');
            filter += generateNmagItemLines(nmagDruidPelts, 'nmagDruidPelts', 'NMAG: Druid Pelts (Delirium, Metamorphosis)');
            filter += generateNmagItemLines(nmagNecroHeads, 'nmagNecroHeads', 'NMAG: Necro Shrunken Heads (Splendor, Rhyme)');
            filter += generateNmagItemLines(nmagAssassinClaws, 'nmagAssassinClaws', 'NMAG: Assassin Claws (Chaos, Fury, Plague)');
            filter += generateNmagItemLines(nmagSorcOrbs, 'nmagSorcOrbs', 'NMAG: Sorc Orbs (Plague)');
            filter += generateNmagItemLines(nmagDaggers, 'nmagDaggers', 'NMAG: Daggers');
            filter += generateNmagItemLines(nmagWands, 'nmagWands', 'NMAG: Wands (White, Memory)');
            filter += generateNmagItemLines(nmagScepters, 'nmagScepters', 'NMAG: Scepters (Spirit, Hoto, Sanctuary)');
            filter += generateNmagItemLines(nmagBarbarianHelms, 'nmagBarbarianHelms', 'NMAG: Barbarian Helms (Delirium, Dream)');
            
            filter += '\n// ===== Other NMAG base items to follow =====\n\n';
            
            filter += generateNmagItemLines(nmagPolearmsExtended, 'nmagPolearmsExtended', 'NMAG Extended: Polearms');
            filter += generateNmagItemLines(nmagSwordsExtended, 'nmagSwordsExtended', 'NMAG Extended: Swords');
            filter += generateNmagItemLines(nmagAxesExtended, 'nmagAxesExtended', 'NMAG Extended: Axes');
            filter += generateNmagItemLines(nmagMacesExtended, 'nmagMacesExtended', 'NMAG Extended: Maces');
            filter += generateNmagItemLines(nmagStavesExtended, 'nmagStavesExtended', 'NMAG Extended: Staves');
            filter += generateNmagItemLines(nmagSpearsExtended, 'nmagSpearsExtended', 'NMAG Extended: Spears');
            filter += generateNmagItemLines(nmagBowsExtended, 'nmagBowsExtended', 'NMAG Extended: Bows');
            filter += generateNmagItemLines(nmagCrossbows, 'nmagCrossbows', 'NMAG Extended: Crossbows');
            filter += generateNmagItemLines(nmagJavelins, 'nmagJavelins', 'NMAG Extended: Javelins');
            filter += generateNmagItemLines(nmagArmorExtended, 'nmagArmorExtended', 'NMAG Extended: Armor');
            filter += generateNmagItemLines(nmagShieldsExtended, 'nmagShieldsExtended', 'NMAG Extended: Shields');
            filter += generateNmagItemLines(nmagPaladinShieldsExtended, 'nmagPaladinShieldsExtended', 'NMAG Extended: Paladin Shields');
            filter += generateNmagItemLines(nmagNecromancerShieldsExtended, 'nmagNecromancerShieldsExtended', 'NMAG Extended: Necromancer Shields');
            filter += generateNmagItemLines(nmagHelmsExtended, 'nmagHelmsExtended', 'NMAG Extended: Helms');
            filter += generateNmagItemLines(nmagDruidPeltsExtended, 'nmagDruidPeltsExtended', 'NMAG Extended: Druid Pelts');
            filter += generateNmagItemLines(nmagNecroHeadsExtended, 'nmagNecroHeadsExtended', 'NMAG Extended: Necro Heads');
            filter += generateNmagItemLines(nmagAssassinClawsExtended, 'nmagAssassinClawsExtended', 'NMAG Extended: Assassin Claws');
            filter += generateNmagItemLines(nmagSorcOrbsExtended, 'nmagSorcOrbsExtended', 'NMAG Extended: Sorc Orbs');
            filter += generateNmagItemLines(nmagDaggersExtended, 'nmagDaggersExtended', 'NMAG Extended: Daggers');
            filter += generateNmagItemLines(nmagWandsExtended, 'nmagWandsExtended', 'NMAG Extended: Wands');
            filter += generateNmagItemLines(nmagSceptersExtended, 'nmagSceptersExtended', 'NMAG Extended: Scepters');
            filter += generateNmagItemLines(nmagBarbarianHelmsExtended, 'nmagBarbarianHelmsExtended', 'NMAG Extended: Barbarian Helms');
            filter += generateNmagItemLines(nmagAmazonWeapons, 'nmagAmazonWeapons', 'NMAG Extended: Amazon Weapons');
            filter += generateNmagItemLines(nmagCirclets, 'nmagCirclets', 'NMAG Extended: Circlets');

            // === FILTER CLOSING ===
            if (globalSettings.hideJunk) {
                filter += '\n// Hide junk items\n';
                filter += 'ItemDisplay[(ARMOR OR WEAPON) INF]:\n';
            }
            if (globalSettings.showAll) {
                filter += '\n// Show all remaining items\n';
                filter += 'ItemDisplay[]: %NAME%\n';
            }

            document.getElementById('filter-output').value = filter;
            updateOutputStats();
        }

        // Helper function to generate FILTLVL condition from filterLevels array
        function generateFilterLevelCondition(filterLevels) {
            if (!globalSettings.enableFilterLevels) return '';
            
            // Check if all levels are enabled
            const enabledLevels = filterLevels.map((enabled, idx) => enabled ? idx + 1 : null).filter(l => l !== null);
            if (enabledLevels.length === 10) return ''; // All levels, no condition needed
            if (enabledLevels.length === 0) return ''; // None enabled, item won't show anyway
            
            // Use simple range operators when possible
            const minLevel = Math.min(...enabledLevels);
            const maxLevel = Math.max(...enabledLevels);
            
            // Check if it's a continuous range
            const isContinuous = enabledLevels.length === (maxLevel - minLevel + 1);
            
            if (isContinuous) {
                // Single continuous range
                if (minLevel === maxLevel) {
                    return ` FILTERLVL=${minLevel}`;
                } else if (minLevel === 1) {
                    return ` FILTERLVL<${maxLevel + 1}`;
                } else if (maxLevel === 10) {
                    return ` FILTERLVL>${minLevel - 1}`;
                } else {
                    return ` (FILTERLVL>${minLevel - 1} AND FILTERLVL<${maxLevel + 1})`;
                }
            }
            
            // Multiple ranges - fall back to OR logic
            const ranges = [];
            let rangeStart = enabledLevels[0];
            let rangeEnd = enabledLevels[0];
            
            for (let i = 1; i <= enabledLevels.length; i++) {
                const currentLevel = enabledLevels[i];
                
                if (currentLevel === rangeEnd + 1) {
                    rangeEnd = currentLevel;
                } else {
                    // End of range, save it
                    if (rangeStart === rangeEnd) {
                        ranges.push(`FILTERLVL=${rangeStart}`);
                    } else {
                        ranges.push(`(FILTERLVL>${rangeStart - 1} AND FILTERLVL<${rangeEnd + 1})`);
                    }
                    
                    if (i < enabledLevels.length) {
                        rangeStart = currentLevel;
                        rangeEnd = currentLevel;
                    }
                }
            }
            
            return ranges.length > 0 ? ' ' + ranges.join(' OR ') : '';
        }

        // Convert hex color to RGB format for filter
        function hexToRGB(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `${r} ${g} ${b}`;
        }

        // Convert hex color to RGB(r/g/b) format for ItemStyle
        function hexToRGBSlash(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `${r}/${g}/${b}`;
        }

        // Update output statistics
        function updateOutputStats() {
            const output = document.getElementById('filter-output').value;
            const lines = output.split('\n').length;
            const chars = output.length;
            document.getElementById('line-count').textContent = lines;
            document.getElementById('char-count').textContent = chars;
        }

        // Highlight and scroll to item in output
        function highlightItemInOutput(itemCode, prefix = null) {
            const textarea = document.getElementById('filter-output');
            const text = textarea.value;
            
            // Build pattern based on whether we have a prefix
            let pattern;
            if (prefix) {
                // Search for specific prefixed item: ItemDisplay[NMAG 7s8]:
                pattern = new RegExp(`ItemDisplay\\[${prefix} ${itemCode}[^\\]]*\\]:`, 'i');
            } else {
                // Search for simple item: ItemDisplay[r01]:
                pattern = new RegExp(`ItemDisplay\\[${itemCode}[^\\]]*\\]:`, 'i');
            }
            
            const match = text.match(pattern);
            
            if (match) {
                const startPos = match.index;
                const endPos = startPos + match[0].length;
                
                // Use setSelectionRange to automatically scroll into view
                textarea.focus();
                textarea.setSelectionRange(startPos, endPos);
                
                // Add highlight effect
                textarea.classList.add('highlight-active');
                
                // Remove selection and highlight after a moment
                setTimeout(() => {
                    textarea.setSelectionRange(endPos, endPos); // Move cursor to end, removing selection
                    textarea.blur(); // Remove focus
                }, 300);
                
                setTimeout(() => {
                    textarea.classList.remove('highlight-active');
                }, 1000);
            }
        }

        // Modal Management Functions
        let currentModalItem = null;

        function openItemSettings(category, itemKey, itemName, itemType = 'unique') {
            currentModalItem = { category, itemKey, itemType };
            
            const modal = document.getElementById('itemSettingsModal');
            const modalTitle = document.getElementById('modalItemName');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = itemName;
            
            // Populate modal with appropriate controls
            modalBody.innerHTML = generateModalContent(category, itemKey, itemType);
            
            modal.classList.add('show');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeItemSettings(event) {
            // Only close if clicking overlay or close button
            if (event && event.target.closest('.modal-container') && !event.target.classList.contains('modal-close')) {
                return;
            }
            
            const modal = document.getElementById('itemSettingsModal');
            modal.classList.remove('show');
            document.body.style.overflow = ''; // Restore scrolling
            currentModalItem = null;
        }

        // Group Settings Functions
        function openGroupSettings(category, categoryDisplayName) {
            const modal = document.getElementById('itemSettingsModal');
            const modalTitle = document.getElementById('modalItemName');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = `Group Settings: ${categoryDisplayName}`;
            
            // Generate group settings modal content
            modalBody.innerHTML = generateGroupSettingsContent(category);
            
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
            
            // Store current group for apply function
            currentModalItem = { isGroup: true, category };
        }

        function generateGroupSettingsContent(category) {
            let html = '';
            
            // Filter Levels Section
            html += '<div class="modal-section">';
            html += '<h4 class="modal-section-title">Filter Levels (Apply to All Items)</h4>';
            html += '<p style="color: #888; font-size: 12px; margin-bottom: 10px;">Select which filter levels to enable for all items in this group:</p>';
            html += '<div class="modal-control-group">';
            html += '<div class="modal-checkbox-grid">';
            // Only show checkboxes for defined filter levels
            for (let i = 1; i <= 10; i++) {
                if (globalSettings.levelNames[i - 1]) {
                    html += `
                        <label class="modal-checkbox-label">
                            <input type="checkbox" id="group-level-${i}">
                            <span>${i}</span>
                        </label>
                    `;
                }
            }
            html += '</div>';
            html += '<div style="margin-top: 10px;">';
            html += '<button class="modal-btn" onclick="setAllGroupLevels(true)">Select All</button>';
            html += '<button class="modal-btn" onclick="setAllGroupLevels(false)">Clear All</button>';
            html += '</div>';
            html += '</div>';
            html += '</div>';

            // Custom Colors Section
            html += '<div class="modal-section">';
            html += '<h4 class="modal-section-title">Custom Colors</h4>';
            html += '<div class="modal-control-group">';
            html += `
                <label class="modal-checkbox-label">
                    <input type="checkbox" id="group-custom-colors" onchange="toggleGroupCustomColors(this.checked)">
                    <span>Enable Custom Colors for All Items</span>
                </label>
            `;
            html += '<div id="group-color-controls" style="display: none; margin-top: 10px;">';
            
            // Font Color
            html += '<div class="modal-color-row">';
            html += '<span class="modal-color-label">Font Color:</span>';
            html += '<select class="modal-select" id="group-font-color">';
//            html += '<option value="">Default</option>';
            FONT_COLORS.forEach(fc => {
                html += `<option value="${fc}">${fc}</option>`;
            });
            html += '</select>';
            html += '</div>';

            // Border Color
            html += '<div class="modal-color-row">';
            html += '<span class="modal-color-label">Border Color:</span>';
            html += '<input type="color" class="modal-color-input" id="group-border-color" value="#ffffff">';
            html += '</div>';

            // Background Color
            html += '<div class="modal-color-row">';
            html += '<span class="modal-color-label">Background Color:</span>';
            html += '<input type="color" class="modal-color-input" id="group-bg-color" value="#000000">';
            html += '</div>';
            
            html += '</div>';
            html += '</div>';
            html += '</div>';

            // Notifications Section
            html += '<div class="modal-section">';
            html += '<h4 class="modal-section-title">Notifications</h4>';
            html += '<div class="modal-control-group">';
            html += `
                <label class="modal-checkbox-label">
                    <input type="checkbox" id="group-notifications">
                    <span>Enable chat notifications for all items in this group</span>
                </label>
            `;
            html += '</div>';
            html += '</div>';

            // Display Options Section
            html += '<div class="modal-section">';
            html += '<h4 class="modal-section-title">Display Options</h4>';
            html += '<div class="modal-control-group">';
            html += `
                <label class="modal-checkbox-label">
                    <input type="checkbox" id="group-bigger-clickbox">
                    <span>Bigger clickbox for all items in this group</span>
                </label>
            `;
            html += '</div>';
            html += '</div>';

            // Apply Button
            html += '<div class="modal-section">';
            html += '<button class="modal-btn modal-btn-primary" onclick="applyGroupSettings()" style="width: 100%; padding: 12px; font-size: 14px; font-weight: bold;">Apply to All Items in Group</button>';
            html += '</div>';

            return html;
        }

        function setAllGroupLevels(checked) {
            for (let i = 1; i <= 10; i++) {
                const checkbox = document.getElementById(`group-level-${i}`);
                if (checkbox) checkbox.checked = checked;
            }
        }

        function toggleGroupCustomColors(enabled) {
            const controls = document.getElementById('group-color-controls');
            if (controls) {
                controls.style.display = enabled ? 'block' : 'none';
            }
        }

        function applyGroupSettings() {
            if (!currentModalItem || !currentModalItem.isGroup) return;
            
            const category = currentModalItem.category;
            
            // Map kebab-case category names to camelCase filterState keys
            const categoryMap = {
                'utility': 'utility',
                'runes': 'runes',
                'gems': 'gems',
                'misc': 'misc',
                'jewelry-charms': 'jewelryCharms',
                'class-uniques': 'classUniques',
                'elite-weapons': 'eliteWeapons',
                'elite-armor': 'eliteArmor',
                'exc-weapons': 'excWeapons',
                'exc-armor': 'excArmor',
                'norm-weapons': 'normWeapons',
                'norm-armor': 'normArmor',
                'high-sets': 'highSets',
                'mid-sets': 'midSets',
                'low-sets': 'lowSets',
                'magic-jewelry': 'magicJewelry',
                'magic-charms': 'magicCharms',
                'magic-crafting': 'magicCrafting',
                'rare-jewelry': 'rareJewelry',
                'rare-class-items': 'rareClassItems',
                'rare-elite-bases': 'rareEliteBases',
                'nmag-polearms': 'nmagPolearms',
                'nmag-swords': 'nmagSwords',
                'nmag-axes': 'nmagAxes',
                'nmag-maces': 'nmagMaces',
                'nmag-staves': 'nmagStaves',
                'nmag-spears': 'nmagSpears',
                'nmag-bows': 'nmagBows',
                'nmag-armor': 'nmagArmor',
                'nmag-shields-generic': 'nmagShieldsGeneric',
                'nmag-shields-paladin': 'nmagShieldsPaladin',
                'nmag-helms': 'nmagHelms',
                'nmag-druid-pelts': 'nmagDruidPelts',
                'nmag-necro-heads': 'nmagNecroHeads',
                'nmag-assassin-claws': 'nmagAssassinClaws',
                'nmag-sorc-orbs': 'nmagSorcOrbs',
                'nmag-daggers': 'nmagDaggers',
                'nmag-wands': 'nmagWands',
                'nmag-scepters': 'nmagScepters',
                'nmag-barbarian-helms': 'nmagBarbarianHelms',
                'nmag-polearms-extended': 'nmagPolearmsExtended',
                'nmag-swords-extended': 'nmagSwordsExtended',
                'nmag-axes-extended': 'nmagAxesExtended',
                'nmag-maces-extended': 'nmagMacesExtended',
                'nmag-staves-extended': 'nmagStavesExtended',
                'nmag-spears-extended': 'nmagSpearsExtended',
                'nmag-bows-extended': 'nmagBowsExtended',
                'nmag-crossbows': 'nmagCrossbows',
                'nmag-javelins': 'nmagJavelins',
                'nmag-armor-extended': 'nmagArmorExtended',
                'nmag-shields-extended': 'nmagShieldsExtended',
                'nmag-paladin-shields-extended': 'nmagPaladinShieldsExtended',
                'nmag-necromancer-shields-extended': 'nmagNecromancerShieldsExtended',
                'nmag-helms-extended': 'nmagHelmsExtended',
                'nmag-druid-pelts-extended': 'nmagDruidPeltsExtended',
                'nmag-necro-heads-extended': 'nmagNecroHeadsExtended',
                'nmag-assassin-claws-extended': 'nmagAssassinClawsExtended',
                'nmag-sorc-orbs-extended': 'nmagSorcOrbsExtended',
                'nmag-daggers-extended': 'nmagDaggersExtended',
                'nmag-wands-extended': 'nmagWandsExtended',
                'nmag-scepters-extended': 'nmagSceptersExtended',
                'nmag-barbarian-helms-extended': 'nmagBarbarianHelmsExtended',
                'nmag-amazon-weapons': 'nmagAmazonWeapons',
                'nmag-circlets': 'nmagCirclets'
            };
            
            const stateCategory = categoryMap[category] || category;
            
            // Get selected filter levels
            const selectedLevels = [];
            let anyLevelSelected = false;
            for (let i = 0; i < 10; i++) {
                const checkbox = document.getElementById(`group-level-${i + 1}`);
                if (checkbox && checkbox.checked) {
                    selectedLevels[i] = true;
                    anyLevelSelected = true;
                } else {
                    selectedLevels[i] = false;
                }
            }
            
            // Get color settings
            const useCustomColors = document.getElementById('group-custom-colors')?.checked || false;
            const fontColor = document.getElementById('group-font-color')?.value || '';
            const borderColor = document.getElementById('group-border-color')?.value || '#ffffff';
            const bgColor = document.getElementById('group-bg-color')?.value || '#000000';
            
            // Get notification and clickbox settings
            const chatNotification = document.getElementById('group-notifications')?.checked || false;
            const biggerClickbox = document.getElementById('group-bigger-clickbox')?.checked || false;
            
            // Apply to all items in the category
            if (!filterState[stateCategory]) filterState[stateCategory] = {};
            
            // Get all items in this category
            let itemsToUpdate = [];
            
            // Determine item list based on category
            if (category === 'utility') itemsToUpdate = utilityItems;
            else if (category === 'runes') itemsToUpdate = runeItems;
            else if (category === 'gems') itemsToUpdate = gemItems;
            else if (category === 'misc') itemsToUpdate = miscItems;
            else if (category === 'jewelry-charms') itemsToUpdate = jewelryAndCharms;
            else if (category === 'class-uniques') itemsToUpdate = classSpecificUniques;
            else if (category === 'elite-weapons') itemsToUpdate = eliteUniqueWeapons;
            else if (category === 'elite-armor') itemsToUpdate = eliteUniqueArmor;
            else if (category === 'exc-weapons') itemsToUpdate = exceptionalUniqueWeapons;
            else if (category === 'exc-armor') itemsToUpdate = exceptionalUniqueArmor;
            else if (category === 'norm-weapons') itemsToUpdate = normalUniqueWeapons;
            else if (category === 'norm-armor') itemsToUpdate = normalUniqueArmor;
            else if (category === 'high-sets') itemsToUpdate = highLevelSets;
            else if (category === 'mid-sets') itemsToUpdate = midLevelSets;
            else if (category === 'low-sets') itemsToUpdate = lowLevelSets;
            else if (category === 'magic-jewelry') itemsToUpdate = magicJewelry;
            else if (category === 'magic-charms') itemsToUpdate = magicCharms;
            else if (category === 'magic-crafting') itemsToUpdate = magicCraftingBases;
            else if (category === 'rare-jewelry') itemsToUpdate = rareJewelry;
            else if (category === 'rare-class-items') itemsToUpdate = rareClassItems;
            else if (category === 'rare-elite-bases') itemsToUpdate = rareEliteBases;
            else if (category.startsWith('nmag-')) {
                // Handle NMAG categories
                const nmagCategories = {
                    'nmag-polearms': nmagPolearms,
                    'nmag-swords': nmagSwords,
                    'nmag-axes': nmagAxes,
                    'nmag-maces': nmagMaces,
                    'nmag-staves': nmagStaves,
                    'nmag-spears': nmagSpears,
                    'nmag-bows': nmagBows,
                    'nmag-armor': nmagArmor,
                    'nmag-shields-generic': nmagShieldsGeneric,
                    'nmag-shields-paladin': nmagShieldsPaladin,
                    'nmag-helms': nmagHelms,
                    'nmag-druid-pelts': nmagDruidPelts,
                    'nmag-necro-heads': nmagNecroHeads,
                    'nmag-assassin-claws': nmagAssassinClaws,
                    'nmag-sorc-orbs': nmagSorcOrbs,
                    'nmag-daggers': nmagDaggers,
                    'nmag-wands': nmagWands,
                    'nmag-scepters': nmagScepters,
                    'nmag-barbarian-helms': nmagBarbarianHelms,
                    'nmag-polearms-extended': nmagPolearmsExtended,
                    'nmag-swords-extended': nmagSwordsExtended,
                    'nmag-axes-extended': nmagAxesExtended,
                    'nmag-maces-extended': nmagMacesExtended,
                    'nmag-staves-extended': nmagStavesExtended,
                    'nmag-spears-extended': nmagSpearsExtended,
                    'nmag-bows-extended': nmagBowsExtended,
                    'nmag-crossbows': nmagCrossbows,
                    'nmag-javelins': nmagJavelins,
                    'nmag-armor-extended': nmagArmorExtended,
                    'nmag-shields-extended': nmagShieldsExtended,
                    'nmag-paladin-shields-extended': nmagPaladinShieldsExtended,
                    'nmag-necromancer-shields-extended': nmagNecromancerShieldsExtended,
                    'nmag-helms-extended': nmagHelmsExtended,
                    'nmag-druid-pelts-extended': nmagDruidPeltsExtended,
                    'nmag-necro-heads-extended': nmagNecroHeadsExtended,
                    'nmag-assassin-claws-extended': nmagAssassinClawsExtended,
                    'nmag-sorc-orbs-extended': nmagSorcOrbsExtended,
                    'nmag-daggers-extended': nmagDaggersExtended,
                    'nmag-wands-extended': nmagWandsExtended,
                    'nmag-scepters-extended': nmagSceptersExtended,
                    'nmag-barbarian-helms-extended': nmagBarbarianHelmsExtended,
                    'nmag-amazon-weapons': nmagAmazonWeapons,
                    'nmag-circlets': nmagCirclets
                };
                itemsToUpdate = nmagCategories[category] || [];
            }
            
            // Apply settings to each item
            let successCount = 0;
            itemsToUpdate.forEach((item, idx) => {
                // Determine item key based on category type
                let itemKey;
                
                // Simple items (utility, runes, gems, misc) use code directly
                if (category === 'utility' || category === 'runes' || category === 'gems' || category === 'misc') {
                    itemKey = item.code;
                }
                // Set items use code_set format
                else if (category.includes('-sets')) {
                    itemKey = item.code + '_' + item.set;
                }
                // Magic, rare, and nmag items use code_index format
                else if (category.startsWith('magic-') || category.startsWith('rare-') || category.startsWith('nmag-')) {
                    itemKey = item.code + '_' + idx;
                }
                // Unique items use transformed name
                else if (item.name) {
                    itemKey = item.name.replace(/[^a-zA-Z0-9]/g, '_');
                }
                // Fallback
                else {
                    itemKey = item.code || item.key;
                }
                
                if (!filterState[stateCategory][itemKey]) {
                    filterState[stateCategory][itemKey] = { show: true };
                }
                
                // Apply filter levels if any selected
                if (anyLevelSelected) {
                    filterState[stateCategory][itemKey].filterLevels = [...selectedLevels];
                }
                
                // Apply custom colors
                if (useCustomColors) {
                    filterState[stateCategory][itemKey].useCustomColors = true;
                    if (fontColor) filterState[stateCategory][itemKey].fontColor = fontColor;
                    filterState[stateCategory][itemKey].borderColor = borderColor;
                    filterState[stateCategory][itemKey].backgroundColor = bgColor;
                }
                
                // Apply notification
                if (chatNotification) {
                    filterState[stateCategory][itemKey].chatNotification = true;
                }
                
                // Apply bigger clickbox
                if (biggerClickbox) {
                    filterState[stateCategory][itemKey].biggerClickbox = true;
                }
            });
            
            // Regenerate filter and close modal
            generateFilter();
            closeItemSettings();
            
            // Re-render the category to update button states
            const renderFunctions = {
                'utility': renderUtilityItems,
                'runes': renderRuneItems,
                'gems': renderGemsItems,
                'misc': renderMiscItems,
                'jewelryCharms': renderJewelryCharmsItems,
                'classUniques': renderClassUniquesItems,
                'eliteWeapons': renderEliteWeaponsItems,
                'eliteArmor': renderEliteArmorItems,
                'excWeapons': renderExcWeaponsItems,
                'excArmor': renderExcArmorItems,
                'normWeapons': renderNormWeaponsItems,
                'normArmor': renderNormArmorItems,
                'highSets': renderHighSetsItems,
                'midSets': renderMidSetsItems,
                'lowSets': renderLowSetsItems,
                'magicJewelry': renderMagicJewelryItems,
                'magicCharms': renderMagicCharmsItems,
                'magicCrafting': renderMagicCraftingItems,
                'rareJewelry': renderRareJewelryItems,
                'rareClassItems': renderRareClassItemsItems,
                'rareEliteBases': renderRareEliteBasesItems,
                'nmagPolearms': renderNmagPolearmsItems,
                'nmagSwords': renderNmagSwordsItems,
                'nmagAxes': renderNmagAxesItems,
                'nmagMaces': renderNmagMacesItems,
                'nmagStaves': renderNmagStavesItems,
                'nmagSpears': renderNmagSpearsItems,
                'nmagBows': renderNmagBowsItems,
                'nmagArmor': renderNmagArmorItems,
                'nmagShieldsGeneric': renderNmagShieldsGenericItems,
                'nmagShieldsPaladin': renderNmagShieldsPaladinItems,
                'nmagHelms': renderNmagHelmsItems,
                'nmagDruidPelts': renderNmagDruidPeltsItems,
                'nmagNecroHeads': renderNmagNecroHeadsItems,
                'nmagAssassinClaws': renderNmagAssassinClawsItems,
                'nmagSorcOrbs': renderNmagSorcOrbsItems,
                'nmagPolearmsExtended': renderNmagPolearmsExtendedItems,
                'nmagSwordsExtended': renderNmagSwordsExtendedItems,
                'nmagAxesExtended': renderNmagAxesExtendedItems,
                'nmagMacesExtended': renderNmagMacesExtendedItems,
                'nmagStavesExtended': renderNmagStavesExtendedItems,
                'nmagSpearsExtended': renderNmagSpearsExtendedItems,
                'nmagBowsExtended': renderNmagBowsExtendedItems,
                'nmagCrossbows': renderNmagCrossbowsItems,
                'nmagJavelins': renderNmagJavelinsItems,
                'nmagArmorExtended': renderNmagArmorExtendedItems,
                'nmagShieldsExtended': renderNmagShieldsExtendedItems,
                'nmagPaladinShieldsExtended': renderNmagPaladinShieldsExtendedItems,
                'nmagNecromancerShieldsExtended': renderNmagNecromancerShieldsExtendedItems,
                'nmagHelmsExtended': renderNmagHelmsExtendedItems,
                'nmagDruidPeltsExtended': renderNmagDruidPeltsExtendedItems,
                'nmagNecroHeadsExtended': renderNmagNecroHeadsExtendedItems,
                'nmagAssassinClawsExtended': renderNmagAssassinClawsExtendedItems,
                'nmagSorcOrbsExtended': renderNmagSorcOrbsExtendedItems,
                'nmagDaggersExtended': renderNmagDaggersExtendedItems,
                'nmagWandsExtended': renderNmagWandsExtendedItems,
                'nmagSceptersExtended': renderNmagSceptersExtendedItems,
                'nmagBarbarianHelmsExtended': renderNmagBarbarianHelmsExtendedItems,
                'nmagAmazonWeapons': renderNmagAmazonWeaponsItems,
                'nmagCirclets': renderNmagCircletsItems
            };
            
            const renderFunc = renderFunctions[stateCategory];
            if (renderFunc) {
                renderFunc();
            }
            
            // Show success message
            alert(`Group settings applied to ${itemsToUpdate.length} items!`);
        }

        function generateModalContent(category, itemKey, itemType) {
            const state = filterState[category]?.[itemKey] || {};
            let html = '';

            // NMAG-specific controls
            if (itemType === 'nmag') {
                // Eth Filter
                html += '<div class="modal-section">';
                html += '<h4 class="modal-section-title">Ethereal Filter</h4>';
                html += '<div class="modal-control-group">';
                html += '<select class="modal-select" onchange="updateModalEthFilter(\'' + category + '\', \'' + itemKey + '\', this.value)">';
                const ethFilter = state.ethFilter || 'both';
                html += '<option value="both"' + (ethFilter === 'both' ? ' selected' : '') + '>Both Eth and Non-Eth</option>';
                html += '<option value="eth-only"' + (ethFilter === 'eth-only' ? ' selected' : '') + '>Ethereal Only</option>';
                html += '<option value="non-eth"' + (ethFilter === 'non-eth' ? ' selected' : '') + '>Non-Ethereal Only</option>';
                html += '</select>';
                html += '</div>';
                html += '</div>';

                // Socket Filter
                html += '<div class="modal-section">';
                html += '<h4 class="modal-section-title">Sockets</h4>';
                html += '<div class="socket-checkbox-container">';
                const sockFilter = state.sockFilter || [];
                
                // Get max sockets from state (stored from item array)
                const maxSockets = state.max_sockets || 6;
                
                ['0', '2', '3', '4', '5', '6'].filter(sock => parseInt(sock) <= maxSockets).forEach(sock => {
                    const checked = sockFilter.includes(sock) ? 'checked' : '';
                    const label = sock === '0' ? '0 Sockets' : `${sock} Socket${parseInt(sock) > 1 ? 's' : ''}`;
                    html += `
                        <label class="socket-checkbox-label">
                            <input type="checkbox" ${checked} 
                                onchange="updateModalSocket('${category}', '${itemKey}', '${sock}', this.checked)">
                            <span>${label}</span>
                        </label>
                    `;
                });
                html += '</div>';
                html += '</div>';

                // ED Filter
                html += '<div class="modal-section">';
                html += '<h4 class="modal-section-title">Enhanced Damage</h4>';
                html += '<div class="modal-control-group">';
                html += '<select class="modal-select" onchange="updateModalEDFilter(\'' + category + '\', \'' + itemKey + '\', this.value)">';
                const edFilter = state.edFilter || 'any';
                html += '<option value="any"' + (edFilter === 'any' ? ' selected' : '') + '>Any ED</option>';
                html += '<option value="10+"' + (edFilter === '10+' ? ' selected' : '') + '>10% ED or higher</option>';
                html += '<option value="12+"' + (edFilter === '12+' ? ' selected' : '') + '>12% ED or higher</option>';
                html += '<option value="13+"' + (edFilter === '13+' ? ' selected' : '') + '>13% ED or higher</option>';
                html += '<option value="14+"' + (edFilter === '14+' ? ' selected' : '') + '>14% ED or higher</option>';
                html += '<option value="15"' + (edFilter === '15' ? ' selected' : '') + '>15% ED only</option>';
                html += '</select>';
                html += '</div>';
                html += '</div>';
            }

            // Custom Colors Section
            html += '<div class="modal-section">';
            html += '<h4 class="modal-section-title">Custom Colors</h4>';
            html += '<div class="modal-control-group">';
            
            // Custom colors toggle
            const customEnabled = state.useCustomColors ? 'checked' : '';
            html += `
                <label class="modal-checkbox-label">
                    <input type="checkbox" ${customEnabled} 
                        onchange="toggleModalCustomColor('${category}', '${itemKey}', this.checked, '${itemType}')">
                    <span>Enable Custom Colors</span>
                </label>
            `;

            if (state.useCustomColors) {
                // Font Color
                html += '<div class="modal-color-row">';
                html += '<span class="modal-color-label">Font Color:</span>';
                html += '<select class="modal-select" onchange="updateModalFontColor(\'' + category + '\', \'' + itemKey + '\', this.value, \'' + itemType + '\')">';
//                html += '<option value="">Default</option>';
                FONT_COLORS.forEach(fc => {
                    const selected = state.fontColor === fc ? 'selected' : '';
                    html += `<option value="${fc}" ${selected}>${fc}</option>`;
                });
                html += '</select>';
                html += '<button class="modal-clear-btn" onclick="clearModalFontColor(\'' + category + '\', \'' + itemKey + '\', \'' + itemType + '\')">Clear</button>';
                html += '</div>';

                // Border Color
                html += '<div class="modal-color-row">';
                html += '<span class="modal-color-label">Border Color:</span>';
                const borderColor = state.borderColor || '#ffffff';
                html += '<input type="color" class="modal-color-input" value="' + borderColor + '" ';
                html += 'onchange="updateModalBorderColor(\'' + category + '\', \'' + itemKey + '\', this.value, \'' + itemType + '\')">';
                html += '<button class="modal-clear-btn" onclick="clearModalBorderColor(\'' + category + '\', \'' + itemKey + '\', \'' + itemType + '\')">Clear</button>';
                html += '</div>';

                // Background Color
                html += '<div class="modal-color-row">';
                html += '<span class="modal-color-label">Background Color:</span>';
                const bgColor = state.backgroundColor || '#000000';
                html += '<input type="color" class="modal-color-input" value="' + bgColor + '" ';
                html += 'onchange="updateModalBackgroundColor(\'' + category + '\', \'' + itemKey + '\', this.value, \'' + itemType + '\')">';
                html += '<button class="modal-clear-btn" onclick="clearModalBackgroundColor(\'' + category + '\', \'' + itemKey + '\', \'' + itemType + '\')">Clear</button>';
                html += '</div>';
            }
            
            html += '</div>';
            html += '</div>';

            // Notify Section
            html += '<div class="modal-section">';
            html += '<h4 class="modal-section-title">Notifications</h4>';
            html += '<div class="modal-control-group">';
            const notifyChecked = state.chatNotification ? 'checked' : '';
            html += `
                <label class="modal-checkbox-label">
                    <input type="checkbox" ${notifyChecked} 
                        onchange="updateModalNotify('${category}', '${itemKey}', this.checked, '${itemType}')">
                    <span>Enable chat notification when this item drops</span>
                </label>
            `;
            html += '</div>';
            html += '</div>';

            // Display Options Section
            html += '<div class="modal-section">';
            html += '<h4 class="modal-section-title">Display Options</h4>';
            html += '<div class="modal-control-group">';
            const clickboxChecked = state.biggerClickbox ? 'checked' : '';
            html += `
                <label class="modal-checkbox-label">
                    <input type="checkbox" ${clickboxChecked} 
                        onchange="updateModalBiggerClickbox('${category}', '${itemKey}', this.checked, '${itemType}')">
                    <span>Bigger clickbox (adds spacing around item name)</span>
                </label>
            `;
            html += '</div>';
            html += '</div>';

            return html;
        }

        // Modal update functions
        function updateModalFilterLevel(category, itemKey, levelIndex, checked, itemType) {
            if (!filterState[category]) filterState[category] = {};
            if (!filterState[category][itemKey]) filterState[category][itemKey] = { show: true, filterLevels: [] };
            if (!filterState[category][itemKey].filterLevels) filterState[category][itemKey].filterLevels = [];
            
            filterState[category][itemKey].filterLevels[levelIndex] = checked;
            generateFilter();

            // Get item code for highlighting
            const item = findItemByKey(category, itemKey);
            if (item) {
                const prefix = getItemPrefix(itemType);
                setTimeout(() => highlightItemInOutput(item.code, prefix), 100);
            }
        }

        function setAllModalLevels(category, itemKey, checked, itemType) {
            if (!filterState[category]) filterState[category] = {};
            if (!filterState[category][itemKey]) filterState[category][itemKey] = { show: true, filterLevels: [] };
            if (!filterState[category][itemKey].filterLevels) filterState[category][itemKey].filterLevels = [];
            
            for (let i = 0; i < 10; i++) {
                filterState[category][itemKey].filterLevels[i] = checked;
            }
            
            // Refresh modal content
            openItemSettings(category, itemKey, document.getElementById('modalItemName').textContent, itemType);
            generateFilter();

            const item = findItemByKey(category, itemKey);
            if (item) {
                const prefix = getItemPrefix(itemType);
                setTimeout(() => highlightItemInOutput(item.code, prefix), 100);
            }
        }

        function toggleModalCustomColor(category, itemKey, checked, itemType) {
            if (!filterState[category]) filterState[category] = {};
            if (!filterState[category][itemKey]) filterState[category][itemKey] = { show: true };
            
            filterState[category][itemKey].useCustomColors = checked;
            
            // Refresh modal to show/hide color controls
            openItemSettings(category, itemKey, document.getElementById('modalItemName').textContent, itemType);
            generateFilter();
            updateSettingsButtonState(category, itemKey, itemType);

            const item = findItemByKey(category, itemKey);
            if (item) {
                const prefix = getItemPrefix(itemType);
                setTimeout(() => highlightItemInOutput(item.code, prefix), 100);
            }
        }

        function updateModalFontColor(category, itemKey, color, itemType) {
            if (!filterState[category]) filterState[category] = {};
            if (!filterState[category][itemKey]) filterState[category][itemKey] = { shown: true };
            
            filterState[category][itemKey].fontColor = color;
            generateFilter();
            updateSettingsButtonState(category, itemKey, itemType);

            const item = findItemByKey(category, itemKey);
            if (item) {
                const prefix = getItemPrefix(itemType);
                setTimeout(() => highlightItemInOutput(item.code, prefix), 100);
            }
        }

        function clearModalFontColor(category, itemKey, itemType) {
            updateModalFontColor(category, itemKey, '', itemType);
            openItemSettings(category, itemKey, document.getElementById('modalItemName').textContent, itemType);
        }

        function updateModalBorderColor(category, itemKey, color, itemType) {
            if (!filterState[category]) filterState[category] = {};
            if (!filterState[category][itemKey]) filterState[category][itemKey] = { shown: true };
            
            filterState[category][itemKey].borderColor = color;
            generateFilter();
            updateSettingsButtonState(category, itemKey, itemType);

            const item = findItemByKey(category, itemKey);
            if (item) {
                const prefix = getItemPrefix(itemType);
                setTimeout(() => highlightItemInOutput(item.code, prefix), 100);
            }
        }

        function clearModalBorderColor(category, itemKey, itemType) {
            if (filterState[category]?.[itemKey]) {
                delete filterState[category][itemKey].borderColor;
            }
            openItemSettings(category, itemKey, document.getElementById('modalItemName').textContent, itemType);
            generateFilter();

            const item = findItemByKey(category, itemKey);
            if (item) {
                const prefix = getItemPrefix(itemType);
                setTimeout(() => highlightItemInOutput(item.code, prefix), 100);
            }
        }

        function updateModalBackgroundColor(category, itemKey, color, itemType) {
            if (!filterState[category]) filterState[category] = {};
            if (!filterState[category][itemKey]) filterState[category][itemKey] = { shown: true };
            
            filterState[category][itemKey].backgroundColor = color;
            generateFilter();
            updateSettingsButtonState(category, itemKey, itemType);

            const item = findItemByKey(category, itemKey);
            if (item) {
                const prefix = getItemPrefix(itemType);
                setTimeout(() => highlightItemInOutput(item.code, prefix), 100);
            }
        }

        function clearModalBackgroundColor(category, itemKey, itemType) {
            if (filterState[category]?.[itemKey]) {
                delete filterState[category][itemKey].backgroundColor;
            }
            openItemSettings(category, itemKey, document.getElementById('modalItemName').textContent, itemType);
            generateFilter();

            const item = findItemByKey(category, itemKey);
            if (item) {
                const prefix = getItemPrefix(itemType);
                setTimeout(() => highlightItemInOutput(item.code, prefix), 100);
            }
        }

        function updateModalNotify(category, itemKey, checked, itemType) {
            if (!filterState[category]) filterState[category] = {};
            if (!filterState[category][itemKey]) filterState[category][itemKey] = { show: true };
            
            filterState[category][itemKey].chatNotification = checked;
            generateFilter();
            updateSettingsButtonState(category, itemKey, itemType);

            const item = findItemByKey(category, itemKey);
            if (item) {
                const prefix = getItemPrefix(itemType);
                setTimeout(() => highlightItemInOutput(item.code, prefix), 100);
            }
        }

        function updateModalBiggerClickbox(category, itemKey, checked, itemType) {
            if (!filterState[category]) filterState[category] = {};
            if (!filterState[category][itemKey]) filterState[category][itemKey] = { show: true };
            
            filterState[category][itemKey].biggerClickbox = checked;
            generateFilter();
            updateSettingsButtonState(category, itemKey, itemType);

            const item = findItemByKey(category, itemKey);
            if (item) {
                const prefix = getItemPrefix(itemType);
                setTimeout(() => highlightItemInOutput(item.code, prefix), 100);
            }
        }

        // NMAG-specific modal functions
        function updateModalEthFilter(category, itemKey, value) {
            if (!filterState[category]) filterState[category] = {};
            if (!filterState[category][itemKey]) filterState[category][itemKey] = { shown: true };
            
            filterState[category][itemKey].ethFilter = value;
            generateFilter();
            updateSettingsButtonState(category, itemKey, 'nmag');

            const item = findItemByKey(category, itemKey);
            if (item) {
                setTimeout(() => highlightItemInOutput(item.code, 'NMAG'), 100);
            }
        }

        function updateModalSocket(category, itemKey, socketValue, checked) {
            if (!filterState[category]) filterState[category] = {};
            if (!filterState[category][itemKey]) filterState[category][itemKey] = { show: true, sockFilter: [] };
            if (!filterState[category][itemKey].sockFilter) filterState[category][itemKey].sockFilter = [];
            
            if (checked) {
                // Add socket value if not already present
                if (!filterState[category][itemKey].sockFilter.includes(socketValue)) {
                    filterState[category][itemKey].sockFilter.push(socketValue);
                }
            } else {
                // Remove socket value
                const index = filterState[category][itemKey].sockFilter.indexOf(socketValue);
                if (index > -1) {
                    filterState[category][itemKey].sockFilter.splice(index, 1);
                }
            }
            
            generateFilter();
            updateSettingsButtonState(category, itemKey, 'nmag');

            const item = findItemByKey(category, itemKey);
            if (item) {
                setTimeout(() => highlightItemInOutput(item.code, 'NMAG'), 100);
            }
        }

        function updateModalEDFilter(category, itemKey, value) {
            if (!filterState[category]) filterState[category] = {};
            if (!filterState[category][itemKey]) filterState[category][itemKey] = { shown: true };
            
            filterState[category][itemKey].edFilter = value;
            generateFilter();
            updateSettingsButtonState(category, itemKey, 'nmag');

            const item = findItemByKey(category, itemKey);
            if (item) {
                setTimeout(() => highlightItemInOutput(item.code, 'NMAG'), 100);
            }
        }

        // Helper functions
        function findItemByKey(category, itemKey) {
            // For simple categories (utility, runes, gems, misc), itemKey is the code
            const simpleCategoriesMap = {
                'utility': utilityItems,
                'runes': runeItems,
                'gems': gemItems,
                'misc': miscItems
            };
            
            if (simpleCategoriesMap[category]) {
                return simpleCategoriesMap[category].find(item => item.code === itemKey);
            }
            
            // For complex categories, look up by sanitized name or code
            const items = window[category];
            if (!items) return null;
            return items.find(item => {
                const sanitized = item.name.replace(/[\s']/g, '_');
                return sanitized === itemKey || item.code === itemKey;
            });
        }

        function getItemPrefix(itemType) {
            const prefixMap = {
                'unique': 'UNI',
                'set': 'SET',
                'magic': 'MAG',
                'rare': 'RARE',
                'nmag': 'NMAG'
            };
            return prefixMap[itemType] || null;
        }

        // Export filter
        function exportFilter() {
            const output = document.getElementById('filter-output').value;
            const blob = new Blob([output], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'FPCustom.filter';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Copy to clipboard
        function copyToClipboard() {
            const output = document.getElementById('filter-output');
            output.select();
            document.execCommand('copy');
            alert('Filter copied to clipboard!');
        }

        // Import filter
        function importFilter(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                document.getElementById('filter-output').value = content;
                
                // Parse and update state
                try {
                    parseFilterAndUpdateState(content);
                    alert('Filter imported successfully! All settings have been loaded.');
                } catch (error) {
                    console.error('Import error:', error);
                    alert('Filter imported but could not fully parse: ' + error.message);
                }
                
                updateOutputStats();
            };
            reader.readAsText(file);
        }

        function parseFilterAndUpdateState(filterContent) {
            const lines = filterContent.split('\n');
            
            // Parse FilterLevel declarations
            const filterLevelRegex = /FilterLevel\[(\d+)\]:\s*(.+)/;
            lines.forEach(line => {
                const match = line.match(filterLevelRegex);
                if (match) {
                    const level = parseInt(match[1]) - 1;
                    const name = match[2].trim();
                    if (level >= 0 && level < 10) {
                        globalSettings.levelNames[level] = name;
                        globalSettings.enableFilterLevels = true;
                    }
                }
            });
            
            // Parse ItemDisplay lines
            const itemDisplayRegex = /ItemDisplay\[([^\]]+)\]:\s*(.*)$/;
            
            lines.forEach(line => {
                line = line.trim();
                if (!line.startsWith('ItemDisplay[')) return;
                
                const match = line.match(itemDisplayRegex);
                if (!match) return;
                
                const condition = match[1];
                const display = match[2];
                
                // Parse the condition and display parts
                parseItemDisplayLine(condition, display);
            });
            
            // Update UI
            if (globalSettings.enableFilterLevels) {
                document.getElementById('enable-filter-levels').checked = true;
                document.getElementById('filter-levels-config').classList.add('active');
                renderLevelNamesConfig();
            }
            
            document.getElementById('hide-junk').checked = globalSettings.hideJunk;
            document.getElementById('show-all').checked = globalSettings.showAll;
            
            // Re-render all sections
            renderAllSections();
        }

        function parseItemDisplayLine(condition, display) {
            const hidden = !display || display.trim() === '';
            
            // Extract codes and conditions
            const parts = condition.split(/\s+/);
            let code = null;
            let rarity = null;
            let isSet = false;
            let isUnique = false;
            let isNmag = false;
            let ethFilter = 'both';
            let sockFilter = [];
            let edFilter = 'any';
            let filterLevels = null;
            
            // Parse condition parts
            for (let i = 0; i < parts.length; i++) {
                const part = parts[i];
                
                if (part === 'UNI') {
                    isUnique = true;
                } else if (part === 'SET') {
                    isSet = true;
                } else if (part === 'NMAG') {
                    isNmag = true;
                } else if (part === 'MAG' || part === 'RARE') {
                    rarity = part;
                } else if (part === 'ETH') {
                    ethFilter = 'eth-only';
                } else if (part === '!ETH') {
                    ethFilter = 'non-eth';
                } else if (part.match(/^SOCK=/)) {
                    // Single socket: SOCK=3
                    const val = part.split('=')[1];
                    if (val) sockFilter.push(val);
                } else if (part === '(SOCK=') {
                    // Multiple sockets: (SOCK=3 OR SOCK=4)
                    // Continue parsing until we hit )
                    for (let j = i + 1; j < parts.length; j++) {
                        if (parts[j].includes('SOCK=')) {
                            const val = parts[j].replace(/[()]/g, '').split('=')[1];
                            if (val) sockFilter.push(val);
                        }
                        if (parts[j].includes(')')) {
                            i = j;
                            break;
                        }
                    }
                } else if (part === 'ED=15') {
                    edFilter = '15';
                } else if (part === 'ED>13') {
                    edFilter = '14+';
                } else if (part === 'ED>12') {
                    edFilter = '13+';
                } else if (part === 'ED>11') {
                    edFilter = '12+';
                } else if (part === 'ED>9') {
                    edFilter = '10+';
                } else if (part.startsWith('FILTLVL')) {
                    // Parse filter level condition
                    filterLevels = parseFilterLevelCondition(part);
                } else if (!part.startsWith('!') && !part.includes('>') && !part.includes('<') && !part.includes('=') && !part.includes('(') && !part.includes(')') && part !== 'OR') {
                    // This is likely the item code
                    code = part;
                }
            }
            
            if (!code) return;
            
            // Parse display formatting
            let fontColor = 'WHITE';
            let useCustomColors = false;
            let borderColor = null;
            let backgroundColor = null;
            let chatNotification = false;
            let biggerClickbox = false;
            
            if (display) {
                // Parse color codes
                const colorMatch = display.match(/%([A-Z]+)%/);
                if (colorMatch) {
                    fontColor = colorMatch[1];
                    useCustomColors = true;
                }
                
                // Check for bigger clickbox
                if (display.includes('%NL%')) {
                    biggerClickbox = true;
                }
                
                // Parse CustomDisplay
                const customMatch = display.match(/<:CustomDisplay:\s*([^:]+):>/);
                if (customMatch) {
                    useCustomColors = true;
                    const customParts = customMatch[1].split(',');
                    customParts.forEach(part => {
                        part = part.trim();
                        if (part.startsWith('NotificationColor')) {
                            chatNotification = true;
                        } else if (part.startsWith('BorderColor')) {
                            const rgbMatch = part.match(/RGB\(([^)]+)\)/);
                            if (rgbMatch) {
                                borderColor = rgbSlashToHex(rgbMatch[1]);
                            }
                        } else if (part.startsWith('BackgroundColor')) {
                            const rgbMatch = part.match(/RGB\(([^)]+)\)/);
                            if (rgbMatch) {
                                backgroundColor = rgbSlashToHex(rgbMatch[1]);
                            }
                        }
                    });
                }
            }
            
            // Prepare state object - only include filterLevels if parsed
            const baseState = {
                show: !hidden,
                useCustomColors,
                fontColor,
                borderColor,
                backgroundColor,
                chatNotification,
                biggerClickbox
            };
            
            if (filterLevels) {
                baseState.filterLevels = filterLevels;
            }
            
            // Update filterState based on item type
            if (isNmag) {
                updateNmagItemState(code, {
                    ...baseState,
                    ethFilter,
                    sockFilter,
                    edFilter
                });
            } else if (isUnique) {
                updateUniqueItemState(code, baseState);
            } else if (isSet) {
                updateSetItemState(code, baseState);
            } else if (rarity) {
                updateRareMagicItemState(code, rarity, baseState);
            } else {
                // Simple items (utility, runes, gems, misc)
                updateSimpleItemState(code, baseState);
            }
        }

        function parseFilterLevelCondition(filtlvlPart) {
            // Parse FILTLVL>=1<=5 type conditions
            const levels = [false, false, false, false, false, false, false, false, false, false];
            
            // Simple case: FILTLVL=1
            const simpleMatch = filtlvlPart.match(/FILTLVL=(\d+)/);
            if (simpleMatch) {
                const level = parseInt(simpleMatch[1]) - 1;
                if (level >= 0 && level < 10) levels[level] = true;
                return levels;
            }
            
            // Range case: FILTLVL>=1<=5
            const rangeMatch = filtlvlPart.match(/FILTLVL>=(\d+)<=(\d+)/);
            if (rangeMatch) {
                const start = parseInt(rangeMatch[1]) - 1;
                const end = parseInt(rangeMatch[2]) - 1;
                for (let i = start; i <= end && i < 10; i++) {
                    if (i >= 0) levels[i] = true;
                }
                return levels;
            }
            
            return levels;
        }

        function updateSimpleItemState(code, state) {
            // Check utility items
            const utilItem = utilityItems.find(i => i.code === code);
            if (utilItem && filterState.utility[code]) {
                Object.assign(filterState.utility[code], state);
                return;
            }
            
            // Check runes
            const runeItem = runeItems.find(i => i.code === code);
            if (runeItem && filterState.runes[code]) {
                Object.assign(filterState.runes[code], state);
                return;
            }
            
            // Check gems
            const gemItem = gemItems.find(i => i.code === code);
            if (gemItem && filterState.gems[code]) {
                Object.assign(filterState.gems[code], state);
                return;
            }
            
            // Check misc
            const miscItem = miscItems.find(i => i.code === code);
            if (miscItem && filterState.misc[code]) {
                Object.assign(filterState.misc[code], state);
                return;
            }
        }

        function updateNmagItemState(code, state) {
            // Search through all nmag arrays
            const nmagArrays = [
                { arr: nmagPolearms, cat: 'nmagPolearms' },
                { arr: nmagSwords, cat: 'nmagSwords' },
                { arr: nmagAxes, cat: 'nmagAxes' },
                { arr: nmagMaces, cat: 'nmagMaces' },
                { arr: nmagStaves, cat: 'nmagStaves' },
                { arr: nmagSpears, cat: 'nmagSpears' },
                { arr: nmagBows, cat: 'nmagBows' },
                { arr: nmagArmor, cat: 'nmagArmor' },
                { arr: nmagShieldsGeneric, cat: 'nmagShieldsGeneric' },
                { arr: nmagShieldsPaladin, cat: 'nmagShieldsPaladin' },
                { arr: nmagHelms, cat: 'nmagHelms' },
                { arr: nmagDruidPelts, cat: 'nmagDruidPelts' },
                { arr: nmagNecroHeads, cat: 'nmagNecroHeads' },
                { arr: nmagAssassinClaws, cat: 'nmagAssassinClaws' },
                { arr: nmagSorcOrbs, cat: 'nmagSorcOrbs' },
                { arr: nmagDaggers, cat: 'nmagDaggers' },
                { arr: nmagWands, cat: 'nmagWands' },
                { arr: nmagScepters, cat: 'nmagScepters' },
                { arr: nmagBarbarianHelms, cat: 'nmagBarbarianHelms' },
                { arr: nmagPolearmsExtended, cat: 'nmagPolearmsExtended' },
                { arr: nmagSwordsExtended, cat: 'nmagSwordsExtended' },
                { arr: nmagAxesExtended, cat: 'nmagAxesExtended' },
                { arr: nmagMacesExtended, cat: 'nmagMacesExtended' },
                { arr: nmagStavesExtended, cat: 'nmagStavesExtended' },
                { arr: nmagSpearsExtended, cat: 'nmagSpearsExtended' },
                { arr: nmagBowsExtended, cat: 'nmagBowsExtended' },
                { arr: nmagCrossbows, cat: 'nmagCrossbows' },
                { arr: nmagJavelins, cat: 'nmagJavelins' },
                { arr: nmagArmorExtended, cat: 'nmagArmorExtended' },
                { arr: nmagShieldsExtended, cat: 'nmagShieldsExtended' },
                { arr: nmagPaladinShieldsExtended, cat: 'nmagPaladinShieldsExtended' },
                { arr: nmagNecromancerShieldsExtended, cat: 'nmagNecromancerShieldsExtended' },
                { arr: nmagHelmsExtended, cat: 'nmagHelmsExtended' },
                { arr: nmagDruidPeltsExtended, cat: 'nmagDruidPeltsExtended' },
                { arr: nmagNecroHeadsExtended, cat: 'nmagNecroHeadsExtended' },
                { arr: nmagAssassinClawsExtended, cat: 'nmagAssassinClawsExtended' },
                { arr: nmagSorcOrbsExtended, cat: 'nmagSorcOrbsExtended' },
                { arr: nmagDaggersExtended, cat: 'nmagDaggersExtended' },
                { arr: nmagWandsExtended, cat: 'nmagWandsExtended' },
                { arr: nmagSceptersExtended, cat: 'nmagSceptersExtended' },
                { arr: nmagBarbarianHelmsExtended, cat: 'nmagBarbarianHelmsExtended' },
                { arr: nmagAmazonWeapons, cat: 'nmagAmazonWeapons' },
                { arr: nmagCirclets, cat: 'nmagCirclets' }
            ];
            
            for (const { arr, cat } of nmagArrays) {
                const idx = arr.findIndex(i => i.code === code);
                if (idx !== -1) {
                    const key = code + '_' + idx;
                    if (filterState[cat] && filterState[cat][key]) {
                        Object.assign(filterState[cat][key], state);
                        return;
                    }
                }
            }
        }

        function updateUniqueItemState(code, state) {
            // Search unique arrays
            const uniqueArrays = [
                { arr: jewelryAndCharms, cat: 'jewelryCharms' },
                { arr: classSpecificUniques, cat: 'classUniques' },
                { arr: eliteUniqueWeapons, cat: 'eliteWeapons' },
                { arr: eliteUniqueArmor, cat: 'eliteArmor' },
                { arr: exceptionalUniqueWeapons, cat: 'excWeapons' },
                { arr: exceptionalUniqueArmor, cat: 'excArmor' },
                { arr: normalUniqueWeapons, cat: 'normWeapons' },
                { arr: normalUniqueArmor, cat: 'normArmor' }
            ];
            
            for (const { arr, cat } of uniqueArrays) {
                const item = arr.find(i => i.code === code);
                if (item && item.name) {
                    const key = item.name.replace(/[^a-zA-Z0-9]/g, '_');
                    if (filterState[cat] && filterState[cat][key]) {
                        Object.assign(filterState[cat][key], state);
                        return;
                    }
                }
            }
        }

        function updateSetItemState(code, state) {
            // Search set arrays
            const setArrays = [
                { arr: highLevelSets, cat: 'highSets' },
                { arr: midLevelSets, cat: 'midSets' },
                { arr: lowLevelSets, cat: 'lowSets' }
            ];
            
            for (const { arr, cat } of setArrays) {
                const items = arr.filter(i => i.code === code);
                items.forEach(item => {
                    const key = item.code + '_' + item.set;
                    if (filterState[cat] && filterState[cat][key]) {
                        Object.assign(filterState[cat][key], state);
                    }
                });
            }
        }

        function updateRareMagicItemState(code, rarity, state) {
            // Search magic/rare arrays
            const arrays = [
                { arr: magicJewelry, cat: 'magicJewelry' },
                { arr: magicCharms, cat: 'magicCharms' },
                { arr: magicCraftingBases, cat: 'magicCrafting' },
                { arr: rareJewelry, cat: 'rareJewelry' },
                { arr: rareClassItems, cat: 'rareClassItems' },
                { arr: rareEliteBases, cat: 'rareEliteBases' }
            ];
            
            for (const { arr, cat } of arrays) {
                arr.forEach((item, idx) => {
                    if (item.code === code) {
                        const key = code + '_' + idx;
                        if (filterState[cat] && filterState[cat][key]) {
                            Object.assign(filterState[cat][key], state);
                        }
                    }
                });
            }
        }

        function rgbSlashToHex(rgbStr) {
            // Convert "255/128/0" to "#ff8000"
            const parts = rgbStr.split('/').map(p => parseInt(p.trim()));
            if (parts.length !== 3) return '#ffffff';
            const hex = parts.map(p => {
                const h = Math.max(0, Math.min(255, p)).toString(16);
                return h.length === 1 ? '0' + h : h;
            }).join('');
            return '#' + hex;
        }

        function renderAllSections() {
            renderUtilityItems();
            renderRuneItems();
            renderGemsItems();
            renderMiscItems();
            renderJewelryCharmsItems();
            renderClassUniquesItems();
            renderEliteWeaponsItems();
            renderEliteArmorItems();
            renderExcWeaponsItems();
            renderExcArmorItems();
            renderNormWeaponsItems();
            renderNormArmorItems();
            renderHighSetsItems();
            renderMidSetsItems();
            renderLowSetsItems();
            renderMagicJewelryItems();
            renderMagicCharmsItems();
            renderMagicCraftingItems();
            renderRareJewelryItems();
            renderRareClassItemsItems();
            renderRareEliteBasesItems();
            renderNmagPolearmsItems();
            renderNmagSwordsItems();
            renderNmagAxesItems();
            renderNmagMacesItems();
            renderNmagStavesItems();
            renderNmagSpearsItems();
            renderNmagBowsItems();
            renderNmagArmorItems();
            renderNmagShieldsGenericItems();
            renderNmagShieldsPaladinItems();
            renderNmagHelmsItems();
            renderNmagDruidPeltsItems();
            renderNmagNecroHeadsItems();
            renderNmagAssassinClawsItems();
            renderNmagSorcOrbsItems();
            renderNmagDaggersItems();
            renderNmagWandsItems();
            renderNmagSceptersItems();
            renderNmagBarbarianHelmsItems();
            renderNmagPolearmsExtendedItems();
            renderNmagSwordsExtendedItems();
            renderNmagAxesExtendedItems();
            renderNmagMacesExtendedItems();
            renderNmagStavesExtendedItems();
            renderNmagSpearsExtendedItems();
            renderNmagBowsExtendedItems();
            renderNmagCrossbowsItems();
            renderNmagJavelinsItems();
            renderNmagArmorExtendedItems();
            renderNmagShieldsExtendedItems();
            renderNmagPaladinShieldsExtendedItems();
            renderNmagNecromancerShieldsExtendedItems();
            renderNmagHelmsExtendedItems();
            renderNmagDruidPeltsExtendedItems();
            renderNmagNecroHeadsExtendedItems();
            renderNmagAssassinClawsExtendedItems();
            renderNmagSorcOrbsExtendedItems();
            renderNmagDaggersExtendedItems();
            renderNmagWandsExtendedItems();
            renderNmagSceptersExtendedItems();
            renderNmagBarbarianHelmsExtendedItems();
            renderNmagAmazonWeaponsItems();
            renderNmagCircletsItems();
            generateFilter();
        }

        // Allow manual edits to update stats
        document.getElementById('filter-output').addEventListener('input', updateOutputStats);

        // Toggle filter levels feature
        function toggleFilterLevels(enabled) {
            globalSettings.enableFilterLevels = enabled;
            const configSection = document.getElementById('filter-levels-config');
            
            if (enabled) {
                configSection.classList.add('active');
                renderLevelNamesConfig();
            } else {
                configSection.classList.remove('active');
            }
            
            // Re-render all sections to update UI
            renderUtilityItems();
            renderRuneItems();
            renderGemsItems();
            renderMiscItems();
            renderJewelryCharmsItems();
            renderClassUniquesItems();
            renderEliteWeaponsItems();
            renderEliteArmorItems();
            renderExcWeaponsItems();
            renderExcArmorItems();
            renderNormWeaponsItems();
            renderNormArmorItems();
            renderHighSetsItems();
            renderMidSetsItems();
            renderLowSetsItems();
            renderMagicJewelryItems();
            renderMagicCharmsItems();
            renderMagicCraftingItems();
            renderRareJewelryItems();
            renderRareClassItemsItems();
            renderRareEliteBasesItems();
            renderNmagPolearmsItems();
            renderNmagSwordsItems();
            renderNmagAxesItems();
            renderNmagMacesItems();
            renderNmagStavesItems();
            renderNmagSpearsItems();
            renderNmagBowsItems();
            renderNmagArmorItems();
            renderNmagShieldsGenericItems();
            renderNmagShieldsPaladinItems();
            renderNmagHelmsItems();
            renderNmagDruidPeltsItems();
            renderNmagNecroHeadsItems();
            renderNmagAssassinClawsItems();
            renderNmagSorcOrbsItems();
            renderNmagDaggersItems();
            renderNmagWandsItems();
            renderNmagSceptersItems();
            renderNmagBarbarianHelmsItems();
            renderNmagPolearmsExtendedItems();
            renderNmagSwordsExtendedItems();
            renderNmagAxesExtendedItems();
            renderNmagMacesExtendedItems();
            renderNmagStavesExtendedItems();
            renderNmagSpearsExtendedItems();
            renderNmagBowsExtendedItems();
            renderNmagCrossbowsItems();
            renderNmagJavelinsItems();
            renderNmagArmorExtendedItems();
            renderNmagShieldsExtendedItems();
            renderNmagPaladinShieldsExtendedItems();
            renderNmagNecromancerShieldsExtendedItems();
            renderNmagHelmsExtendedItems();
            renderNmagDruidPeltsExtendedItems();
            renderNmagNecroHeadsExtendedItems();
            renderNmagAssassinClawsExtendedItems();
            renderNmagSorcOrbsExtendedItems();
            renderNmagDaggersExtendedItems();
            renderNmagWandsExtendedItems();
            renderNmagSceptersExtendedItems();
            renderNmagBarbarianHelmsExtendedItems();
            renderNmagAmazonWeaponsItems();
            renderNmagCircletsItems();
            generateFilter();
        }

        // Toggle Hide Junk setting
        function toggleHideJunk(enabled) {
            globalSettings.hideJunk = enabled;
            generateFilter();
        }

        // Toggle Show All setting
        function toggleShowAll(enabled) {
            globalSettings.showAll = enabled;
            generateFilter();
        }

        // Render level names configuration inputs
        function renderLevelNamesConfig() {
            const container = document.getElementById('level-names-grid');
            container.innerHTML = '';
            
            for (let i = 0; i < 10; i++) {
                const wrapper = document.createElement('div');
                wrapper.className = 'level-name-input';
                wrapper.innerHTML = `
                    <label>Level ${i + 1}</label>
                    <input type="text" 
                        value="${globalSettings.levelNames[i]}" 
                        onchange="updateLevelName(${i}, this.value)"
                        placeholder="Level ${i + 1}">
                `;
                container.appendChild(wrapper);
            }
        }

        // Update level name
        function updateLevelName(level, name) {
            globalSettings.levelNames[level] = name.trim();
            // Re-render all sections to update checkboxes visibility
            renderUtilityItems();
            renderRuneItems();
            renderGemsItems();
            renderMiscItems();
            renderJewelryCharmsItems();
            renderClassUniquesItems();
            renderEliteWeaponsItems();
            renderEliteArmorItems();
            renderExcWeaponsItems();
            renderExcArmorItems();
            renderNormWeaponsItems();
            renderNormArmorItems();
            renderHighSetsItems();
            renderMidSetsItems();
            renderLowSetsItems();
            renderMagicJewelryItems();
            renderMagicCharmsItems();
            renderMagicCraftingItems();
            renderRareJewelryItems();
            renderRareClassItemsItems();
            renderRareEliteBasesItems();
            renderNmagPolearmsItems();
            renderNmagSwordsItems();
            renderNmagAxesItems();
            renderNmagMacesItems();
            renderNmagStavesItems();
            renderNmagSpearsItems();
            renderNmagBowsItems();
            renderNmagArmorItems();
            renderNmagShieldsGenericItems();
            renderNmagShieldsPaladinItems();
            renderNmagHelmsItems();
            renderNmagDruidPeltsItems();
            renderNmagNecroHeadsItems();
            renderNmagAssassinClawsItems();
            renderNmagSorcOrbsItems();
            renderNmagDaggersItems();
            renderNmagWandsItems();
            renderNmagSceptersItems();
            renderNmagBarbarianHelmsItems();
            renderNmagPolearmsExtendedItems();
            renderNmagSwordsExtendedItems();
            renderNmagAxesExtendedItems();
            renderNmagMacesExtendedItems();
            renderNmagStavesExtendedItems();
            renderNmagSpearsExtendedItems();
            renderNmagBowsExtendedItems();
            renderNmagCrossbowsItems();
            renderNmagJavelinsItems();
            renderNmagArmorExtendedItems();
            renderNmagShieldsExtendedItems();
            renderNmagPaladinShieldsExtendedItems();
            renderNmagNecromancerShieldsExtendedItems();
            renderNmagHelmsExtendedItems();
            renderNmagDruidPeltsExtendedItems();
            renderNmagNecroHeadsExtendedItems();
            renderNmagAssassinClawsExtendedItems();
            renderNmagSorcOrbsExtendedItems();
            renderNmagDaggersExtendedItems();
            renderNmagWandsExtendedItems();
            renderNmagSceptersExtendedItems();
            renderNmagBarbarianHelmsExtendedItems();
            renderNmagAmazonWeaponsItems();
            renderNmagCircletsItems();
            generateFilter();
        }

        // Update item filter level
        function updateItemLevel(category, code, level, checked) {
            filterState[category][code].filterLevels[level] = checked;
            generateFilter();
            setTimeout(() => highlightItemInOutput(code), 100);
        }

        // Set all levels for an item
        function setAllLevels(category, code, checked) {
            for (let i = 0; i < 10; i++) {
                filterState[category][code].filterLevels[i] = checked;
            }
            // Re-render the appropriate section to update checkboxes
            if (category === 'jewelryCharms') {
                renderJewelryCharmsItems();
            } else if (category === 'utility') {
                renderUtilityItems();
            } else if (category === 'runes') {
                renderRuneItems();
            } else if (category === 'gems') {
                renderGemsItems();
            } else if (category === 'misc') {
                renderMiscItems();
            } else if (category === 'classUniques') {
                renderClassUniquesItems();
            } else if (category === 'eliteWeapons') {
                renderEliteWeaponsItems();
            } else if (category === 'eliteArmor') {
                renderEliteArmorItems();
            } else if (category === 'excWeapons') {
                renderExcWeaponsItems();
            } else if (category === 'excArmor') {
                renderExcArmorItems();
            } else if (category === 'normWeapons') {
                renderNormWeaponsItems();
            } else if (category === 'normArmor') {
                renderNormArmorItems();
            }
            generateFilter();
        }

        // Initialize
        renderUtilityItems();
        renderRuneItems();
        renderGemsItems();
        renderMiscItems();
        renderJewelryCharmsItems();
        renderClassUniquesItems();
        renderEliteWeaponsItems();
        renderEliteArmorItems();
        renderExcWeaponsItems();
        renderExcArmorItems();
        renderNormWeaponsItems();
        renderNormArmorItems();
        renderHighSetsItems();
        renderMidSetsItems();
        renderLowSetsItems();
        renderMagicJewelryItems();
        renderMagicCharmsItems();
        renderMagicCraftingItems();
        renderRareJewelryItems();
        renderRareClassItemsItems();
        renderRareEliteBasesItems();
        renderNmagPolearmsItems();
        renderNmagSwordsItems();
        renderNmagAxesItems();
        renderNmagMacesItems();
        renderNmagStavesItems();
        renderNmagSpearsItems();
        renderNmagBowsItems();
        renderNmagArmorItems();
        renderNmagShieldsGenericItems();
        renderNmagShieldsPaladinItems();
        renderNmagHelmsItems();
        renderNmagDruidPeltsItems();
        renderNmagNecroHeadsItems();
        renderNmagAssassinClawsItems();
        renderNmagSorcOrbsItems();
        renderNmagDaggersItems();
        renderNmagWandsItems();
        renderNmagSceptersItems();
        renderNmagBarbarianHelmsItems();
        renderNmagPolearmsExtendedItems();
        renderNmagSwordsExtendedItems();
        renderNmagAxesExtendedItems();
        renderNmagMacesExtendedItems();
        renderNmagStavesExtendedItems();
        renderNmagSpearsExtendedItems();
        renderNmagBowsExtendedItems();
        renderNmagCrossbowsItems();
        renderNmagJavelinsItems();
        renderNmagArmorExtendedItems();
        renderNmagShieldsExtendedItems();
        renderNmagPaladinShieldsExtendedItems();
        renderNmagNecromancerShieldsExtendedItems();
        renderNmagHelmsExtendedItems();
        renderNmagDruidPeltsExtendedItems();
        renderNmagNecroHeadsExtendedItems();
        renderNmagAssassinClawsExtendedItems();
        renderNmagSorcOrbsExtendedItems();
        renderNmagDaggersExtendedItems();
        renderNmagWandsExtendedItems();
        renderNmagSceptersExtendedItems();
        renderNmagBarbarianHelmsExtendedItems();
        renderNmagAmazonWeaponsItems();
        renderNmagCircletsItems();
        generateFilter();
    </script>

    <!-- Item Settings Modal -->
    <div class="modal-overlay" id="itemSettingsModal" onclick="closeItemSettings(event)">
        <div class="modal-container" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title" id="modalItemName"></h3>
                <button class="modal-close" onclick="closeItemSettings()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be populated dynamically -->
            </div>
        </div>
    </div>
</body>
</html>
